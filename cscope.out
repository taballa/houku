cscope 15 C:\wamp\www\houku"               0000194892
	@C:\wamp\www\houku\app\Conf\config.php

1 <?
php


2  
¬¿y
(

	@C:\wamp\www\houku\app\Lib\Action\IndexAction.class.php

1 <?
php


3 şas 
	cIndexAùiÚ
 
ex‹nds
 
	mAùiÚ
 {

4 
public
 
funùiÚ
 
	$šdex
(){

5 
$this
->
	`show
('<styleype="text/css">*{…adding: 0; margin: 0; } div{…adding: 4px 48px;} body{ background: #fff; font-family: "å¾®è½¯é›…é»‘"; color: #333;} h1{ font-size: 100px; font-weight:‚ormal; margin-bottom: 12px; }…{†ine-height: 1.8em; font-size: 36px }</style><div style="padding: 24px 48px;"> <h1>:)</h1><p>æ¬¢è¿ä½¿ç”¨ <b>ThinkPHP</b>ï¼</p></div>','utf-8');

7 
	}
}

	@C:\wamp\www\houku\app\Runtime\Cache\9885ecc411f90bec36756701bd64bb4a.php

1 <?
php
 ià(!
defšed
('THINK_PATH')è
ex™
();?><
¡yË
 
	gty³
="‹xt/css">*{ 
·ddšg
: 0; 
	gm¬gš
: 0; } 
	gdiv
{ 
	g·ddšg
: 4
px
 48px;} 
	gbody
{ 
	gbackground
: #fff; 
	gfÚt
-
	gçmy
: "å¾®è½¯é›…é»‘"; 
	gcŞÜ
: #333;} 
	gh1
{ fÚt-
	gsize
: 100px; fÚt-
	gweight
: 
nÜm®
; m¬gš-
	gbÙtom
: 12px; } 
	gp
{ 
	glše
-
	gheight
: 1.8e
m
; fÚt-size: 36px }</¡yË><
div
 styË="·ddšg: 24px 48px;"> <
h1
>:)</h1><
p
>æ¬¢è¿ä½¿ç”¨ <
b
>
ThškPHP
</b>ï¼</p></div><
süt
 
ty³
="‹xt/javasüt" 
¤c
="h‰p://js.qq.com/¡©s?sId=9347272" 
ch¬£t
="UTF-8"></script>

	@C:\wamp\www\houku\app\Runtime\Cache\bac39f696f7de5c7cd83cdbb7532b2fc.php

1 <?
php
 ià(!
defšed
('THINK_PATH')è
ex™
();?><
¡yË
 
	gty³
="‹xt/css">*{ 
·ddšg
: 0; 
	gm¬gš
: 0; } 
	gdiv
{ 
	g·ddšg
: 4
px
 48px;} 
	gbody
{ 
	gbackground
: #fff; 
	gfÚt
-
	gçmy
: "å¾®è½¯é›…é»‘"; 
	gcŞÜ
: #333;} 
	gh1
{ fÚt-
	gsize
: 100px; fÚt-
	gweight
: 
nÜm®
; m¬gš-
	gbÙtom
: 12px; } 
	gp
{ 
	glše
-
	gheight
: 1.8e
m
; fÚt-size: 36px }</¡yË><
div
 styË="·ddšg: 24px 48px;"> <
h1
>:)</h1><
p
>æ¬¢è¿ä½¿ç”¨ <
b
>
ThškPHP
</b>ï¼</p></div>

	@C:\wamp\www\houku\index.php

1 <?
php


2 
defše
('APP_DEBUG',
TRUE
);

3 
defše
('APP_NAME','app');

4 
defše
('APP_PATH','./app/');

5 
	g»quœe
 './thinkphp/ThinkPHP/ThinkPHP.php';

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Common\common.php

1 <?
php


36 
funùiÚ
 
G
(
$¡¬t
,
$’d
='',
$dec
=4) {

37 
$_šfo
 = 
¬¿y
();

38 
	g$_mem
 = 
¬¿y
();

39 if(
is_æßt
(
$’d
)) {

40 
	g$_šfo
[
$¡¬t
] = 
$’d
;

41 }
–£if
(!
em±y
(
$’d
)){

42 if(!
is£t
(
$_šfo
[
$’d
])è
	g$_šfo
[$’d] = 
miüÙime
(
TRUE
);

43 if(
	gMEMORY_LIMIT_ON
 && 
	g$dec
=='m'){

44 if(!
is£t
(
$_mem
[
$’d
])è$_mem[$’d] = 
memÜy_g‘_u§ge
();

45  
numb”_fÜm©
((
$_mem
[
$’d
]-$_mem[
$¡¬t
])/1024);

47  
numb”_fÜm©
((
$_šfo
[
$’d
]-$_šfo[
$¡¬t
]),
$dec
);

51 
	g$_šfo
[
$¡¬t
] = 
miüÙime
(
TRUE
);

52 if(
	gMEMORY_LIMIT_ON
è
	g$_mem
[
$¡¬t
] = 
memÜy_g‘_u§ge
();

69 
funùiÚ
 
	$N
(
$key
, 
$¡•
=0,
$§ve
=
çl£
) {

70 
$_num
 = 
	`¬¿y
();

71 ià(!
	`is£t
(
$_num
[
$key
])) {

72 
$_num
[
$key
] = (
çl£
 !=ğ
$§ve
)? 
	`S
('N_'.$key) : 0;

74 ià(
	`em±y
(
$¡•
))

75  
$_num
[
$key
];

77 
$_num
[
$key
] = $_num[$key] + (è
$¡•
;

78 if(
çl£
 !=ğ
$§ve
){

79 
	`S
('N_'.
$key
,
$_num
[$key],
$§ve
);

81 
	}
}

90 
funùiÚ
 
	$·r£_Çme
(
$Çme
, 
$ty³
=0) {

91 ià(
$ty³
) {

92  
	`ucfœ¡
(
	`´eg_»¶aû
("/_([a-zA-Z])/e", "¡¹ouµ”('\\1')", 
$Çme
));

94  
	`¡¹Şow”
(
	`Œim
(
	`´eg_»¶aû
("/[A-Z]/", "_\\0", 
$Çme
), "_"));

96 
	}
}

103 
funùiÚ
 
	$»quœe_ÿche
(
$f’ame
) {

104 
$_impÜtFes
 = 
	`¬¿y
();

105 ià(!
	`is£t
(
$_impÜtFes
[
$f’ame
])) {

106 ià(
	`fe_exi¡s_ÿ£
(
$f’ame
)) {

107 
»quœe
 
$f’ame
;

108 
$_impÜtFes
[
$f’ame
] = 
Œue
;

110 
$_impÜtFes
[
$f’ame
] = 
çl£
;

113  
$_impÜtFes
[
$f’ame
];

114 
	}
}

122 
funùiÚ
 
	$»quœe_¬¿y
(
$¬¿y
,
$»tuº
=
çl£
){

123 
	`fÜ—ch
 (
$¬¿y
 
as
 
$fe
){

124 ià(
	`»quœe_ÿche
(
$fe
è&& 
$»tuº
è 
Œue
;

126 if(
$»tuº
è 
çl£
;

127 
	}
}

134 
funùiÚ
 
	$fe_exi¡s_ÿ£
(
$f’ame
) {

135 ià(
	`is_fe
(
$f’ame
)) {

136 ià(
IS_WIN
 && 
	`C
('APP_FILE_CASE')) {

137 ià(
	`ba£Çme
(
	`»®·th
(
$f’ame
)) != basename($filename))

138  
çl£
;

140  
Œue
;

142  
çl£
;

143 
	}
}

152 
funùiÚ
 
impÜt
(
$şass
, 
$ba£U¾
 = '', 
$ext
='.class.php') {

153 
$_fe
 = 
¬¿y
();

154 
	g$şass
 = 
¡r_»¶aû
(
¬¿y
('.', '#'),‡¼ay('/', '.'), 
$şass
);

155 ià('' ==ğ
$ba£U¾
 && 
çl£
 ==ğ
¡½os
(
$şass
, '/')) {

157  
®Ÿs_impÜt
(
$şass
);

159 ià(
is£t
(
$_fe
[
$şass
 . 
$ba£U¾
]))

160  
	gŒue
;

162 
	g$_fe
[
$şass
 . 
$ba£U¾
] = 
Œue
;

163 
	g$şass_¡rut
 = 
ex¶ode
('/', 
$şass
);

164 ià(
em±y
(
$ba£U¾
)) {

165 
	g$libP©h
 = 
defšed
('BASE_LIB_PATH')?
BASE_LIB_PATH
:
LIB_PATH
;

166 ià('@' =ğ
$şass_¡rut
[0] || 
APP_NAME
 == $class_strut[0]) {

168 
$ba£U¾
 = 
dœÇme
(
$libP©h
);

169 
	g$şass
 = 
sub¡r_»¶aû
(
$şass
, 
ba£Çme
(
$libP©h
).'/', 0, 
¡¾’
(
$şass_¡rut
[0]) + 1);

170 }
–£if
 ('thšk' =ğ
¡¹Şow”
(
$şass_¡rut
[0])){

171 
$ba£U¾
 = 
CORE_PATH
;

172 
	g$şass
 = 
sub¡r
(
$şass
,6);

173 }
–£if
 (
š_¬¿y
(
¡¹Şow”
(
$şass_¡rut
[0]), 
¬¿y
('org', 'com'))) {

175 
	g$ba£U¾
 = 
LIBRARY_PATH
;

177 
	g$şass
 = 
sub¡r_»¶aû
(
$şass
, '', 0, 
¡¾’
(
$şass_¡rut
[0]) + 1);

178 
	g$ba£U¾
 = 
APP_PATH
 . '../' . 
$şass_¡rut
[0] . '/'.
ba£Çme
(
$libP©h
).'/';

181 ià(
sub¡r
(
$ba£U¾
, -1) != '/')

182 
$ba£U¾
 .= '/';

183 
	g$şassfe
 = 
$ba£U¾
 . 
$şass
 . 
$ext
;

184 ià(!
şass_exi¡s
(
ba£Çme
(
$şass
),
çl£
)) {

186  
»quœe_ÿche
(
$şassfe
);

198 
funùiÚ
 
lßd
(
$Çme
, 
$ba£U¾
='', 
$ext
='.php') {

199 
$Çme
 = 
¡r_»¶aû
(
¬¿y
('.', '#'),‡rray('/', '.'), $name);

200 ià(
em±y
(
$ba£U¾
)) {

201 ià(0 ==ğ
¡½os
(
$Çme
, '@/')) {

203 
	g$ba£U¾
 = 
COMMON_PATH
;

204 
	g$Çme
 = 
sub¡r
(
$Çme
, 2);

207 
	g$ba£U¾
 = 
EXTEND_PATH
 . 'Function/';

210 ià(
sub¡r
(
$ba£U¾
, -1) != '/')

211 
$ba£U¾
 .= '/';

212 
»quœe_ÿche
(
$ba£U¾
 . 
$Çme
 . 
$ext
);

222 
funùiÚ
 
v’dÜ
(
$şass
, 
$ba£U¾
 = '', 
$ext
='.php') {

223 ià(
em±y
(
$ba£U¾
))

224 
$ba£U¾
 = 
VENDOR_PATH
;

225  
impÜt
(
$şass
, 
$ba£U¾
, 
$ext
);

234 
funùiÚ
 
®Ÿs_impÜt
(
$®Ÿs
, 
$şassfe
='') {

235 
$_®Ÿs
 = 
¬¿y
();

236 ià(
is_¡ršg
(
$®Ÿs
)) {

237 if(
is£t
(
$_®Ÿs
[
$®Ÿs
])) {

238  
»quœe_ÿche
(
$_®Ÿs
[
$®Ÿs
]);

239 }
–£if
 ('' !=ğ
$şassfe
) {

241 
$_®Ÿs
[
$®Ÿs
] = 
$şassfe
;

244 }
–£if
 (
is_¬¿y
(
$®Ÿs
)) {

245 
	g$_®Ÿs
 = 
¬¿y_m”ge
(
$_®Ÿs
,
$®Ÿs
);

248  
	gçl£
;

257 
funùiÚ
 
D
(
$Çme
='',
$Ïy”
='') {

258 if(
em±y
(
$Çme
)è 
Ãw
 
Mod–
;

259 
	g$_mod–
 = 
¬¿y
();

260 
	g$Ïy”
 = 
$Ïy”
?$Ïy”:
C
('DEFAULT_M_LAYER');

261 if(
¡½os
(
$Çme
,'://')) {

262 
	g$Çme
 = 
¡r_»¶aû
('://','/'.
$Ïy”
.'/',
$Çme
);

264 
	g$Çme
 = 
C
('DEFAULT_APP').'/'.
$Ïy”
.'/'.
$Çme
;

266 if(
is£t
(
$_mod–
[
$Çme
])è 
	g$_mod–
[$name];

267 
impÜt
(
$Çme
.
$Ïy”
);

268 
	g$şass
 = 
ba£Çme
(
$Çme
.
$Ïy”
);

269 if(
şass_exi¡s
(
$şass
)) {

270 
	g$mod–
 = 
Ãw
 
$şass
();

272 
	g$mod–
 = 
Ãw
 
Mod–
(
ba£Çme
(
$Çme
));

274 
	g$_mod–
[
$Çme
] = 
$mod–
;

275  
	g$mod–
;

285 
funùiÚ
 
M
(
$Çme
='', 
$bËP»fix
='',
$cÚÃùiÚ
='') {

286 
$_mod–
 = 
¬¿y
();

287 if(
¡½os
(
$Çme
,':')) {

288 
li¡
(
$şass
,
$Çme
èğ
ex¶ode
(':',$name);

290 
	g$şass
 = 'Model';

292 
	g$guid
 = 
$bËP»fix
 . 
$Çme
 . '_' . 
$şass
;

293 ià(!
is£t
(
$_mod–
[
$guid
]))

294 
	g$_mod–
[
$guid
] = 
Ãw
 
$şass
(
$Çme
,
$bËP»fix
,
$cÚÃùiÚ
);

295  
	g$_mod–
[
$guid
];

305 
funùiÚ
 
A
(
$Çme
,
$Ïy”
='',
$commÚ
=
çl£
) {

306 
$_aùiÚ
 = 
¬¿y
();

307 
	g$Ïy”
 = 
$Ïy”
?$Ïy”:
C
('DEFAULT_C_LAYER');

308 if(
¡½os
(
$Çme
,'://')) {

309 
	g$Çme
 = 
¡r_»¶aû
('://','/'.
$Ïy”
.'/',
$Çme
);

311 
	g$Çme
 = '@/'.
$Ïy”
.'/'.
$Çme
;

313 if(
is£t
(
$_aùiÚ
[
$Çme
])è 
	g$_aùiÚ
[$name];

314 if(
	g$commÚ
){

315 
impÜt
(
¡r_»¶aû
('@/','',
$Çme
).
$Ïy”
,
LIB_PATH
);

317 
impÜt
(
$Çme
.
$Ïy”
);

319 
	g$şass
 = 
ba£Çme
(
$Çme
.
$Ïy”
);

320 if(
şass_exi¡s
(
$şass
,
çl£
)) {

321 
	g$aùiÚ
 = 
Ãw
 
$şass
();

322 
	g$_aùiÚ
[
$Çme
] = 
$aùiÚ
;

323  
	g$aùiÚ
;

325  
	gçl£
;

336 
funùiÚ
 
R
(
$u¾
,
$v¬s
=
¬¿y
(),
$Ïy”
='') {

337 
$šfo
 = 
·thšfo
(
$u¾
);

338 
	g$aùiÚ
 = 
$šfo
['basename'];

339 
	g$moduË
 = 
$šfo
['dirname'];

340 
	g$şass
 = 
A
(
$moduË
,
$Ïy”
);

341 if(
	g$şass
){

342 if(
is_¡ršg
(
$v¬s
)) {

343 
·r£_¡r
(
$v¬s
,$vars);

345  
ÿÎ_u£r_func_¬¿y
(
¬¿y
(&
$şass
,
$aùiÚ
.
C
('ACTION_SUFFIX')),
$v¬s
);

347  
	gçl£
;

357 
funùiÚ
 
	$L
(
$Çme
=
nuÎ
, 
$v®ue
=null) {

358 
$_Ïng
 = 
	`¬¿y
();

360 ià(
	`em±y
(
$Çme
))

361  
$_Ïng
;

364 ià(
	`is_¡ršg
(
$Çme
)) {

365 
$Çme
 = 
	`¡¹ouµ”
($name);

366 ià(
	`is_nuÎ
(
$v®ue
))

367  
	`is£t
(
$_Ïng
[
$Çme
]) ? $_lang[$name] : $name;

368 
$_Ïng
[
$Çme
] = 
$v®ue
;

372 ià(
	`is_¬¿y
(
$Çme
))

373 
$_Ïng
 = 
	`¬¿y_m”ge
($_Ïng, 
	`¬¿y_chªge_key_ÿ£
(
$Çme
, 
CASE_UPPER
));

375 
	}
}

383 
funùiÚ
 
	$C
(
$Çme
=
nuÎ
, 
$v®ue
=null) {

384 
$_cÚfig
 = 
	`¬¿y
();

386 ià(
	`em±y
(
$Çme
)) {

387 if(!
	`em±y
(
$v®ue
è&& 
$¬¿y
 = 
	`S
('c_'.$value)) {

388 
$_cÚfig
 = 
	`¬¿y_m”ge
($_cÚfig, 
	`¬¿y_chªge_key_ÿ£
(
$¬¿y
));

390  
$_cÚfig
;

393 ià(
	`is_¡ršg
(
$Çme
)) {

394 ià(!
	`¡½os
(
$Çme
, '.')) {

395 
$Çme
 = 
	`¡¹Şow”
($name);

396 ià(
	`is_nuÎ
(
$v®ue
))

397  
	`is£t
(
$_cÚfig
[
$Çme
]è? $_cÚfig[$Çme] : 
nuÎ
;

398 
$_cÚfig
[
$Çme
] = 
$v®ue
;

402 
$Çme
 = 
	`ex¶ode
('.', $name);

403 
$Çme
[0] = 
	`¡¹Şow”
($name[0]);

404 ià(
	`is_nuÎ
(
$v®ue
))

405  
	`is£t
(
$_cÚfig
[
$Çme
[0]][$Çme[1]]è? $_cÚfig[$Çme[0]][$Çme[1]] : 
nuÎ
;

406 
$_cÚfig
[
$Çme
[0]][$Çme[1]] = 
$v®ue
;

410 ià(
	`is_¬¿y
(
$Çme
)){

411 
$_cÚfig
 = 
	`¬¿y_m”ge
($_cÚfig, 
	`¬¿y_chªge_key_ÿ£
(
$Çme
));

412 if(!
	`em±y
(
$v®ue
)) {

413 
	`S
('c_'.
$v®ue
,
$_cÚfig
);

417  
nuÎ
;

418 
	}
}

426 
funùiÚ
 
	$g
(
$g
, &
$·¿ms
=
NULL
) {

428 
$ex‹nds
 = 
	`C
('ex‹nds.' . 
$g
);

430 
$gs
 = 
	`C
('gs.' . 
$g
);

431 ià(!
	`em±y
(
$gs
)) {

432 if(
	`em±y
(
$gs
['_ov”Ïy']è&& !em±y(
$ex‹nds
)) {

433 
$gs
 = 
	`¬¿y_unique
(
	`¬¿y_m”ge
(
$ex‹nds
,$tags));

434 }
	`–£if
(
	`is£t
(
$gs
['_overlay'])){

435 
	`un£t
(
$gs
['_overlay']);

437 }
	`–£if
(!
	`em±y
(
$ex‹nds
)) {

438 
$gs
 = 
$ex‹nds
;

440 if(
$gs
) {

441 if(
APP_DEBUG
) {

442 
	`G
(
$g
.'Start');

443 
	`Œaû
('[ '.
$g
.' ] --START--','','INFO');

446 
	`fÜ—ch
 (
$gs
 
as
 
$key
=>
$Çme
) {

447 if(!
	`is_št
(
$key
)) {

448 
$Çme
 = 
$key
;

450 
	`B
(
$Çme
, 
$·¿ms
);

452 if(
APP_DEBUG
) {

453 
	`Œaû
('[ '.
$g
.' ] --END-- [ RunTime:'.
	`G
($tag.'Start',$tag.'End',6).'s ]','','INFO');

456  
çl£
;

458 
	}
}

467 
funùiÚ
 
add_g_behaviÜ
(
$g
,
$behaviÜ
,
$·th
='') {

468 
$¬¿y
 = 
C
('gs.'.
$g
);

469 if(!
	g$¬¿y
) {

470 
	g$¬¿y
 = 
¬¿y
();

472 if(
	g$·th
) {

473 
	g$¬¿y
[
$behaviÜ
] = 
$·th
;

475 
	g$¬¿y
[] = 
$behaviÜ
;

477 
C
('gs.'.
$g
,
$¬¿y
);

486 
funùiÚ
 
	$B
(
$Çme
, &
$·¿ms
=
NULL
) {

487 
$şass
 = 
$Çme
.'Behavior';

488 if(
APP_DEBUG
) {

489 
	`G
('behaviorStart');

491 
$behaviÜ
 = 
Ãw
 
	`$şass
();

492 
$behaviÜ
->
	`run
(
$·¿ms
);

493 if(
APP_DEBUG
) {

494 
	`G
('behaviorEnd');

495 
	`Œaû
('RuÀ'.
$Çme
.' BehaviÜ [ RunTime:'.
	`G
('behaviorStart','behaviorEnd',6).'s ]','','INFO');

497 
	}
}

504 
funùiÚ
 
	$¡r_wh™e¥aû
(
$cÚ‹Á
) {

505 
$¡rSŒ
 = '';

507 
$tok’s
 = 
	`tok’_g‘_®l
(
$cÚ‹Á
);

508 
$Ï¡_¥aû
 = 
çl£
;

509 
$i
 = 0, 
$j
 = 
	`couÁ
(
$tok’s
); $i < $j; $i++) {

510 ià(
	`is_¡ršg
(
$tok’s
[
$i
])) {

511 
$Ï¡_¥aû
 = 
çl£
;

512 
$¡rSŒ
 .ğ
$tok’s
[
$i
];

514 
$tok’s
[
$i
][0]) {

516 
T_COMMENT
:

517 
T_DOC_COMMENT
:

520 
T_WHITESPACE
:

521 ià(!
$Ï¡_¥aû
) {

522 
$¡rSŒ
 .= ' ';

523 
$Ï¡_¥aû
 = 
Œue
;

526 
T_START_HEREDOC
:

527 
$¡rSŒ
 .= "<<<THINK\n";

529 
T_END_HEREDOC
:

530 
$¡rSŒ
 .= "THINK;\n";

531 
$k
 = 
$i
+1; $k < 
$j
; $k++) {

532 if(
	`is_¡ršg
(
$tok’s
[
$k
]) && $tokens[$k] == ';') {

533 
$i
 = 
$k
;

535 } if(
$tok’s
[
$k
][0] =ğ
T_CLOSE_TAG
) {

541 
$Ï¡_¥aû
 = 
çl£
;

542 
$¡rSŒ
 .ğ
$tok’s
[
$i
][1];

546  
$¡rSŒ
;

547 
	}
}

551 
funùiÚ
 
	$compe
(
$f’ame
) {

552 
$cÚ‹Á
 = 
	`fe_g‘_cÚ‹Ás
(
$f’ame
);

554 
$cÚ‹Á
 = 
	`´eg_»¶aû
('/\/\/\[RUNTIME\](.*?)\/\/\[\/RUNTIME\]/s', '', $content);

555 
$cÚ‹Á
 = 
	`sub¡r
(
	`Œim
($content), 5);

556 ià('?>' =ğ
	`sub¡r
(
$cÚ‹Á
, -2))

557 
$cÚ‹Á
 = 
	`sub¡r
($content, 0, -2);

558  
$cÚ‹Á
;

559 
	}
}

562 
funùiÚ
 
	$¬¿y_defše
(
$¬¿y
,
$check
=
Œue
) {

563 
$cÚ‹Á
 = "\n";

564 
	`fÜ—ch
 (
$¬¿y
 
as
 
$key
 => 
$v®
) {

565 
$key
 = 
	`¡¹ouµ”
($key);

566 if(
$check
è
$cÚ‹Á
 .ğ'defšed(\'' . 
$key
 . '\') or ';

567 ià(
	`is_št
(
$v®
è|| 
	`is_æßt
($val)) {

568 
$cÚ‹Á
 .ğ"defše('" . 
$key
 . "'," . 
$v®
 . ');';

569 } 
	`–£if
 (
	`is_boŞ
(
$v®
)) {

570 
$v®
 = ($val) ? 'true' : 'false';

571 
$cÚ‹Á
 .ğ"defše('" . 
$key
 . "'," . 
$v®
 . ');';

572 } 
	`–£if
 (
	`is_¡ršg
(
$v®
)) {

573 
$cÚ‹Á
 .ğ"defše('" . 
$key
 . "','" . 
	`add¦ashes
(
$v®
) . "');";

575 
$cÚ‹Á
 .= "\n";

577  
$cÚ‹Á
;

578 
	}
}

589 
funùiÚ
 
Œaû
(
$v®ue
='[thšk]',
$Ïb–
='',
$Ëv–
='DEBUG',
$»cÜd
=
çl£
) {

590 
$_Œaû
 = 
¬¿y
();

591 if('[thšk]' ==ğ
$v®ue
){

592  
$_Œaû
;

594 
	g$šfo
 = (
$Ïb–
?$Ïb–.':':'').
´št_r
(
$v®ue
,
Œue
);

595 if('ERR' =ğ
$Ëv–
 && 
C
('TRACE_EXCEPTION')) {

596 
throw_exû±iÚ
(
$šfo
);

598 
	g$Ëv–
 = 
¡¹ouµ”
(
$Ëv–
);

599 if(!
is£t
(
$_Œaû
[
$Ëv–
])) {

600 
	g$_Œaû
[
$Ëv–
] = 
¬¿y
();

602 
	g$_Œaû
[
$Ëv–
][] = 
$šfo
;

603 if((
defšed
('IS_AJAX'è&& 
	gIS_AJAX
è|| !
C
('SHOW_PAGE_TRACE'è|| 
	g$»cÜd
) {

604 
	gLog
::
»cÜd
(
$šfo
,
$Ëv–
,
$»cÜd
);

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Common\functions.php

1 <?
php


24 
funùiÚ
 
	$h®t
(
$”rÜ
) {

25 
$e
 = 
	`¬¿y
();

26 ià(
APP_DEBUG
) {

28 ià(!
	`is_¬¿y
(
$”rÜ
)) {

29 
$Œaû
 = 
	`debug_backŒaû
();

30 
$e
['mes§ge'] = 
$”rÜ
;

31 
$e
['fe'] = 
$Œaû
[0]['file'];

32 
$e
['şass'] = 
	`is£t
(
$Œaû
[0]['class'])?$trace[0]['class']:'';

33 
$e
['funùiÚ'] = 
	`is£t
(
$Œaû
[0]['function'])?$trace[0]['function']:'';

34 
$e
['lše'] = 
$Œaû
[0]['line'];

35 
$ŒaûInfo
 = '';

36 
$time
 = 
	`d©e
('y-m-d H:i:m');

37 
	`fÜ—ch
 (
$Œaû
 
as
 
$t
) {

38 
$ŒaûInfo
 .ğ'[' . 
$time
 . '] ' . 
$t
['file'] . ' (' . $t['line'] . ') ';

39 
$ŒaûInfo
 .ğ
$t
['class'] . $t['type'] . $t['function'] . '(';

40 
$ŒaûInfo
 .ğ
	`im¶ode
(', ', 
$t
['args']);

41 
$ŒaûInfo
 .=')<br/>';

43 
$e
['Œaû'] = 
$ŒaûInfo
;

45 
$e
 = 
$”rÜ
;

49 
$”rÜ_·ge
 = 
	`C
('ERROR_PAGE');

50 ià(!
	`em±y
(
$”rÜ_·ge
)) {

51 
	`»dœeù
(
$”rÜ_·ge
);

53 ià(
	`C
('SHOW_ERROR_MSG'))

54 
$e
['mes§ge'] = 
	`is_¬¿y
(
$”rÜ
) ? $error['message'] : $error;

56 
$e
['mes§ge'] = 
	`C
('ERROR_MESSAGE');

60 
šşude
 
	`C
('TMPL_EXCEPTION_FILE');

61 
ex™
;

62 
	}
}

71 
funùiÚ
 
throw_exû±iÚ
(
$msg
, 
$ty³
='ThškExû±iÚ', 
$code
=0) {

72 ià(
şass_exi¡s
(
$ty³
, 
çl£
))

73 
throw
 
Ãw
 
$ty³
(
$msg
, 
$code
, 
Œue
);

75 
h®t
(
$msg
);

86 
funùiÚ
 
	$dump
(
$v¬
, 
$echo
=
Œue
, 
$Ïb–
=
nuÎ
, 
$¡riù
=true) {

87 
$Ïb–
 = ($Ïb– ==ğ
nuÎ
è? '' : 
	`¹rim
($label) . ' ';

88 ià(!
$¡riù
) {

89 ià(
	`ši_g‘
('html_errors')) {

90 
$ouut
 = 
	`´št_r
(
$v¬
, 
Œue
);

91 
$ouut
 = '<´e>' . 
$Ïb–
 . 
	`html¥ecŸlch¬s
($ouut, 
ENT_QUOTES
) . '</pre>';

93 
$ouut
 = 
$Ïb–
 . 
	`´št_r
(
$v¬
, 
Œue
);

96 
	`ob_¡¬t
();

97 
	`v¬_dump
(
$v¬
);

98 
$ouut
 = 
	`ob_g‘_ş—n
();

99 ià(!
	`ex‹nsiÚ_lßded
('xdebug')) {

100 
$ouut
 = 
	`´eg_»¶aû
('/\]\=\>\n(\s+)/m', '] => ', $output);

101 
$ouut
 = '<´e>' . 
$Ïb–
 . 
	`html¥ecŸlch¬s
($ouut, 
ENT_QUOTES
) . '</pre>';

104 ià(
$echo
) {

105 
	`echo
(
$ouut
);

106  
nuÎ
;

108  
$ouut
;

109 
	}
}

119 
funùiÚ
 
_404
(
$msg
='',
$u¾
='') {

120 
APP_DEBUG
 && 
throw_exû±iÚ
(
$msg
);

121 if(
	g$msg
 && 
C
('LOG_EXCEPTION_RECORD')è
	gLog
::
wr™e
(
$msg
);

122 if(
em±y
(
$u¾
è&& 
C
('URL_404_REDIRECT')) {

123 
	g$u¾
 = 
C
('URL_404_REDIRECT');

125 if(
	g$u¾
) {

126 
»dœeù
(
$u¾
);

128 
£nd_h‰p_¡©us
(404);

129 
	gex™
;

138 
funùiÚ
 
	$Ïyout
(
$Ïyout
) {

139 if(
çl£
 !=ğ
$Ïyout
) {

141 
	`C
('LAYOUT_ON',
Œue
);

142 if(
	`is_¡ršg
(
$Ïyout
)) {

143 
	`C
('LAYOUT_NAME',
$Ïyout
);

146 
	`C
('LAYOUT_ON',
çl£
);

148 
	}
}

159 
funùiÚ
 
U
(
$u¾
='',
$v¬s
='',
$suffix
=
Œue
,
$»dœeù
=
çl£
,
$domaš
=false) {

161 
$šfo
 = 
·r£_u¾
(
$u¾
);

162 
	g$u¾
 = !
em±y
(
$šfo
['·th'])?$šfo['·th']:
ACTION_NAME
;

163 if(
is£t
(
$šfo
['fragment'])) {

164 
	g$ªchÜ
 = 
$šfo
['fragment'];

165 if(
	gçl£
 !=ğ
¡½os
(
$ªchÜ
,'?')) {

166 
li¡
(
$ªchÜ
,
$šfo
['qu”y']èğ
ex¶ode
('?',$anchor,2);

168 if(
	gçl£
 !=ğ
¡½os
(
$ªchÜ
,'@')) {

169 
li¡
(
$ªchÜ
,
$ho¡
èğ
ex¶ode
('@',$anchor, 2);

171 }
–£if
(
çl£
 !=ğ
¡½os
(
$u¾
,'@')) {

172 
li¡
(
$u¾
,
$ho¡
èğ
ex¶ode
('@',
$šfo
['path'], 2);

175 if(
is£t
(
$ho¡
)) {

176 
	g$domaš
 = 
$ho¡
.(
¡½os
($ho¡,'.')?'':
¡r¡r
(
$_SERVER
['HTTP_HOST'],'.'));

177 }
–£if
(
$domaš
===
Œue
){

178 
$domaš
 = 
$_SERVER
['HTTP_HOST'];

179 if(
C
('APP_SUB_DOMAIN_DEPLOY') ) {

180 
	g$domaš
 = 
$domaš
=='loÿlho¡'?'loÿlho¡':'www'.
¡r¡r
(
$_SERVER
['HTTP_HOST'],'.');

182 
fÜ—ch
 (
C
('APP_SUB_DOMAIN_RULES'è
as
 
$key
 => 
$ruË
) {

183 if(
çl£
 ==ğ
¡½os
(
$key
,'*'è&& 0==ğ¡½os(
$u¾
,
$ruË
[0])) {

184 
	g$domaš
 = 
$key
.
¡r¡r
(
$domaš
,'.');

185 
	g$u¾
 = 
sub¡r_»¶aû
(
$u¾
,'',0,
¡¾’
(
$ruË
[0]));

193 if(
is_¡ršg
(
$v¬s
)) {

194 
·r£_¡r
(
$v¬s
,$vars);

195 }
–£if
(!
is_¬¿y
(
$v¬s
)){

196 
	g$v¬s
 = 
¬¿y
();

198 if(
is£t
(
$šfo
['query'])) {

199 
·r£_¡r
(
$šfo
['qu”y'],
$·¿ms
);

200 
	g$v¬s
 = 
¬¿y_m”ge
(
$·¿ms
,
$v¬s
);

204 
	g$d•r
 = 
C
('URL_PATHINFO_DEPR');

205 if(
	g$u¾
) {

206 if(0==ğ
¡½os
(
$u¾
,'/')) {

207 
	g$rou‹
 = 
Œue
;

208 
	g$u¾
 = 
sub¡r
(
$u¾
,1);

209 if('/' !ğ
$d•r
) {

210 
$u¾
 = 
¡r_»¶aû
('/',
$d•r
,$url);

213 if('/' !ğ
$d•r
) {

214 
$u¾
 = 
¡r_»¶aû
('/',
$d•r
,$url);

217 
	g$u¾
 = 
Œim
(
$u¾
,
$d•r
);

218 
	g$·th
 = 
ex¶ode
(
$d•r
,
$u¾
);

219 
	g$v¬
 = 
¬¿y
();

220 
	g$v¬
[
C
('VAR_ACTION')] = !
em±y
(
$·th
)?
¬¿y_pİ
($·th):
ACTION_NAME
;

221 
	g$v¬
[
C
('VAR_MODULE')] = !
em±y
(
$·th
)?
¬¿y_pİ
($·th):
MODULE_NAME
;

222 if(
	g$m­s
 = 
C
('URL_ACTION_MAP')) {

223 if(
is£t
(
$m­s
[
¡¹Şow”
(
$v¬
[
C
('VAR_MODULE')])])) {

224 
$m­s
 = $m­s[
¡¹Şow”
(
$v¬
[
C
('VAR_MODULE')])];

225 if(
	g$aùiÚ
 = 
¬¿y_£¬ch
(
¡¹Şow”
(
$v¬
[
C
('VAR_ACTION')]),
$m­s
)){

226 
	g$v¬
[
C
('VAR_ACTION')] = 
$aùiÚ
;

230 if(
	g$m­s
 = 
C
('URL_MODULE_MAP')) {

231 if(
$moduË
 = 
¬¿y_£¬ch
(
¡¹Şow”
(
$v¬
[
C
('VAR_MODULE')]),
$m­s
)){

232 
	g$v¬
[
C
('VAR_MODULE')] = 
$moduË
;

235 if(
C
('URL_CASE_INSENSITIVE')) {

236 
	g$v¬
[
C
('VAR_MODULE')] = 
·r£_Çme
(
$v¬
[C('VAR_MODULE')]);

238 if(!
C
('APP_SUB_DOMAIN_DEPLOY') && C('APP_GROUP_LIST')) {

239 if(!
em±y
(
$·th
)) {

240 
	g$group
 = 
¬¿y_pİ
(
$·th
);

241 
	g$v¬
[
C
('VAR_GROUP')] = 
$group
;

243 if(
	gGROUP_NAME
 !ğ
C
('DEFAULT_GROUP')) {

244 
$v¬
[
C
('VAR_GROUP')]ğ
GROUP_NAME
;

247 if(
C
('URL_CASE_INSENSITIVE'è&& 
is£t
(
$v¬
[C('VAR_GROUP')])) {

248 
	g$v¬
[
C
('VAR_GROUP')] = 
¡¹Şow”
(
$v¬
[C('VAR_GROUP')]);

254 if(
C
('URL_MODEL') == 0) {

255 
$u¾
 = 
__APP__
.'?'.
h‰p_bud_qu”y
(
¬¿y_»v”£
(
$v¬
));

256 if(!
em±y
(
$v¬s
)) {

257 
	g$v¬s
 = 
u¾decode
(
h‰p_bud_qu”y
(
$v¬s
));

258 
	g$u¾
 .ğ'&'.
$v¬s
;

261 if(
is£t
(
$rou‹
)) {

262 
	g$u¾
 = 
__APP__
.'/'.
¹rim
(
$u¾
,
$d•r
);

264 
	g$u¾
 = 
__APP__
.'/'.
im¶ode
(
$d•r
,
¬¿y_»v”£
(
$v¬
));

266 if(!
em±y
(
$v¬s
)) {

267 
fÜ—ch
 (
$v¬s
 
as
 
$v¬
 => 
$v®
){

268 if('' !=ğ
Œim
(
$v®
)è
$u¾
 .ğ
$d•r
 . 
$v¬
 . $d•¸. 
u¾’code
($val);

271 if(
	g$suffix
) {

272 
	g$suffix
 = 
$suffix
===
Œue
?
C
('URL_HTML_SUFFIX'):$suffix;

273 if(
	g$pos
 = 
¡½os
(
$suffix
, '|')){

274 
	g$suffix
 = 
sub¡r
(
$suffix
, 0, 
$pos
);

276 if(
	g$suffix
 && '/' !ğ
sub¡r
(
$u¾
,-1)){

277 
	g$u¾
 .ğ'.'.
Érim
(
$suffix
,'.');

281 if(
is£t
(
$ªchÜ
)){

282 
	g$u¾
 .ğ'#'.
$ªchÜ
;

284 if(
	g$domaš
) {

285 
	g$u¾
 = (
is_s¦
()?'h‰ps://':'h‰p://').
$domaš
.
$u¾
;

287 if(
	g$»dœeù
)

288 
»dœeù
(
$u¾
);

290  
	g$u¾
;

300 
funùiÚ
 
W
(
$Çme
, 
$d©a
=
¬¿y
(), 
$»tuº
=
çl£
) {

301 
$şass
 = 
$Çme
 . 'Widget';

302 
»quœe_ÿche
(
BASE_LIB_PATH
 . 'Widg‘/' . 
$şass
 . '.class.php');

303 ià(!
şass_exi¡s
(
$şass
))

304 
throw_exû±iÚ
(
L
('_CLASS_NOT_EXIST_'è. ':' . 
$şass
);

305 
	g$widg‘
 = 
Thšk
::
š¡ªû
(
$şass
);

306 
	g$cÚ‹Á
 = 
$widg‘
->
»nd”
(
$d©a
);

307 ià(
	g$»tuº
)

308  
	g$cÚ‹Á
;

310 
echo
 
	g$cÚ‹Á
;

319 
funùiÚ
 
	$f‹r
(
$Çme
, &
$cÚ‹Á
) {

320 
$şass
 = 
$Çme
 . 'Filter';

321 
	`»quœe_ÿche
(
BASE_LIB_PATH
 . 'F‹r/' . 
$şass
 . '.class.php');

322 
$f‹r
 = 
Ãw
 
	`$şass
();

323 
$cÚ‹Á
 = 
$f‹r
->
	`run
($content);

324 
	}
}

330 
funùiÚ
 
	$is_s¦
() {

331 if(
	`is£t
(
$_SERVER
['HTTPS']è&& ('1' =ğ$_SERVER['HTTPS'] || 'Ú' =ğ
	`¡¹Şow”
($_SERVER['HTTPS']))){

332  
Œue
;

333 }
	`–£if
(
	`is£t
(
$_SERVER
['SERVER_PORT']) && ('443' == $_SERVER['SERVER_PORT'] )) {

334  
Œue
;

336  
çl£
;

337 
	}
}

346 
funùiÚ
 
»dœeù
(
$u¾
, 
$time
=0, 
$msg
='') {

348 
$u¾
 = 
¡r_»¶aû
(
¬¿y
("\n", "\r"), '', $url);

349 ià(
em±y
(
$msg
))

350 
	g$msg
 = "ç³»ç»Ÿå°†åœ¨{$time}ç§’ä¹‹åè‡ªåŠ¨è·³è½¬åˆ°{$url}ï¼";

351 ià(!
h—d”s_£Á
()) {

353 ià(0 ==ğ
$time
) {

354 
h—d”
('LoÿtiÚ: ' . 
$u¾
);

356 
h—d”
("refresh:{$time};url={$url}");

357 
echo
(
$msg
);

359 
ex™
();

361 
	g$¡r
 = "<meta http-equiv='Refresh' content='{$time};URL={$url}'>";

362 ià(
	g$time
 != 0)

363 
$¡r
 .ğ
$msg
;

364 
ex™
(
$¡r
);

375 
funùiÚ
 
S
(
$Çme
,
$v®ue
='',
$İtiÚs
=
nuÎ
) {

376 
$ÿche
 = '';

377 if(
is_¬¿y
(
$İtiÚs
)){

379 
	g$ty³
 = 
is£t
(
$İtiÚs
['type'])?$options['type']:'';

380 
	g$ÿche
 = 
Cache
::
g‘In¡ªû
(
$ty³
,
$İtiÚs
);

381 }
–£if
(
is_¬¿y
(
$Çme
)) {

382 
	g$ty³
 = 
is£t
(
$Çme
['type'])?$name['type']:'';

383 
	g$ÿche
 = 
Cache
::
g‘In¡ªû
(
$ty³
,
$Çme
);

384  
	g$ÿche
;

385 }
–£if
(
em±y
(
$ÿche
)) {

386 
	g$ÿche
 = 
Cache
::
g‘In¡ªû
();

388 if(''==ğ
$v®ue
){

389  
$ÿche
->
g‘
(
$Çme
);

390 }
–£if
(
is_nuÎ
(
$v®ue
)) {

391  
	g$ÿche
->
rm
(
$Çme
);

393 
	g$expœe
 = 
is_num”ic
(
$İtiÚs
)?$İtiÚs:
NULL
;

394  
	g$ÿche
->
£t
(
$Çme
, 
$v®ue
, 
$expœe
);

398 
funùiÚ
 
ÿche
(
$Çme
,
$v®ue
='',
$İtiÚs
=
nuÎ
){

399  
S
(
$Çme
,
$v®ue
,
$İtiÚs
);

409 
funùiÚ
 
F
(
$Çme
, 
$v®ue
='', 
$·th
=
DATA_PATH
) {

410 
$_ÿche
 = 
¬¿y
();

411 
	g$f’ame
 = 
$·th
 . 
$Çme
 . '.php';

412 ià('' !=ğ
$v®ue
) {

413 ià(
is_nuÎ
(
$v®ue
)) {

415  
çl£
 !=ğ
¡½os
(
$Çme
,'*')?
¬¿y_m­
("uÆšk", 
glob
(
$f’ame
)):
uÆšk
($filename);

418 
	g$dœ
 = 
dœÇme
(
$f’ame
);

420 ià(!
is_dœ
(
$dœ
))

421 
mkdœ
(
$dœ
,0755,
Œue
);

422 
	g$_ÿche
[
$Çme
] = 
$v®ue
;

423  
fe_put_cÚ‹Ás
(
$f’ame
, 
¡r_wh™e¥aû
("<?php\Œ‘uº " . 
v¬_expÜt
(
$v®ue
, 
Œue
) . ";?>"));

426 ià(
is£t
(
$_ÿche
[
$Çme
]))

427  
	g$_ÿche
[
$Çme
];

429 ià(
is_fe
(
$f’ame
)) {

430 
	g$v®ue
 = 
šşude
 
$f’ame
;

431 
	g$_ÿche
[
$Çme
] = 
$v®ue
;

433 
	g$v®ue
 = 
çl£
;

435  
	g$v®ue
;

445 
funùiÚ
 
g‘_š¡ªû_of
(
$Çme
, 
$m‘hod
='', 
$¬gs
=
	$¬¿y
()) {

446 
$_š¡ªû
 = 
	`¬¿y
();

447 
$id’tify
 = 
	`em±y
(
$¬gs
è? 
$Çme
 . 
$m‘hod
 : $Çm. $m‘hod . 
	`to_guid_¡ršg
($args);

448 ià(!
	`is£t
(
$_š¡ªû
[
$id’tify
])) {

449 ià(
	`şass_exi¡s
(
$Çme
)) {

450 
$o
 = 
Ãw
 
	`$Çme
();

451 ià(
	`m‘hod_exi¡s
(
$o
, 
$m‘hod
)) {

452 ià(!
	`em±y
(
$¬gs
)) {

453 
$_š¡ªû
[
$id’tify
] = 
	`ÿÎ_u£r_func_¬¿y
(
	`¬¿y
(&
$o
, 
$m‘hod
), 
$¬gs
);

455 
$_š¡ªû
[
$id’tify
] = 
$o
->
	`$m‘hod
();

459 
$_š¡ªû
[
$id’tify
] = 
$o
;

462 
	`h®t
(
	`L
('_CLASS_NOT_EXIST_'è. ':' . 
$Çme
);

464  
$_š¡ªû
[
$id’tify
];

465 
	}
}

472 
funùiÚ
 
	$to_guid_¡ršg
(
$mix
) {

473 ià(
	`is_objeù
(
$mix
è&& 
	`funùiÚ_exi¡s
('spl_object_hash')) {

474  
	`¥l_objeù_hash
(
$mix
);

475 } 
	`–£if
 (
	`is_»sourû
(
$mix
)) {

476 
$mix
 = 
	`g‘_»sourû_ty³
($mixè. 
	`¡rv®
($mix);

478 
$mix
 = 
	`£rŸlize
($mix);

480  
	`md5
(
$mix
);

481 
	}
}

490 
funùiÚ
 
xml_’code
(
$d©a
, 
$’codšg
='utf-8', 
$roÙ
='think') {

491 
$xml
 = '<?xmÈv”siÚ="1.0"ƒncodšg="' . 
$’codšg
 . '"?>';

492 
	g$xml
 .ğ'<' . 
$roÙ
 . '>';

493 
	g$xml
 .ğ
d©a_to_xml
(
$d©a
);

494 
	g$xml
 .ğ'</' . 
$roÙ
 . '>';

495  
	g$xml
;

503 
funùiÚ
 
	$d©a_to_xml
(
$d©a
) {

504 
$xml
 = '';

505 
	`fÜ—ch
 (
$d©a
 
as
 
$key
 => 
$v®
) {

506 
	`is_num”ic
(
$key
) && $key = "item id=\"$key\"";

507 
$xml
 .= "<$key>";

508 
$xml
 .ğĞ
	`is_¬¿y
(
$v®
è|| 
	`is_objeù
($v®)è? 
	`d©a_to_xml
($val) : $val;

509 
	`li¡
(
$key
, ) = 
	`ex¶ode
(' ', $key);

510 
$xml
 .= "</$key>";

512  
$xml
;

513 
	}
}

521 
funùiÚ
 
£ssiÚ
(
$Çme
,
$v®ue
='') {

522 
$´efix
 = 
C
('SESSION_PREFIX');

523 if(
is_¬¿y
(
$Çme
)) {

524 if(
is£t
(
$Çme
['´efix'])è
C
('SESSION_PREFIX',$name['prefix']);

525 if(
C
('VAR_SESSION_ID'è&& 
is£t
(
$_REQUEST
[C('VAR_SESSION_ID')])){

526 
£ssiÚ_id
(
$_REQUEST
[
C
('VAR_SESSION_ID')]);

527 }
–£if
(
is£t
(
$Çme
['id'])) {

528 
£ssiÚ_id
(
$Çme
['id']);

530 
ši_£t
('session.auto_start', 0);

531 if(
is£t
(
$Çme
['Çme'])è
£ssiÚ_Çme
($name['name']);

532 if(
is£t
(
$Çme
['·th'])è
£ssiÚ_§ve_·th
($name['path']);

533 if(
is£t
(
$Çme
['domaš'])è
ši_£t
('session.cookie_domain', $name['domain']);

534 if(
is£t
(
$Çme
['expœe'])è
ši_£t
('session.gc_maxlifetime', $name['expire']);

535 if(
is£t
(
$Çme
['u£_Œªs_sid'])è
ši_£t
('session.use_trans_sid', $name['use_trans_sid']?1:0);

536 if(
is£t
(
$Çme
['u£_cook›s'])è
ši_£t
('session.use_cookies', $name['use_cookies']?1:0);

537 if(
is£t
(
$Çme
['ÿche_lim™”'])è
£ssiÚ_ÿche_lim™”
($name['cache_limiter']);

538 if(
is£t
(
$Çme
['ÿche_expœe'])è
£ssiÚ_ÿche_expœe
($name['cache_expire']);

539 if(
is£t
(
$Çme
['ty³'])è
C
('SESSION_TYPE',$name['type']);

540 if(
C
('SESSION_TYPE')) {

541 
	g$şass
 = 'SessiÚ'. 
ucwÜds
(
¡¹Şow”
(
C
('SESSION_TYPE')));

543 if(
»quœe_ÿche
(
EXTEND_PATH
.'Driv”/SessiÚ/'.
$şass
.'.class.php')) {

544 
	g$hªd”
 = 
Ãw
 
$şass
();

545 
	g$hªd”
->
execu‹
();

548 
throw_exû±iÚ
(
L
('_CLASS_NOT_EXIST_').': ' . 
$şass
);

552 if(
C
('SESSION_AUTO_START')è
£ssiÚ_¡¬t
();

553 }
–£if
('' ==ğ
$v®ue
){

554 if(0===
¡½os
(
$Çme
,'[')) {

555 if('[·u£]'==
$Çme
){

556 
£ssiÚ_wr™e_şo£
();

557 }
–£if
('[¡¬t]'==
$Çme
){

558 
£ssiÚ_¡¬t
();

559 }
–£if
('[de¡roy]'==
$Çme
){

560 
$_SESSION
 = 
¬¿y
();

561 
£ssiÚ_un£t
();

562 
£ssiÚ_de¡roy
();

563 }
–£if
('[»g’”©e]'==
$Çme
){

564 
£ssiÚ_»g’”©e_id
();

566 }
–£if
(0===
¡½os
(
$Çme
,'?')){

567 
	g$Çme
 = 
sub¡r
(
$Çme
,1);

568 if(
	g$´efix
) {

569  
is£t
(
$_SESSION
[
$´efix
][
$Çme
]);

571  
is£t
(
$_SESSION
[
$Çme
]);

573 }
–£if
(
is_nuÎ
(
$Çme
)){

574 if(
	g$´efix
) {

575 
un£t
(
$_SESSION
[
$´efix
]);

577 
	g$_SESSION
 = 
¬¿y
();

579 }
–£if
(
$´efix
){

580  
is£t
(
$_SESSION
[
$´efix
][
$Çme
])?
	g$_SESSION
[$´efix][$Çme]:
nuÎ
;

582  
is£t
(
$_SESSION
[
$Çme
])?
	g$_SESSION
[$Çme]:
nuÎ
;

584 }
–£if
(
is_nuÎ
(
$v®ue
)){

585 if(
	g$´efix
){

586 
un£t
(
$_SESSION
[
$´efix
][
$Çme
]);

588 
un£t
(
$_SESSION
[
$Çme
]);

591 if(
	g$´efix
){

592 ià(!
is_¬¿y
(
$_SESSION
[
$´efix
])) {

593 
	g$_SESSION
[
$´efix
] = 
¬¿y
();

595 
	g$_SESSION
[
$´efix
][
$Çme
] = 
$v®ue
;

597 
	g$_SESSION
[
$Çme
] = 
$v®ue
;

609 
funùiÚ
 
cook›
(
$Çme
, 
$v®ue
='', 
$İtiÚ
=
nuÎ
) {

611 
$cÚfig
 = 
¬¿y
(

612 '´efix' => 
C
('COOKIE_PREFIX'),

613 'expœe' => 
C
('COOKIE_EXPIRE'),

614 '·th' => 
C
('COOKIE_PATH'),

615 'domaš' => 
C
('COOKIE_DOMAIN'),

618 ià(!
is_nuÎ
(
$İtiÚ
)) {

619 ià(
is_num”ic
(
$İtiÚ
))

620 
	g$İtiÚ
 = 
¬¿y
('expœe' => 
$İtiÚ
);

621 
–£if
 (
is_¡ršg
(
$İtiÚ
))

622 
·r£_¡r
(
$İtiÚ
, $option);

623 
	g$cÚfig
 = 
¬¿y_m”ge
(
$cÚfig
, 
¬¿y_chªge_key_ÿ£
(
$İtiÚ
));

626 ià(
is_nuÎ
(
$Çme
)) {

627 ià(
em±y
(
$_COOKIE
))

630 
	g$´efix
 = 
em±y
(
$v®ue
è? 
$cÚfig
['prefix'] : $value;

631 ià(!
em±y
(
$´efix
)) {

632 
fÜ—ch
 (
$_COOKIE
 
as
 
$key
 => 
$v®
) {

633 ià(0 ==ğ
¡ros
(
$key
, 
$´efix
)) {

634 
£tcook›
(
$key
, '', 
time
(è- 3600, 
$cÚfig
['path'], $config['domain']);

635 
un£t
(
$_COOKIE
[
$key
]);

641 
	g$Çme
 = 
$cÚfig
['´efix'] . 
$Çme
;

642 ià('' ==ğ
$v®ue
) {

643 if(
is£t
(
$_COOKIE
[
$Çme
])){

644 
$v®ue
 = 
$_COOKIE
[
$Çme
];

645 if(0===
¡½os
(
$v®ue
,'think:')){

646 
	g$v®ue
 = 
sub¡r
(
$v®ue
,6);

647  
¬¿y_m­
('u¾decode',
jsÚ_decode
(
MAGIC_QUOTES_GPC
?
¡r¦ashes
(
$v®ue
):$v®ue,
Œue
));

649  
	g$v®ue
;

652  
	gnuÎ
;

655 ià(
is_nuÎ
(
$v®ue
)) {

656 
£tcook›
(
$Çme
, '', 
time
(è- 3600, 
$cÚfig
['path'], $config['domain']);

657 
un£t
(
$_COOKIE
[
$Çme
]);

660 if(
is_¬¿y
(
$v®ue
)){

661 
	g$v®ue
 = 'thšk:'.
jsÚ_’code
(
¬¿y_m­
('u¾’code',
$v®ue
));

663 
	g$expœe
 = !
em±y
(
$cÚfig
['expœe']è? 
time
(è+ 
štv®
($config['expire']) : 0;

664 
£tcook›
(
$Çme
, 
$v®ue
, 
$expœe
, 
$cÚfig
['path'], $config['domain']);

665 
	g$_COOKIE
[
$Çme
] = 
$v®ue
;

674 
funùiÚ
 
	$lßd_ext_fe
() {

676 if(
	`C
('LOAD_EXT_FILE')) {

677 
$fes
 = 
	`ex¶ode
(',',
	`C
('LOAD_EXT_FILE'));

678 
	`fÜ—ch
 (
$fes
 
as
 
$fe
){

679 
$fe
 = 
COMMON_PATH
.$file.'.php';

680 if(
	`is_fe
(
$fe
)è
šşude
 $file;

684 if(
	`C
('LOAD_EXT_CONFIG')) {

685 
$cÚfigs
 = 
	`C
('LOAD_EXT_CONFIG');

686 if(
	`is_¡ršg
(
$cÚfigs
)è$cÚfig ğ
	`ex¶ode
(',',$configs);

687 
	`fÜ—ch
 (
$cÚfigs
 
as
 
$key
=>
$cÚfig
){

688 
$fe
 = 
CONF_PATH
.
$cÚfig
.'.php';

689 if(
	`is_fe
(
$fe
)) {

690 
	`is_num”ic
(
$key
)?
	`C
(
šşude
 
$fe
):C($key,include $file);

694 
	}
}

701 
funùiÚ
 
	$g‘_ş›Á_
(
$ty³
 = 0) {

702 
$ty³
 = $type ? 1 : 0;

703 
$
 = 
NULL
;

704 ià(
$
 !=ğ
NULL
è $[
$ty³
];

705 ià(
	`is£t
(
$_SERVER
['HTTP_X_FORWARDED_FOR'])) {

706 
$¬r
 = 
	`ex¶ode
(',', 
$_SERVER
['HTTP_X_FORWARDED_FOR']);

707 
$pos
 = 
	`¬¿y_£¬ch
('unknown',
$¬r
);

708 if(
çl£
 !=ğ
$pos
è
	`un£t
(
$¬r
[$pos]);

709 
$
 = 
	`Œim
(
$¬r
[0]);

710 }
	`–£if
 (
	`is£t
(
$_SERVER
['HTTP_CLIENT_IP'])) {

711 
$
 = 
$_SERVER
['HTTP_CLIENT_IP'];

712 }
	`–£if
 (
	`is£t
(
$_SERVER
['REMOTE_ADDR'])) {

713 
$
 = 
$_SERVER
['REMOTE_ADDR'];

716 
$lÚg
 = 
	`¥rštf
("%u",
	`2lÚg
(
$
));

717 
$
 = 
$lÚg
 ? 
	`¬¿y
($ip, $long) :‡rray('0.0.0.0', 0);

718  
$
[
$ty³
];

719 
	}
}

726 
funùiÚ
 
	$£nd_h‰p_¡©us
(
$code
) {

727 
$_¡©us
 = 
	`¬¿y
(

741 if(
	`is£t
(
$_¡©us
[
$code
])) {

742 
	`h—d”
('HTTP/1.1 '.
$code
.' '.
$_¡©us
[$code]);

744 
	`h—d”
('Stus:'.
$code
.' '.
$_¡©us
[$code]);

746 
	}
}

749 
funùiÚ
 
	$f‹r_exp
(&
$v®ue
){

750 ià(
	`š_¬¿y
(
	`¡¹Şow”
(
$v®ue
),
	`¬¿y
('exp','or'))){

751 
$v®ue
 .= ' ';

753 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Common\runtime.php

1 <?
php


18 
defšed
('THINK_PATH'è
Ü
 
ex™
();

19 if(
v”siÚ_com·»
(
PHP_VERSION
,'5.2.0','<')è
d›
('require PHP > 5.2.0 !');

22 
defše
('THINK_VERSION', '3.1.2');

25 if(
v”siÚ_com·»
(
PHP_VERSION
,'5.4.0','<')) {

26 
ši_£t
('magic_quotes_runtime',0);

27 
defše
('MAGIC_QUOTES_GPC',
g‘_magic_quÙes_gpc
()?
True
:
F®£
);

29 
defše
('MAGIC_QUOTES_GPC',
çl£
);

31 
defše
('IS_CGI',
sub¡r
(
PHP_SAPI
, 0,3)=='cgi' ? 1 : 0 );

32 
defše
('IS_WIN',
¡r¡r
(
PHP_OS
, 'WIN') ? 1 : 0 );

33 
defše
('IS_CLI',
PHP_SAPI
=='cli'? 1 : 0);

36 
defšed
('APP_NAME'è
Ü
 
defše
('APP_NAME', 
ba£Çme
(
dœÇme
(
$_SERVER
['SCRIPT_FILENAME'])));

38 if(!
	gIS_CLI
) {

40 if(!
defšed
('_PHP_FILE_')) {

41 if(
	gIS_CGI
) {

43 
	g$_‹mp
 = 
ex¶ode
('.php',
$_SERVER
['PHP_SELF']);

44 
defše
('_PHP_FILE_', 
¹rim
(
¡r_»¶aû
(
$_SERVER
['HTTP_HOST'],'',
$_‹mp
[0].'.php'),'/'));

46 
defše
('_PHP_FILE_', 
¹rim
(
$_SERVER
['SCRIPT_NAME'],'/'));

49 if(!
defšed
('__ROOT__')) {

51 ifĞ
¡¹ouµ”
(
APP_NAME
è=ğ¡¹ouµ”(
ba£Çme
(
dœÇme
(
_PHP_FILE_
))) ) {

52 
$_roÙ
 = 
dœÇme
(dœÇme(
_PHP_FILE_
));

54 
	g$_roÙ
 = 
dœÇme
(
_PHP_FILE_
);

56 
defše
('__ROOT__', ((
$_roÙ
=='/' || $_root=='\\')?'':$_root));

60 
defše
('URL_COMMON', 0);

61 
defše
('URL_PATHINFO', 1);

62 
defše
('URL_REWRITE', 2);

63 
defše
('URL_COMPAT', 3);

67 
defšed
('CORE_PATH'è
Ü
 
defše
('CORE_PATH', 
THINK_PATH
.'Lib/');

68 
defšed
('EXTEND_PATH'è
Ü
 
defše
('EXTEND_PATH', 
THINK_PATH
.'Extend/');

69 
defšed
('MODE_PATH'è
Ü
 
defše
('MODE_PATH', 
EXTEND_PATH
.'Mode/');

70 
defšed
('ENGINE_PATH'è
Ü
 
defše
('ENGINE_PATH', 
EXTEND_PATH
.'Engine/');

71 
defšed
('VENDOR_PATH'è
Ü
 
defše
('VENDOR_PATH', 
EXTEND_PATH
.'Vendor/');

72 
defšed
('LIBRARY_PATH'è
Ü
 
defše
('LIBRARY_PATH', 
EXTEND_PATH
.'Library/');

73 
defšed
('COMMON_PATH'è
Ü
 
defše
('COMMON_PATH', 
APP_PATH
.'Common/');

74 
defšed
('LIB_PATH'è
Ü
 
defše
('LIB_PATH', 
APP_PATH
.'Lib/');

75 
defšed
('CONF_PATH'è
Ü
 
defše
('CONF_PATH', 
APP_PATH
.'Conf/');

76 
defšed
('LANG_PATH'è
Ü
 
defše
('LANG_PATH', 
APP_PATH
.'Lang/');

77 
defšed
('TMPL_PATH'è
Ü
 
defše
('TMPL_PATH', 
APP_PATH
.'Tpl/');

78 
defšed
('HTML_PATH'è
Ü
 
defše
('HTML_PATH', 
APP_PATH
.'Html/');

79 
defšed
('LOG_PATH'è
Ü
 
defše
('LOG_PATH', 
RUNTIME_PATH
.'Logs/');

80 
defšed
('TEMP_PATH'è
Ü
 
defše
('TEMP_PATH', 
RUNTIME_PATH
.'Temp/');

81 
defšed
('DATA_PATH'è
Ü
 
defše
('DATA_PATH', 
RUNTIME_PATH
.'Data/');

82 
defšed
('CACHE_PATH'è
Ü
 
defše
('CACHE_PATH', 
RUNTIME_PATH
.'Cache/');

85 
£t_šşude_·th
(
g‘_šşude_·th
(è. 
PATH_SEPARATOR
 . 
VENDOR_PATH
);

88 
funùiÚ
 
	$lßd_ruÁime_fe
() {

90 
»quœe
 
THINK_PATH
.'Common/common.php';

92 
$li¡
 = 
	`¬¿y
(

93 
CORE_PATH
.'Core/Think.class.php',

94 
CORE_PATH
.'Core/ThinkException.class.php',

95 
CORE_PATH
.'Core/Behavior.class.php',

98 
	`fÜ—ch
 (
$li¡
 
as
 
$key
=>
$fe
){

99 if(
	`is_fe
(
$fe
)è
	`»quœe_ÿche
($file);

102 
	`®Ÿs_impÜt
(
šşude
 
THINK_PATH
.'Conf/alias.php');

105 if(!
	`is_dœ
(
LIB_PATH
)) {

107 
	`bud_­p_dœ
();

108 }
	`–£if
(!
	`is_dœ
(
CACHE_PATH
)){

110 
	`check_ruÁime
();

111 }
	`–£if
(
APP_DEBUG
){

113 if(
	`is_fe
(
RUNTIME_FILE
)è
	`uÆšk
(RUNTIME_FILE);

115 
	}
}

118 
funùiÚ
 
	$check_ruÁime
() {

119 if(!
	`is_dœ
(
RUNTIME_PATH
)) {

120 
	`mkdœ
(
RUNTIME_PATH
);

121 }
	`–£if
(!
	`is_wr™—bË
(
RUNTIME_PATH
)) {

122 
	`h—d”
('Content-Type:text/html; charset=utf-8');

123 
	`ex™
('ç›®å½• [ '.
RUNTIME_PATH
.' ] ä¸å¯å†™ï¼');

125 
	`mkdœ
(
CACHE_PATH
);

126 if(!
	`is_dœ
(
LOG_PATH
)è
	`mkdœ
(LOG_PATH);

127 if(!
	`is_dœ
(
TEMP_PATH
)è
	`mkdœ
(TEMP_PATH);

128 if(!
	`is_dœ
(
DATA_PATH
)è
	`mkdœ
(DATA_PATH);

129  
Œue
;

130 
	}
}

133 
funùiÚ
 
bud_ruÁime_ÿche
(
$­³nd
='') {

135 
$defs
 = 
g‘_defšed_cÚ¡ªts
(
TRUE
);

136 
	g$cÚ‹Á
 = '$GLOBALS[\'_beginTime\'] = microtime(TRUE);';

137 if(
defšed
('RUNTIME_DEF_FILE')) {

138 
fe_put_cÚ‹Ás
(
RUNTIME_DEF_FILE
,'<?ph°'.
¬¿y_defše
(
$defs
['user']));

139 
	g$cÚ‹Á
 .ğ'»quœ\''.
RUNTIME_DEF_FILE
.'\';';

141 
	g$cÚ‹Á
 .ğ
¬¿y_defše
(
$defs
['user']);

143 
	g$cÚ‹Á
 .= 'set_include_path(get_include_path() . PATH_SEPARATOR . VENDOR_PATH);';

145 
	g$li¡
 = 
¬¿y
(

146 
THINK_PATH
.'Common/common.php',

147 
CORE_PATH
.'Core/Think.class.php',

148 
CORE_PATH
.'Core/ThinkException.class.php',

149 
CORE_PATH
.'Core/Behavior.class.php',

151 
fÜ—ch
 (
$li¡
 
as
 
$fe
){

152 
	g$cÚ‹Á
 .ğ
compe
(
$fe
);

155 
	g$cÚ‹Á
 .ğ
bud_gs_ÿche
();

157 
	g$®Ÿs
 = 
šşude
 
THINK_PATH
.'Conf/alias.php';

158 
	g$cÚ‹Á
 .ğ'®Ÿs_impÜt('.
v¬_expÜt
(
$®Ÿs
,
Œue
).');';

160 
	g$cÚ‹Á
 .ğ
$­³nd
."\nL(".
v¬_expÜt
(
L
(),
Œue
).");C(".v¬_expÜt(
C
(),true).');G(\'loadTime\');Think::Start();';

161 
fe_put_cÚ‹Ás
(
RUNTIME_FILE
,
¡r_wh™e¥aû
('<?ph°'.
¡r_»¶aû
("defšed('THINK_PATH'èÜƒx™();",' ',
$cÚ‹Á
)));

165 
funùiÚ
 
	$bud_gs_ÿche
() {

166 
$gs
 = 
	`C
('extends');

167 
$cÚ‹Á
 = '';

168 
	`fÜ—ch
 (
$gs
 
as
 
$g
=>
$™em
){

169 
	`fÜ—ch
 (
$™em
 
as
 
$key
=>
$Çme
) {

170 
$cÚ‹Á
 .ğ
	`is_št
(
$key
)?
	`compe
(
CORE_PATH
.'BehaviÜ/'.
$Çme
.'Behavior.class.php'):compile($name);

173  
$cÚ‹Á
;

174 
	}
}

177 
funùiÚ
 
	$bud_­p_dœ
() {

179 if(!
	`is_dœ
(
APP_PATH
)è
	`mkdœ
(APP_PATH,0755,
Œue
);

180 if(
	`is_wr™—bË
(
APP_PATH
)) {

181 
$dœs
 = 
	`¬¿y
(

182 
LIB_PATH
,

183 
RUNTIME_PATH
,

184 
CONF_PATH
,

185 
COMMON_PATH
,

186 
LANG_PATH
,

187 
CACHE_PATH
,

188 
TMPL_PATH
,

189 
TMPL_PATH
.
	`C
('DEFAULT_THEME').'/',

190 
LOG_PATH
,

191 
TEMP_PATH
,

192 
DATA_PATH
,

193 
LIB_PATH
.'Model/',

194 
LIB_PATH
.'Action/',

195 
LIB_PATH
.'Behavior/',

196 
LIB_PATH
.'Widget/',

198 
	`fÜ—ch
 (
$dœs
 
as
 
$dœ
){

199 if(!
	`is_dœ
(
$dœ
)è
	`mkdœ
($dœ,0755,
Œue
);

202 
	`bud_dœ_£cu»
(
$dœs
);

204 if(!
	`is_fe
(
CONF_PATH
.'config.php'))

205 
	`fe_put_cÚ‹Ás
(
CONF_PATH
.'config.php',"<?php\nreturn‡rray(\n\t//'é…ç½®é¡¹'=>'é…ç½®å€¼'\n);\n?>");

207 if(!
	`is_fe
(
LIB_PATH
.'Action/IndexAction.class.php'))

208 
	`bud_fœ¡_aùiÚ
();

210 
	`h—d”
('Content-Type:text/html; charset=utf-8');

211 
	`ex™
('é¡¹ç›®ç›®å½•ä¸å¯å†™ï¼Œç›®å½•æ— æ³•è‡ªåŠ¨ç”Ÿæˆï¼<BR>è¯·ä½¿ç”¨é¡¹ç›®ç”Ÿæˆå™¨æˆ–è€…æ‰‹åŠ¨ç”Ÿæˆé¡¹ç›®ç›®å½•~');

213 
	}
}

216 
funùiÚ
 
	$bud_fœ¡_aùiÚ
() {

217 
$cÚ‹Á
 = 
	`fe_g‘_cÚ‹Ás
(
THINK_PATH
.'Tpl/default_index.tpl');

218 
	`fe_put_cÚ‹Ás
(
LIB_PATH
.'AùiÚ/IndexAùiÚ.şass.php',
$cÚ‹Á
);

219 
	}
}

222 
funùiÚ
 
bud_dœ_£cu»
(
$dœs
='') {

224 if(
defšed
('BUILD_DIR_SECURE'è&& 
BUILD_DIR_SECURE
) {

225 
defšed
('DIR_SECURE_FILENAME'è
Ü
 
defše
('DIR_SECURE_FILENAME', 'index.html');

226 
defšed
('DIR_SECURE_CONTENT'è
Ü
 
defše
('DIR_SECURE_CONTENT', ' ');

228 
	g$cÚ‹Á
 = 
DIR_SECURE_CONTENT
;

229 
	g$fes
 = 
ex¶ode
(',', 
DIR_SECURE_FILENAME
);

230 
fÜ—ch
 (
$fes
 
as
 
$f’ame
){

231 
fÜ—ch
 (
$dœs
 
as
 
$dœ
)

232 
fe_put_cÚ‹Ás
(
$dœ
.
$f’ame
,
$cÚ‹Á
);

238 
lßd_ruÁime_fe
();

240 
G
('loadTime');

242 
	gThšk
::
S¹
();

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Conf\alias.php

1 <?
php


12 
defšed
('THINK_PATH'è
Ü
 
ex™
();

14  
¬¿y
(

15 'Mod–' => 
CORE_PATH
.'Core/Model.class.php',

16 'Db' => 
CORE_PATH
.'Core/Db.class.php',

17 'Log' => 
CORE_PATH
.'Core/Log.class.php',

18 'ThškTem¶©e' => 
CORE_PATH
.'Template/ThinkTemplate.class.php',

19 'TagLib' => 
CORE_PATH
.'Template/TagLib.class.php',

20 'Cache' => 
CORE_PATH
.'Core/Cache.class.php',

21 'Widg‘' => 
CORE_PATH
.'Core/Widget.class.php',

22 'TagLibCx' => 
CORE_PATH
.'Driver/TagLib/TagLibCx.class.php',

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Conf\convention.php

1 <?
php


22 
defšed
('THINK_PATH'è
Ü
 
ex™
();

23  
¬¿y
(

26 'APP_FILE_CASE' => 
çl£
,

28 'APP_TAGS_ON' => 
Œue
,

29 'APP_SUB_DOMAIN_DEPLOY' => 
çl£
,

30 'APP_SUB_DOMAIN_RULES' => 
¬¿y
(),

31 'APP_SUB_DOMAIN_DENY' => 
¬¿y
(),

66 'DB_FIELDTYPE_CHECK' => 
çl£
,

67 'DB_FIELDS_CACHE' => 
Œue
,

70 'DB_RW_SEPARATE' => 
çl£
,

73 'DB_SQL_BUILD_CACHE' => 
çl£
,

76 'DB_SQL_LOG' => 
çl£
,

80 'DATA_CACHE_COMPRESS' => 
çl£
,

81 'DATA_CACHE_CHECK' => 
çl£
,

84 'DATA_CACHE_PATH' => 
TEMP_PATH
,

85 'DATA_CACHE_SUBDIR' => 
çl£
,

91 'SHOW_ERROR_MSG' => 
çl£
,

92 'TRACE_EXCEPTION' => 
çl£
,

95 'LOG_RECORD' => 
çl£
,

101 'LOG_EXCEPTION_RECORD' => 
çl£
,

104 'SESSION_AUTO_START' => 
Œue
,

105 'SESSION_OPTIONS' => 
¬¿y
(),

112 'TMPL_ACTION_ERROR' => 
THINK_PATH
.'Tpl/dispatch_jump.tpl',

113 'TMPL_ACTION_SUCCESS' => 
THINK_PATH
.'Tpl/dispatch_jump.tpl',

114 'TMPL_EXCEPTION_FILE' => 
THINK_PATH
.'Tpl/think_exception.tpl',

115 'TMPL_DETECT_THEME' => 
çl£
,

120 'URL_CASE_INSENSITIVE' => 
çl£
,

126 'URL_PARAMS_BIND' => 
Œue
,

140 'OUTPUT_ENCODE' => 
Œue
,

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Conf\debug.php

1 <?
php


20 
defšed
('THINK_PATH'è
Ü
 
ex™
();

22  
¬¿y
(

23 'LOG_RECORD' => 
Œue
,

24 'LOG_EXCEPTION_RECORD' => 
Œue
,

26 'DB_FIELDS_CACHE' => 
çl£
,

27 'DB_SQL_LOG' => 
Œue
,

28 'APP_FILE_CASE' => 
Œue
,

29 'TMPL_CACHE_ON' => 
çl£
,

30 'TMPL_STRIP_SPACE' => 
çl£
,

31 'SHOW_ERROR_MSG' => 
Œue
,

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Conf\tags.php

1 <?
php


13  
¬¿y
(

14 '­p_š™' => 
¬¿y
(

16 '­p_begš' => 
¬¿y
(

19 'rou‹_check' => 
¬¿y
(

22 '­p_’d' => 
¬¿y
(),

23 '·th_šfo' => 
¬¿y
(),

24 'aùiÚ_begš' => 
¬¿y
(),

25 'aùiÚ_’d' => 
¬¿y
(),

26 'v›w_begš' => 
¬¿y
(),

27 'v›w_‹m¶©e' => 
¬¿y
(

30 'v›w_·r£' => 
¬¿y
(

33 'v›w_f‹r' => 
¬¿y
(

39 'v›w_’d' => 
¬¿y
(

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lang\en-us.php

1 <?
php


19  
¬¿y
(

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lang\zh-cn.php

1 <?
php


18  
¬¿y
(

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Behavior\CheckRouteBehavior.class.php

1 <?
php


12 
defšed
('THINK_PATH'è
Ü
 
ex™
();

20 şas 
	cCheckRou‹BehaviÜ
 
ex‹nds
 
	mBehaviÜ
 {

22 
´Ùeùed
 
	m$İtiÚs
 = 
¬¿y
(

23 'URL_ROUTER_ON' => 
çl£
,

24 'URL_ROUTE_RULES' => 
¬¿y
(),

28 
public
 
funùiÚ
 
	$run
(&
$»tuº
){

30 
$»gx
 = 
	`Œim
(
$_SERVER
['PATH_INFO'],'/');

31 if(
	`em±y
(
$»gx
)è 
$»tuº
 = 
Œue
;

33 if(!
	`C
('URL_ROUTER_ON')è 
$»tuº
 = 
çl£
;

35 
$rou‹s
 = 
	`C
('URL_ROUTE_RULES');

37 if(!
	`em±y
(
$rou‹s
)) {

38 
$d•r
 = 
	`C
('URL_PATHINFO_DEPR');

40 
$»gx
 = 
	`¡r_»¶aû
(
$d•r
,'/',$regx);

41 
	`fÜ—ch
 (
$rou‹s
 
as
 
$ruË
=>
$rou‹
){

42 if(0===
	`¡½os
(
$ruË
,'/'è&& 
	`´eg_m©ch
($ruË,
$»gx
,
$m©ches
)) {

43  
$»tuº
 = 
$this
->
	`·r£Regex
(
$m©ches
,
$rou‹
,
$»gx
);

45 
$Ën1
 = 
	`sub¡r_couÁ
(
$»gx
,'/');

46 
$Ën2
 = 
	`sub¡r_couÁ
(
$ruË
,'/');

47 if(
$Ën1
>=
$Ën2
) {

48 if('$' =ğ
	`sub¡r
(
$ruË
,-1,1)) {

49 if(
$Ën1
 !ğ
$Ën2
) {

52 
$ruË
 = 
	`sub¡r
($rule,0,-1);

55 
$m©ch
 = 
$this
->
	`checkU¾M©ch
(
$»gx
,
$ruË
);

56 if(
$m©ch
è 
$»tuº
 = 
$this
->
	`·r£RuË
(
$ruË
,
$rou‹
,
$»gx
);

61 
$»tuº
 = 
çl£
;

65 
´iv©e
 
funùiÚ
 
	$checkU¾M©ch
(
$»gx
,
$ruË
) {

66 
$m1
 = 
	`ex¶ode
('/',
$»gx
);

67 
$m2
 = 
	`ex¶ode
('/',
$ruË
);

68 
$m©ch
 = 
Œue
;

69 
	`fÜ—ch
 (
$m2
 
as
 
$key
=>
$v®
){

70 if(':' =ğ
	`sub¡r
(
$v®
,0,1)) {

71 if(
	`¡½os
(
$v®
,'\\')) {

72 
$ty³
 = 
	`sub¡r
(
$v®
,-1);

73 if('d'==
$ty³
 && !
	`is_num”ic
(
$m1
[
$key
])) {

74 
$m©ch
 = 
çl£
;

77 }
	`–£if
(
	`¡½os
(
$v®
,'^')){

78 
$¬¿y
 = 
	`ex¶ode
('|',
	`sub¡r
(
	`¡r¡r
(
$v®
,'^'),1));

79 if(
	`š_¬¿y
(
$m1
[
$key
],
$¬¿y
)) {

80 
$m©ch
 = 
çl£
;

84 }
	`–£if
(0 !=ğ
	`¡rÿ£cmp
(
$v®
,
$m1
[
$key
])){

85 
$m©ch
 = 
çl£
;

89  
$m©ch
;

90 
	}
}

94 
´iv©e
 
funùiÚ
 
	$·r£U¾
(
$u¾
) {

95 
$v¬
 = 
	`¬¿y
();

96 if(
çl£
 !=ğ
	`¡½os
(
$u¾
,'?')) {

97 
$šfo
 = 
	`·r£_u¾
(
$u¾
);

98 
$·th
 = 
	`ex¶ode
('/',
$šfo
['path']);

99 
	`·r£_¡r
(
$šfo
['qu”y'],
$v¬
);

100 }
	`–£if
(
	`¡½os
(
$u¾
,'/')){

101 
$·th
 = 
	`ex¶ode
('/',
$u¾
);

103 
	`·r£_¡r
(
$u¾
,
$v¬
);

105 if(
	`is£t
(
$·th
)) {

106 
$v¬
[
	`C
('VAR_ACTION')] = 
	`¬¿y_pİ
(
$·th
);

107 if(!
	`em±y
(
$·th
)) {

108 
$v¬
[
	`C
('VAR_MODULE')] = 
	`¬¿y_pİ
(
$·th
);

110 if(!
	`em±y
(
$·th
)) {

111 
$v¬
[
	`C
('VAR_GROUP')] = 
	`¬¿y_pİ
(
$·th
);

114  
$v¬
;

115 
	}
}

126 
´iv©e
 
funùiÚ
 
	$·r£RuË
(
$ruË
,
$rou‹
,
$»gx
) {

128 
$u¾
 = 
	`is_¬¿y
(
$rou‹
)?$route[0]:$route;

130 
$·ths
 = 
	`ex¶ode
('/',
$»gx
);

132 
$m©ches
 = 
	`¬¿y
();

133 
$ruË
 = 
	`ex¶ode
('/',$rule);

134 
	`fÜ—ch
 (
$ruË
 
as
 
$™em
){

135 if(0===
	`¡½os
(
$™em
,':')) {

136 if(
$pos
 = 
	`¡½os
(
$™em
,'^') ) {

137 
$v¬
 = 
	`sub¡r
(
$™em
,1,
$pos
-1);

138 }
	`–£if
(
	`¡½os
(
$™em
,'\\')){

139 
$v¬
 = 
	`sub¡r
(
$™em
,1,-2);

141 
$v¬
 = 
	`sub¡r
(
$™em
,1);

143 
$m©ches
[
$v¬
] = 
	`¬¿y_shiá
(
$·ths
);

145 
	`¬¿y_shiá
(
$·ths
);

148 if(0==ğ
	`¡½os
(
$u¾
,'/') || 0===strpos($url,'http')) {

149 if(
	`¡½os
(
$u¾
,':')) {

150 
$v®ues
 = 
	`¬¿y_v®ues
(
$m©ches
);

151 
$u¾
 = 
	`´eg_»¶aû
('/:(\d+)/e','$values[\\1-1]',$url);

153 
	`h—d”
("LoÿtiÚ: $u¾", 
Œue
,(
	`is_¬¿y
(
$rou‹
è&& 
	`is£t
($route[1]))?$route[1]:301);

154 
ex™
;

157 
$v¬
 = 
$this
->
	`·r£U¾
(
$u¾
);

159 
$v®ues
 = 
	`¬¿y_v®ues
(
$m©ches
);

160 
	`fÜ—ch
 (
$v¬
 
as
 
$key
=>
$v®
){

161 if(0===
	`¡½os
(
$v®
,':')) {

162 
$v¬
[
$key
] = 
$v®ues
[
	`sub¡r
(
$v®
,1)-1];

165 
$v¬
 = 
	`¬¿y_m”ge
(
$m©ches
,$var);

167 if(
$·ths
) {

168 
	`´eg_»¶aû
('@(\w+)\/([^\/]+)@e', '$v¬[¡¹Şow”(\'\\1\')]=¡r_gs(\'\\2\');', 
	`im¶ode
('/',
$·ths
));

171 if(
	`is_¬¿y
(
$rou‹
è&& 
	`is£t
($route[1])) {

172 
	`·r£_¡r
(
$rou‹
[1],
$·¿ms
);

173 
$v¬
 = 
	`¬¿y_m”ge
($v¬,
$·¿ms
);

175 
$_GET
 = 
	`¬¿y_m”ge
(
$v¬
,$_GET);

177  
Œue
;

178 
	}
}

188 
´iv©e
 
funùiÚ
 
	$·r£Regex
(
$m©ches
,
$rou‹
,
$»gx
) {

190 
$u¾
 = 
	`is_¬¿y
(
$rou‹
)?$route[0]:$route;

191 
$u¾
 = 
	`´eg_»¶aû
('/:(\d+)/e','$matches[\\1]',$url);

192 if(0==ğ
	`¡½os
(
$u¾
,'/') || 0===strpos($url,'http')) {

193 
	`h—d”
("LoÿtiÚ: $u¾", 
Œue
,(
	`is_¬¿y
(
$rou‹
è&& 
	`is£t
($route[1]))?$route[1]:301);

194 
ex™
;

197 
$v¬
 = 
$this
->
	`·r£U¾
(
$u¾
);

199 
$»gx
 = 
	`sub¡r_»¶aû
($»gx,'',0,
	`¡¾’
(
$m©ches
[0]));

200 if(
$»gx
) {

201 
	`´eg_»¶aû
('@(\w+)\/([^,\/]+)@e', '$v¬[¡¹Şow”(\'\\1\')]=¡r_gs(\'\\2\');', 
$»gx
);

204 if(
	`is_¬¿y
(
$rou‹
è&& 
	`is£t
($route[1])) {

205 
	`·r£_¡r
(
$rou‹
[1],
$·¿ms
);

206 
$v¬
 = 
	`¬¿y_m”ge
($v¬,
$·¿ms
);

208 
$_GET
 = 
	`¬¿y_m”ge
(
$v¬
,$_GET);

210  
Œue
;

211 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Behavior\ContentReplaceBehavior.class.php

1 <?
php


12 
defšed
('THINK_PATH'è
Ü
 
ex™
();

20 şas 
	cCÚ‹ÁR•ÏûBehaviÜ
 
ex‹nds
 
	mBehaviÜ
 {

22 
´Ùeùed
 
	m$İtiÚs
 = 
¬¿y
(

23 'TMPL_PARSE_STRING' => 
¬¿y
(),

27 
public
 
funùiÚ
 
	$run
(&
$cÚ‹Á
){

28 
$cÚ‹Á
 = 
$this
->
	`‹m¶©eCÚ‹ÁR•Ïû
($content);

37 
´Ùeùed
 
funùiÚ
 
	$‹m¶©eCÚ‹ÁR•Ïû
(
$cÚ‹Á
) {

39 
$»¶aû
 = 
	`¬¿y
(

40 '__TMPL__' => 
APP_TMPL_PATH
,

41 '__ROOT__' => 
__ROOT__
,

42 '__APP__' => 
__APP__
,

43 '__GROUP__' => 
	`defšed
('GROUP_NAME')?
__GROUP__
:
__APP__
,

44 '__ACTION__' => 
__ACTION__
,

45 '__SELF__' => 
__SELF__
,

46 '__URL__' => 
__URL__
,

47 '../Public' => 
APP_TMPL_PATH
.'Public',

48 '__PUBLIC__' => 
__ROOT__
.'/Public',

51 if(
	`is_¬¿y
(
	`C
('TMPL_PARSE_STRING')) )

52 
$»¶aû
 = 
	`¬¿y_m”ge
($»¶aû,
	`C
('TMPL_PARSE_STRING'));

53 
$cÚ‹Á
 = 
	`¡r_»¶aû
(
	`¬¿y_keys
(
$»¶aû
),
	`¬¿y_v®ues
($replace),$content);

54  
$cÚ‹Á
;

55 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Behavior\LocationTemplateBehavior.class.php

1 <?
php


12 
defšed
('THINK_PATH'è
Ü
 
ex™
();

20 şas 
	cLoÿtiÚTem¶©eBehaviÜ
 
ex‹nds
 
	mBehaviÜ
 {

22 
public
 
funùiÚ
 
	$run
(&
$‹m¶©eFe
){

24 if(!
	`fe_exi¡s_ÿ£
(
$‹m¶©eFe
))

25 
$‹m¶©eFe
 = 
$this
->
	`·r£Tem¶©eFe
($templateFile);

34 
´iv©e
 
funùiÚ
 
	$·r£Tem¶©eFe
(
$‹m¶©eFe
) {

35 if(''==
$‹m¶©eFe
) {

37 
$‹m¶©eFe
 = 
	`C
('TEMPLATE_NAME');

38 }
	`–£if
(
çl£
 ==ğ
	`¡½os
(
$‹m¶©eFe
,
	`C
('TMPL_TEMPLATE_SUFFIX'))){

40 
$·th
 = 
	`ex¶ode
(':',
$‹m¶©eFe
);

41 
$aùiÚ
 = 
	`¬¿y_pİ
(
$·th
);

42 
$moduË
 = !
	`em±y
(
$·th
)?
	`¬¿y_pİ
($·th):
MODULE_NAME
;

43 if(!
	`em±y
(
$·th
)) {

44 
$·th
 = 
	`dœÇme
(
THEME_PATH
).'/'.
	`¬¿y_pİ
($path).'/';

46 
$·th
 = 
THEME_PATH
;

48 
$‹m¶©eFe
 = 
$·th
.
$moduË
.
	`C
('TMPL_FILE_DEPR').
$aùiÚ
.C('TMPL_TEMPLATE_SUFFIX');

50 if(!
	`fe_exi¡s_ÿ£
(
$‹m¶©eFe
))

51 
	`throw_exû±iÚ
(
	`L
('_TEMPLATE_NOT_EXIST_').'['.
$‹m¶©eFe
.']');

52  
$‹m¶©eFe
;

53 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Behavior\ParseTemplateBehavior.class.php

1 <?
php


12 
defšed
('THINK_PATH'è
Ü
 
ex™
();

20 şas 
	cP¬£Tem¶©eBehaviÜ
 
ex‹nds
 
	mBehaviÜ
 {

22 
´Ùeùed
 
	m$İtiÚs
 = 
¬¿y
(

27 'TMPL_DENY_PHP' => 
çl£
,

31 'TMPL_STRIP_SPACE' => 
Œue
,

32 'TMPL_CACHE_ON' => 
Œue
,

36 'LAYOUT_ON' => 
çl£
,

42 'TAGLIB_LOAD' => 
Œue
,

48 
public
 
funùiÚ
 
	$run
(&
$_d©a
){

49 
$’gše
 = 
	`¡¹Şow”
(
	`C
('TMPL_ENGINE_TYPE'));

50 
$_cÚ‹Á
 = 
	`em±y
(
$_d©a
['content'])?$_data['file']:$_data['content'];

51 
$_d©a
['´efix'] = !
	`em±y
($_d©a['´efix'])?$_d©a['´efix']:
	`C
('TMPL_CACHE_PREFIX');

52 if('thšk'==
$’gše
){

53 if((!
	`em±y
(
$_d©a
['cÚ‹Á']è&& 
$this
->
	`checkCÚ‹ÁCache
($_data['content'],$_data['prefix']))

54 || 
$this
->
	`checkCache
(
$_d©a
['file'],$_data['prefix'])) {

56 
	`exŒaù
(
$_d©a
['v¬'], 
EXTR_OVERWRITE
);

58 
šşude
 
	`C
('CACHE_PATH').
$_d©a
['´efix'].
	`md5
(
$_cÚ‹Á
).C('TMPL_CACHFILE_SUFFIX');

60 
$l
 = 
Thšk
::
	`š¡ªû
('ThinkTemplate');

62 
$l
->
	`ãtch
(
$_cÚ‹Á
,
$_d©a
['var'],$_data['prefix']);

66 
$şass
 = 'Tem¶©e'.
	`ucwÜds
(
$’gše
);

67 if(
	`şass_exi¡s
(
$şass
)) {

68 
$l
 = 
Ãw
 
$şass
;

69 
$l
->
	`ãtch
(
$_cÚ‹Á
,
$_d©a
['var']);

71 
	`throw_exû±iÚ
(
	`L
('_NOT_SUPPERT_').': ' . 
$şass
);

83 
´Ùeùed
 
funùiÚ
 
	`checkCache
(
$tm¶Tem¶©eFe
,
$´efix
='') {

84 ià(!
	`C
('TMPL_CACHE_ON'))

85  
çl£
;

86 
$tm¶CacheFe
 = 
	`C
('CACHE_PATH').
$´efix
.
	`md5
(
$tm¶Tem¶©eFe
).C('TMPL_CACHFILE_SUFFIX');

87 if(!
	`is_fe
(
$tm¶CacheFe
)){

88  
çl£
;

89 }
	`–£if
 (
	`femtime
(
$tm¶Tem¶©eFe
è> femtime(
$tm¶CacheFe
)) {

91  
çl£
;

92 }
	`–£if
 (
	`C
('TMPL_CACHE_TIME'è!ğ0 && 
	`time
(è> 
	`femtime
(
$tm¶CacheFe
)+C('TMPL_CACHE_TIME')) {

94  
çl£
;

97 if(
	`C
('LAYOUT_ON')) {

98 
$ÏyoutFe
 = 
THEME_PATH
.
	`C
('LAYOUT_NAME').C('TMPL_TEMPLATE_SUFFIX');

99 if(
	`femtime
(
$ÏyoutFe
è> femtime(
$tm¶CacheFe
)) {

100  
çl£
;

104  
Œue
;

105 
	}
}

114 
´Ùeùed
 
funùiÚ
 
checkCÚ‹ÁCache
(
$tm¶CÚ‹Á
,
$´efix
='') {

115 if(
is_fe
(
C
('CACHE_PATH').
$´efix
.
md5
(
$tm¶CÚ‹Á
).C('TMPL_CACHFILE_SUFFIX'))){

116  
Œue
;

118  
	gçl£
;

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Behavior\ReadHtmlCacheBehavior.class.php

1 <?
php


12 
defšed
('THINK_PATH'è
Ü
 
ex™
();

20 şas 
	cR—dHtmlCacheBehaviÜ
 
ex‹nds
 
	mBehaviÜ
 {

21 
´Ùeùed
 
	m$İtiÚs
 = 
¬¿y
(

22 'HTML_CACHE_ON' => 
çl£
,

24 'HTML_CACHE_RULES' => 
¬¿y
(),

29 
public
 
funùiÚ
 
	$run
(&
$·¿ms
){

31 if(
	`C
('HTML_CACHE_ON')) {

32 
$ÿcheTime
 = 
$this
->
	`»quœeHtmlCache
();

33 ifĞ
çl£
 !=ğ
$ÿcheTime
 && 
$this
->
	`checkHTMLCache
(
HTML_FILE_NAME
,$cacheTime)) {

35 
	`»adfe
(
HTML_FILE_NAME
);

36 
	`ex™
();

42 
´iv©e
 
funùiÚ
 
	$»quœeHtmlCache
() {

44 
$htmls
 = 
	`C
('HTML_CACHE_RULES');

45 if(!
	`em±y
(
$htmls
)) {

46 
$htmls
 = 
	`¬¿y_chªge_key_ÿ£
($htmls);

50 
$moduËName
 = 
	`¡¹Şow”
(
MODULE_NAME
);

51 
$aùiÚName
 = 
	`¡¹Şow”
(
ACTION_NAME
);

52 if(
	`is£t
(
$htmls
[
$moduËName
.':'.
$aùiÚName
])) {

53 
$html
 = 
$htmls
[
$moduËName
.':'.
$aùiÚName
];

54 }
	`–£if
(
	`is£t
(
$htmls
[
$moduËName
.':'])){

55 
$html
 = 
$htmls
[
$moduËName
.':'];

56 }
	`–£if
(
	`is£t
(
$htmls
[
$aùiÚName
])){

57 
$html
 = 
$htmls
[
$aùiÚName
];

58 }
	`–£if
(
	`is£t
(
$htmls
['*'])){

59 
$html
 = 
$htmls
['*'];

60 }
	`–£if
(
	`is£t
(
$htmls
['em±y:šdex']è&& !
	`şass_exi¡s
(
MODULE_NAME
.'Action')){

61 
$html
 = 
$htmls
['empty:index'];

62 }
	`–£if
(
	`is£t
(
$htmls
[
$moduËName
.':_em±y']è&& 
$this
->
	`isEm±yAùiÚ
(
MODULE_NAME
,
ACTION_NAME
)){

63 
$html
 = 
$htmls
[
$moduËName
.':_empty'];

65 if(!
	`em±y
(
$html
)) {

67 
$ruË
 = 
$html
[0];

69 
$ruË
 = 
	`´eg_»¶aû
('/{\$(_\w+)\.(\w+)\|(\w+)}/e',"\\3(\$\\1['\\2'])",$rule);

70 
$ruË
 = 
	`´eg_»¶aû
('/{\$(_\w+)\.(\w+)}/e',"\$\\1['\\2']",$rule);

72 
$ruË
 = 
	`´eg_»¶aû
('/{(\w+)\|(\w+)}/e',"\\2(\$_GET['\\1'])",$rule);

73 
$ruË
 = 
	`´eg_»¶aû
('/{(\w+)}/e',"\$_GET['\\1']",$rule);

75 
$ruË
 = 
	`¡r_œ•Ïû
(

76 
	`¬¿y
('{:app}','{:module}','{:action}','{:group}'),

77 
	`¬¿y
(
APP_NAME
,
MODULE_NAME
,
ACTION_NAME
,
	`defšed
('GROUP_NAME')?
GROUP_NAME
:''),

78 
$ruË
);

80 
$ruË
 = 
	`´eg_»¶aû
('/{|(\w+)}/e',"\\1()",$rule);

81 if(!
	`em±y
(
$html
[2])è
$ruË
 = $html[2]($rule);

82 
$ÿcheTime
 = 
	`is£t
(
$html
[1])?$html[1]:
	`C
('HTML_CACHE_TIME');

84 
	`defše
('HTML_FILE_NAME',
HTML_PATH
 . 
$ruË
.
	`C
('HTML_FILE_SUFFIX'));

85  
$ÿcheTime
;

89  
çl£
;

90 
	}
}

100 
public
 
funùiÚ
 
checkHTMLCache
(
$ÿcheFe
='',
$ÿcheTime
='') {

101 if(!
is_fe
(
$ÿcheFe
)){

102  
çl£
;

103 }
–£if
 (
femtime
(
C
('TEMPLATE_NAME')è> femtime(
$ÿcheFe
)) {

105  
	gçl£
;

106 }
–£if
(!
is_num”ic
(
$ÿcheTime
è&& 
funùiÚ_exi¡s
($cacheTime)){

107  
$ÿcheTime
(
$ÿcheFe
);

108 }
–£if
 (
$ÿcheTime
 !ğ0 && 
NOW_TIME
 > 
femtime
(
$ÿcheFe
)+$cacheTime) {

110  
çl£
;

113  
	gŒue
;

117 
´iv©e
 
funùiÚ
 
	$isEm±yAùiÚ
(
$moduË
,
$aùiÚ
) {

118 
$şassName
 = 
$moduË
.'Action';

119 
$şass
 = 
Ãw
 
$şassName
;

120  !
	`m‘hod_exi¡s
(
$şass
,
$aùiÚ
);

121 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Behavior\ShowPageTraceBehavior.class.php

1 <?
php


12 
defšed
('THINK_PATH'è
Ü
 
ex™
();

20 şas 
	cShowPageT¿ûBehaviÜ
 
ex‹nds
 
	mBehaviÜ
 {

22 
´Ùeùed
 
	m$İtiÚs
 = 
¬¿y
(

23 'SHOW_PAGE_TRACE' => 
çl£
,

24 'TRACE_PAGE_TABS' => 
¬¿y
('BASE'=>'åŸºæœ¬','FILE'=>'æ–‡ä»¶','INFO'=>'æµç¨‹','ERR|NOTIC'=>'é”™è¯¯','SQL'=>'SQL','DEBUG'=>'è°ƒè¯•'),

25 'PAGE_TRACE_SAVE' => 
çl£
,

29 
public
 
funùiÚ
 
	$run
(&
$·¿ms
){

30 if(!
IS_AJAX
 && 
	`C
('SHOW_PAGE_TRACE')) {

31 
echo
 
$this
->
	`showT¿û
();

39 
´iv©e
 
funùiÚ
 
	$showT¿û
() {

41 
$fes
 = 
	`g‘_šşuded_fes
();

42 
$šfo
 = 
	`¬¿y
();

43 
	`fÜ—ch
 (
$fes
 
as
 
$key
=>
$fe
){

44 
$šfo
[] = 
$fe
.' ( '.
	`numb”_fÜm©
(
	`fesize
($file)/1024,2).' KB )';

46 
$Œaû
 = 
	`¬¿y
();

47 
$ba£
 = 
	`¬¿y
(

48 'è¯·æ±‚ä¿¡æ¯' => 
	`d©e
('Y-m-d H:i:s',
$_SERVER
['REQUEST_TIME']).' '.$_SERVER['SERVER_PROTOCOL'].' '.$_SERVER['REQUEST_METHOD'].' : '.
__SELF__
,

49 'è¿è¡Œæ—¶é—´' => 
$this
->
	`showTime
(),

50 'å†…å­˜å¼€é”€' => 
MEMORY_LIMIT_ON
?
	`numb”_fÜm©
((
	`memÜy_g‘_u§ge
(è- 
$GLOBALS
['_startUseMems'])/1024,2).' kb':'ä¸æ”¯æŒ',

51 'æŸ¥è¯¢ä¿¡æ¯' => 
	`N
('db_query').' queries '.N('db_write').' writes ',

52 'æ–‡ä»¶åŠ è½½' => 
	`couÁ
(
	`g‘_šşuded_fes
()),

53 'ç¼“å­˜ä¿¡æ¯' => 
	`N
('cache_read').' gets '.N('cache_write').' writes ',

54 'é…ç½®åŠ è½½' => 
	`couÁ
(
	`c
()),

55 'ä¼šè¯ä¿¡æ¯' => 'SESSION_ID='.
	`£ssiÚ_id
(),

58 
$ŒaûFe
 = 
CONF_PATH
.'trace.php';

59 if(
	`is_fe
(
$ŒaûFe
)) {

60 
$ba£
 = 
	`¬¿y_m”ge
($ba£,
šşude
 
$ŒaûFe
);

62 
$debug
 = 
	`Œaû
();

63 
$bs
 = 
	`C
('TRACE_PAGE_TABS');

64 
	`fÜ—ch
 (
$bs
 
as
 
$Çme
=>
$t™Ë
){

65 
	`¡¹ouµ”
(
$Çme
)) {

67 
$Œaû
[
$t™Ë
] = 
$ba£
;

70 
$Œaû
[
$t™Ë
] = 
$šfo
;

73 
$Çme
 = 
	`¡¹ouµ”
($name);

74 if(
	`¡½os
(
$Çme
,'|')) {

75 
$¬¿y
 = 
	`ex¶ode
('|',
$Çme
);

76 
$»suÉ
 = 
	`¬¿y
();

77 
	`fÜ—ch
(
$¬¿y
 
as
 
$Çme
){

78 
$»suÉ
 +ğ
	`is£t
(
$debug
[
$Çme
])?$debug[$Çme]:
	`¬¿y
();

80 
$Œaû
[
$t™Ë
] = 
$»suÉ
;

82 
$Œaû
[
$t™Ë
] = 
	`is£t
(
$debug
[
$Çme
])?$debug[$name]:'';

86 if(
$§ve
 = 
	`C
('PAGE_TRACE_SAVE')) {

87 if(
	`is_¬¿y
(
$§ve
)) {

88 
$bs
 = 
	`C
('TRACE_PAGE_TABS');

89 
$¬¿y
 = 
	`¬¿y
();

90 
	`fÜ—ch
 (
$§ve
 
as
 
$b
){

91 
$¬¿y
[] = 
$bs
[
$b
];

94 
$cÚ‹Á
 = 
	`d©e
('[ c ]').' '.
	`g‘_ş›Á_
().' '.
$_SERVER
['REQUEST_URI']."\r\n";

95 
	`fÜ—ch
 (
$Œaû
 
as
 
$key
=>
$v®
){

96 if(!
	`is£t
(
$¬¿y
è|| 
	`š_¬¿y
(
$key
,$array)) {

97 
$cÚ‹Á
 .ğ'[ '.
$key
." ]\r\n";

98 if(
	`is_¬¿y
(
$v®
)) {

99 
	`fÜ—ch
 (
$v®
 
as
 
$k
=>
$v
){

100 
$cÚ‹Á
 .ğ(!
	`is_num”ic
(
$k
)?$k.':':'').
	`´št_r
(
$v
,
Œue
)."\r\n";

103 
$cÚ‹Á
 .ğ
	`´št_r
(
$v®
,
Œue
)."\r\n";

105 
$cÚ‹Á
 .= "\r\n";

108 
	`”rÜ_log
(
	`¡r_»¶aû
('<br/>',"\r\n",
$cÚ‹Á
), 
Log
::
FILE
,
LOG_PATH
.
	`d©e
('y_m_d').'_trace.log');

110 
	`un£t
(
$fes
,
$šfo
,
$ba£
);

112 
	`ob_¡¬t
();

113 
šşude
 
	`C
('TMPL_TRACE_FILE')?C('TMPL_TRACE_FILE'):
THINK_PATH
.'Tpl/page_trace.tpl';

114  
	`ob_g‘_ş—n
();

115 
	}
}

120 
´iv©e
 
funùiÚ
 
	$showTime
() {

122 
	`G
('begšTime',
$GLOBALS
['_beginTime']);

123 
	`G
('viewEndTime');

125  
	`G
('beginTime','viewEndTime').'s ( Load:'.G('beginTime','loadTime').'s Init:'.G('loadTime','initTime').'s Exec:'.G('initTime','viewStartTime').'s Template:'.G('viewStartTime','viewEndTime').'s )';

126 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Behavior\ShowRuntimeBehavior.class.php

1 <?
php


12 
defšed
('THINK_PATH'è
Ü
 
ex™
();

20 şas 
	cShowRuÁimeBehaviÜ
 
ex‹nds
 
	mBehaviÜ
 {

22 
´Ùeùed
 
	m$İtiÚs
 = 
¬¿y
(

23 'SHOW_RUN_TIME' => 
çl£
,

24 'SHOW_ADV_TIME' => 
çl£
,

25 'SHOW_DB_TIMES' => 
çl£
,

26 'SHOW_CACHE_TIMES' => 
çl£
,

27 'SHOW_USE_MEM' => 
çl£
,

28 'SHOW_LOAD_FILE' => 
çl£
,

29 'SHOW_FUN_TIMES' => 
çl£
 ,

33 
public
 
funùiÚ
 
	$run
(&
$cÚ‹Á
){

34 if(
	`C
('SHOW_RUN_TIME')){

35 if(
çl£
 !=ğ
	`¡½os
(
$cÚ‹Á
,'{__NORUNTIME__}')) {

36 
$cÚ‹Á
 = 
	`¡r_»¶aû
('{__NORUNTIME__}','',$content);

38 
$ruÁime
 = 
$this
->
	`showTime
();

39 if(
	`¡½os
(
$cÚ‹Á
,'{__RUNTIME__}'))

40 
$cÚ‹Á
 = 
	`¡r_»¶aû
('{__RUNTIME__}',
$ruÁime
,$content);

42 
$cÚ‹Á
 .ğ
$ruÁime
;

45 
$cÚ‹Á
 = 
	`¡r_»¶aû
(
	`¬¿y
('{__NORUNTIME__}','{__RUNTIME__}'),'',$content);

54 
´iv©e
 
funùiÚ
 
	$showTime
() {

56 
	`G
('begšTime',
$GLOBALS
['_beginTime']);

57 
	`G
('viewEndTime');

58 
$showTime
 = 'Proûss: '.
	`G
('beginTime','viewEndTime').'s ';

59 if(
	`C
('SHOW_ADV_TIME')) {

61 
$showTime
 .ğ'ĞLßd:'.
	`G
('beginTime','loadTime').'s Init:'.G('loadTime','initTime').'s Exec:'.G('initTime','viewStartTime').'s Template:'.G('viewStartTime','viewEndTime').'s )';

63 if(
	`C
('SHOW_DB_TIMES'è&& 
	`şass_exi¡s
('Db',
çl£
) ) {

65 
$showTime
 .ğ' | DB :'.
	`N
('db_query').' queries '.N('db_write').' writes ';

67 if(
	`C
('SHOW_CACHE_TIMES'è&& 
	`şass_exi¡s
('Cache',
çl£
)) {

69 
$showTime
 .ğ' | Cach:'.
	`N
('cache_read').' gets '.N('cache_write').' writes ';

71 if(
MEMORY_LIMIT_ON
 && 
	`C
('SHOW_USE_MEM')) {

73 
$showTime
 .ğ' | U£Mem:'. 
	`numb”_fÜm©
((
	`memÜy_g‘_u§ge
(è- 
$GLOBALS
['_startUseMems'])/1024).' kb';

75 if(
	`C
('SHOW_LOAD_FILE')) {

76 
$showTime
 .ğ' | LßdFe:'.
	`couÁ
(
	`g‘_šşuded_fes
());

78 if(
	`C
('SHOW_FUN_TIMES')) {

79 
$fun
 = 
	`g‘_defšed_funùiÚs
();

80 
$showTime
 .ğ' | C®lFun:'.
	`couÁ
(
$fun
['user']).','.count($fun['internal']);

82  
$showTime
;

83 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Behavior\TokenBuildBehavior.class.php

1 <?
php


12 
defšed
('THINK_PATH'è
Ü
 
ex™
();

20 şas 
	cTok’BudBehaviÜ
 
ex‹nds
 
	mBehaviÜ
 {

22 
´Ùeùed
 
	m$İtiÚs
 = 
¬¿y
(

23 'TOKEN_ON' => 
çl£
,

26 'TOKEN_RESET' => 
Œue
,

29 
public
 
funùiÚ
 
	$run
(&
$cÚ‹Á
){

30 if(
	`C
('TOKEN_ON')) {

31 if(
	`¡½os
(
$cÚ‹Á
,'{__TOKEN__}')) {

33 
$cÚ‹Á
 = 
	`¡r_»¶aû
('{__TOKEN__}',
$this
->
	`budTok’
(),$content);

34 }
	`–£if
(
	`´eg_m©ch
('/<\/fÜm(\s*)>/is',
$cÚ‹Á
,
$m©ch
)) {

36 
$cÚ‹Á
 = 
	`¡r_»¶aû
(
$m©ch
[0],
$this
->
	`budTok’
().$match[0],$content);

39 
$cÚ‹Á
 = 
	`¡r_»¶aû
('{__TOKEN__}','',$content);

44 
´iv©e
 
funùiÚ
 
	$budTok’
() {

45 
$tok’Name
 = 
	`C
('TOKEN_NAME');

46 
$tok’Ty³
 = 
	`C
('TOKEN_TYPE');

47 if(!
	`is£t
(
$_SESSION
[
$tok’Name
])) {

48 
$_SESSION
[
$tok’Name
] = 
	`¬¿y
();

51 
$tok’Key
 = 
	`md5
(
$_SERVER
['REQUEST_URI']);

52 if(
	`is£t
(
$_SESSION
[
$tok’Name
][
$tok’Key
])) {

53 
$tok’V®ue
 = 
$_SESSION
[
$tok’Name
][
$tok’Key
];

55 
$tok’V®ue
 = 
	`$tok’Ty³
(
	`miüÙime
(
TRUE
));

56 
$_SESSION
[
$tok’Name
][
$tok’Key
] = 
$tok’V®ue
;

58 
$tok’
 = '<špuˆty³="hidd’"‚ame="'.
$tok’Name
.'" v®ue="'.
$tok’Key
.'_'.
$tok’V®ue
.'" />';

59  
$tok’
;

60 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Behavior\WriteHtmlCacheBehavior.class.php

1 <?
php


12 
defšed
('THINK_PATH'è
Ü
 
ex™
();

20 şas 
	cWr™eHtmlCacheBehaviÜ
 
ex‹nds
 
	mBehaviÜ
 {

23 
public
 
funùiÚ
 
	$run
(&
$cÚ‹Á
){

24 if(
	`C
('HTML_CACHE_ON'è&& 
	`defšed
('HTML_FILE_NAME')) {

28 if(!
	`is_dœ
(
	`dœÇme
(
HTML_FILE_NAME
)))

29 
	`mkdœ
(
	`dœÇme
(
HTML_FILE_NAME
),0755,
Œue
);

30 ifĞ
çl£
 ==ğ
	`fe_put_cÚ‹Ás
Ğ
HTML_FILE_NAME
 , 
$cÚ‹Á
 ))

31 
	`throw_exû±iÚ
(
	`L
('_CACHE_WRITE_ERROR_').':'.
HTML_FILE_NAME
);

34 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\Action.class.php

1 <?
php


19 
ab¡¿ù
 cÏs 
	cAùiÚ
 {

26 
´Ùeùed
 
	m$v›w
 = 
nuÎ
;

33 
´iv©e
 
	m$Çme
 = '';

40 
´Ùeùed
 
	m$tV¬
 = 
¬¿y
();

47 
´Ùeùed
 
	m$cÚfig
 = 
¬¿y
();

53 
public
 
funùiÚ
 
	$__cÚ¡ruù
() {

54 
	`g
('aùiÚ_begš',
$this
->
cÚfig
);

56 if(
	`m‘hod_exi¡s
(
$this
,'_initialize'))

57 
$this
->
	`_š™Ÿlize
();

64 
´Ùeùed
 
funùiÚ
 
	$g‘AùiÚName
() {

65 if(
	`em±y
(
$this
->
Çme
)) {

67 
$this
->
Çme
 = 
	`sub¡r
(
	`g‘_şass
($this),0,-6);

69  
$this
->
Çme
;

70 
	}
}

77 
´Ùeùed
 
funùiÚ
 
	$isAjax
() {

78 if(
	`is£t
(
$_SERVER
['HTTP_X_REQUESTED_WITH']) ) {

79 if('xmlh‰´eque¡' =ğ
	`¡¹Şow”
(
$_SERVER
['HTTP_X_REQUESTED_WITH']))

80  
Œue
;

82 if(!
	`em±y
(
$_POST
[
	`C
('VAR_AJAX_SUBMIT')]è|| !em±y(
$_GET
[C('VAR_AJAX_SUBMIT')]))

84  
Œue
;

85  
çl£
;

86 
	}
}

99 
´Ùeùed
 
funùiÚ
 
di¥Ïy
(
$‹m¶©eFe
='',
$ch¬£t
='',
$cÚ‹ÁTy³
='',
$cÚ‹Á
='',
$´efix
='') {

100 
$this
->
š™V›w
();

101 
	g$this
->
	gv›w
->
di¥Ïy
(
$‹m¶©eFe
,
$ch¬£t
,
$cÚ‹ÁTy³
,
$cÚ‹Á
,
$´efix
);

113 
´Ùeùed
 
funùiÚ
 
show
(
$cÚ‹Á
,
$ch¬£t
='',
$cÚ‹ÁTy³
='',
$´efix
='') {

114 
$this
->
š™V›w
();

115 
	g$this
->
	gv›w
->
di¥Ïy
('',
$ch¬£t
,
$cÚ‹ÁTy³
,
$cÚ‹Á
,
$´efix
);

128 
´Ùeùed
 
funùiÚ
 
ãtch
(
$‹m¶©eFe
='',
$cÚ‹Á
='',
$´efix
='') {

129 
$this
->
š™V›w
();

130  
	g$this
->
	gv›w
->
ãtch
(
$‹m¶©eFe
,
$cÚ‹Á
,
$´efix
);

138 
´iv©e
 
funùiÚ
 
	$š™V›w
(){

140 if(!
$this
->
v›w
è$this->v›w = 
Thšk
::
	`š¡ªû
('View');

142 if(
$this
->
tV¬
è$this->
v›w
->
	`assign
($this->tVar);

143 
	}
}

154 
´Ùeùed
 
funùiÚ
 
budHtml
(
$htmlfe
='',
$htmÍ©h
='',
$‹m¶©eFe
='') {

155 
$cÚ‹Á
 = 
$this
->
ãtch
(
$‹m¶©eFe
);

156 
	g$htmÍ©h
 = !
em±y
(
$htmÍ©h
)?$htmÍ©h:
HTML_PATH
;

157 
	g$htmlfe
 = 
$htmÍ©h
.
$htmlfe
.
C
('HTML_FILE_SUFFIX');

158 if(!
is_dœ
(
dœÇme
(
$htmlfe
)))

160 
mkdœ
(
dœÇme
(
$htmlfe
),0755,
Œue
);

161 if(
	gçl£
 ==ğ
fe_put_cÚ‹Ás
(
$htmlfe
,
$cÚ‹Á
))

162 
throw_exû±iÚ
(
L
('_CACHE_WRITE_ERROR_').':'.
$htmlfe
);

163  
	g$cÚ‹Á
;

173 
´Ùeùed
 
funùiÚ
 
assign
(
$Çme
,
$v®ue
='') {

174 if(
is_¬¿y
(
$Çme
)) {

175 
$this
->
tV¬
 = 
¬¿y_m”ge
($this->tV¬,
$Çme
);

177 
	g$this
->
	gtV¬
[
$Çme
] = 
$v®ue
;

181 
public
 
funùiÚ
 
	$__£t
(
$Çme
,
$v®ue
) {

182 
$this
->
	`assign
(
$Çme
,
$v®ue
);

183 
	}
}

191 
public
 
funùiÚ
 
g‘
(
$Çme
='') {

192 if('' ==ğ
$Çme
) {

193  
$this
->
tV¬
;

195  
is£t
(
$this
->
tV¬
[
$Çme
])?
	g$this
->
	gtV¬
[$Çme]:
çl£
;

198 
public
 
funùiÚ
 
	$__g‘
(
$Çme
) {

199  
$this
->
	`g‘
(
$Çme
);

200 
	}
}

208 
public
 
funùiÚ
 
	$__is£t
(
$Çme
) {

209  
	`is£t
(
$this
->
tV¬
[
$Çme
]);

210 
	}
}

219 
public
 
funùiÚ
 
	$__ÿÎ
(
$m‘hod
,
$¬gs
) {

220 ifĞ0 ==ğ
	`¡rÿ£cmp
(
$m‘hod
,
ACTION_NAME
.
	`C
('ACTION_SUFFIX'))) {

221 if(
	`m‘hod_exi¡s
(
$this
,'_empty')) {

223 
$this
->
	`_em±y
(
$m‘hod
,
$¬gs
);

224 }
	`–£if
(
	`fe_exi¡s_ÿ£
(
	`C
('TEMPLATE_NAME'))){

226 
$this
->
	`di¥Ïy
();

227 }
	`–£if
(
	`funùiÚ_exi¡s
('__hack_action')) {

229 
	`__hack_aùiÚ
();

231 
	`_404
(
	`L
('_ERROR_ACTION_').':'.
ACTION_NAME
);

234 
	`¡¹Şow”
(
$m‘hod
)) {

241  
	`¡¹Şow”
(
$_SERVER
['REQUEST_METHOD']è=ğ¡¹Şow”(
	`sub¡r
(
$m‘hod
,2));

243 '_g‘' : 
$šput
 =& 
$_GET
;;

244 '_po¡' : 
$šput
 =& 
$_POST
;;

245 '_put' : 
	`·r£_¡r
(
	`fe_g‘_cÚ‹Ás
('php://šput'), 
$šput
);;

247 
$_SERVER
['REQUEST_METHOD']) {

249 
$šput
 = 
$_POST
;

252 
	`·r£_¡r
(
	`fe_g‘_cÚ‹Ás
('php://šput'), 
$šput
);

255 
$šput
 = 
$_GET
;

257 if(
	`C
('VAR_URL_PARAMS')){

258 
$·¿ms
 = 
$_GET
[
	`C
('VAR_URL_PARAMS')];

259 
$šput
 = 
	`¬¿y_m”ge
($šput,
$·¿ms
);

262 '_»que¡' : 
$šput
 =& 
$_REQUEST
; ;

263 '_£ssiÚ' : 
$šput
 =& 
$_SESSION
; ;

264 '_cook›' : 
$šput
 =& 
$_COOKIE
; ;

265 '_£rv”' : 
$šput
 =& 
$_SERVER
; ;

266 '_glob®s' : 
$šput
 =& 
$GLOBALS
; ;

268 
	`throw_exû±iÚ
(
__CLASS__
.':'.
$m‘hod
.
	`L
('_METHOD_NOT_EXIST_'));

270 if(!
	`is£t
(
$¬gs
[0])) {

271 
$d©a
 = 
$šput
;

272 }
	`–£if
(
	`is£t
(
$šput
[
$¬gs
[0]])) {

273 
$d©a
 = 
$šput
[
$¬gs
[0]];

274 
$f‹rs
 = 
	`is£t
(
$¬gs
[1])?$¬gs[1]:
	`C
('DEFAULT_FILTER');

275 if(
$f‹rs
) {

276 
$f‹rs
 = 
	`ex¶ode
(',',$filters);

277 
	`fÜ—ch
(
$f‹rs
 
as
 
$f‹r
){

278 if(
	`funùiÚ_exi¡s
(
$f‹r
)) {

279 
$d©a
 = 
	`is_¬¿y
($d©a)?
	`¬¿y_m­
(
$f‹r
,$d©a):
	`$f‹r
($data);

284 
$d©a
 = 
	`is£t
(
$¬gs
[2])?$¬gs[2]:
NULL
;

286  
$d©a
;

288 
	}
}

298 
´Ùeùed
 
funùiÚ
 
”rÜ
(
$mes§ge
,
$jumpU¾
='',
$ajax
=
çl£
) {

299 
$this
->
di¥©chJump
(
$mes§ge
,0,
$jumpU¾
,
$ajax
);

310 
´Ùeùed
 
funùiÚ
 
sucûss
(
$mes§ge
,
$jumpU¾
='',
$ajax
=
çl£
) {

311 
$this
->
di¥©chJump
(
$mes§ge
,1,
$jumpU¾
,
$ajax
);

321 
´Ùeùed
 
funùiÚ
 
ajaxR‘uº
(
$d©a
,
$ty³
='') {

322 if(
func_num_¬gs
()>2) {

323 
$¬gs
 = 
func_g‘_¬gs
();

324 
¬¿y_shiá
(
$¬gs
);

325 
	g$šfo
 = 
¬¿y
();

326 
	g$šfo
['d©a'] = 
$d©a
;

327 
	g$šfo
['šfo'] = 
¬¿y_shiá
(
$¬gs
);

328 
	g$šfo
['¡©us'] = 
¬¿y_shiá
(
$¬gs
);

329 
	g$d©a
 = 
$šfo
;

330 
	g$ty³
 = 
$¬gs
?
¬¿y_shiá
($args):'';

332 if(
em±y
(
$ty³
)è
	g$ty³
 = 
C
('DEFAULT_AJAX_RETURN');

333 
¡¹ouµ”
(
$ty³
)){

336 
h—d”
('Content-Type:application/json; charset=utf-8');

337 
ex™
(
jsÚ_’code
(
$d©a
));

340 
h—d”
('Content-Type:text/xml; charset=utf-8');

341 
ex™
(
xml_’code
(
$d©a
));

344 
h—d”
('Content-Type:application/json; charset=utf-8');

345 
	g$hªdËr
 = 
is£t
(
$_GET
[
C
('VAR_JSONP_HANDLER')]) ? $_GET[C('VAR_JSONP_HANDLER')] : C('DEFAULT_JSONP_HANDLER');

346 
ex™
(
$hªdËr
.'('.
jsÚ_’code
(
$d©a
).');');

349 
h—d”
('Content-Type:text/html; charset=utf-8');

350 
ex™
(
$d©a
);

353 
g
('ajax_»tuº',
$d©a
);

366 
´Ùeùed
 
funùiÚ
 
»dœeù
(
$u¾
,
$·¿ms
=
¬¿y
(),
$d–ay
=0,
$msg
='') {

367 
$u¾
 = 
U
($u¾,
$·¿ms
);

368 
»dœeù
(
$u¾
,
$d–ay
,
$msg
);

382 
´iv©e
 
funùiÚ
 
di¥©chJump
(
$mes§ge
,
$¡©us
=1,
$jumpU¾
='',
$ajax
=
çl£
) {

383 if(
Œue
 ==ğ
$ajax
 || 
IS_AJAX
) {

384 
$d©a
 = 
is_¬¿y
(
$ajax
)?$ajax:
¬¿y
();

385 
	g$d©a
['šfo'] = 
$mes§ge
;

386 
	g$d©a
['¡©us'] = 
$¡©us
;

387 
	g$d©a
['u¾'] = 
$jumpU¾
;

388 
	g$this
->
ajaxR‘uº
(
$d©a
);

390 if(
is_št
(
$ajax
)è
	g$this
->
assign
('waitSecond',$ajax);

391 if(!
em±y
(
$jumpU¾
)è
	g$this
->
assign
('jumpUrl',$jumpUrl);

393 
	g$this
->
assign
('msgT™Ë',
$¡©us
? 
L
('_OPERATION_SUCCESS_') : L('_OPERATION_FAIL_'));

395 if(
	g$this
->
g‘
('şo£Wš')è$this->
assign
('jumpUrl','javascript:window.close();');

396 
	g$this
->
assign
('¡©us',
$¡©us
);

398 
C
('HTML_CACHE_ON',
çl£
);

399 if(
	g$¡©us
) {

400 
	g$this
->
assign
('mes§ge',
$mes§ge
);

402 if(!
is£t
(
$this
->
wa™SecÚd
)è
	g$this
->
assign
('waitSecond','1');

404 if(!
is£t
(
$this
->
jumpU¾
)è
	g$this
->
assign
("jumpU¾",
$_SERVER
["HTTP_REFERER"]);

405 
	g$this
->
di¥Ïy
(
C
('TMPL_ACTION_SUCCESS'));

407 
	g$this
->
assign
('”rÜ',
$mes§ge
);

409 if(!
is£t
(
$this
->
wa™SecÚd
)è
	g$this
->
assign
('waitSecond','3');

411 if(!
is£t
(
$this
->
jumpU¾
)è
	g$this
->
assign
('jumpUrl',"javascript:history.back(-1);");

412 
	g$this
->
di¥Ïy
(
C
('TMPL_ACTION_ERROR'));

414 
	gex™
 ;

422 
public
 
funùiÚ
 
	$__de¡ruù
() {

424 if(
	`C
('LOG_RECORD')è
Log
::
	`§ve
();

426 
	`g
('action_end');

427 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\App.class.php

1 <?
php


20 şas 
	cAµ
 {

27 
public
 
funùiÚ
 
	$š™
() {

29 
	`d©e_deçuÉ_timezÚe_£t
(
	`C
('DEFAULT_TIMEZONE'));

31 
	`lßd_ext_fe
();

33 
Di¥©ch”
::
	`di¥©ch
();

36 
	`defše
('NOW_TIME', 
$_SERVER
['REQUEST_TIME']);

37 
	`defše
('REQUEST_METHOD',
$_SERVER
['REQUEST_METHOD']);

38 
	`defše
('IS_GET', 
REQUEST_METHOD
 =='GET' ? 
Œue
 : 
çl£
);

39 
	`defše
('IS_POST', 
REQUEST_METHOD
 =='POST' ? 
Œue
 : 
çl£
);

40 
	`defše
('IS_PUT', 
REQUEST_METHOD
 =='PUT' ? 
Œue
 : 
çl£
);

41 
	`defše
('IS_DELETE', 
REQUEST_METHOD
 =='DELETE' ? 
Œue
 : 
çl£
);

42 
	`defše
('IS_AJAX', ((
	`is£t
(
$_SERVER
['HTTP_X_REQUESTED_WITH']è&& 
	`¡¹Şow”
($_SERVER['HTTP_X_REQUESTED_WITH']è=ğ'xmlh‰´eque¡'è|| !
	`em±y
(
$_POST
[
	`C
('VAR_AJAX_SUBMIT')]è|| !em±y(
$_GET
[C('VAR_AJAX_SUBMIT')])è? 
Œue
 : 
çl£
);

45 
	`g
('url_dispatch');

47 if(
	`C
('OUTPUT_ENCODE')){

48 
$zlib
 = 
	`ši_g‘
('zlib.output_compression');

49 if(
	`em±y
(
$zlib
)è
	`ob_¡¬t
('ob_gzhandler');

52 if(
	`C
('VAR_FILTERS')) {

53 
$f‹rs
 = 
	`ex¶ode
(',',
	`C
('VAR_FILTERS'));

54 
	`fÜ—ch
(
$f‹rs
 
as
 
$f‹r
){

56 
	`¬¿y_w®k_»cursive
(
$_POST
,
$f‹r
);

57 
	`¬¿y_w®k_»cursive
(
$_GET
,
$f‹r
);

62 
$‹m¶©eS‘
 = 
	`C
('DEFAULT_THEME');

63 if(
	`C
('TMPL_DETECT_THEME')) {

64 
$t
 = 
	`C
('VAR_TEMPLATE');

65 ià(
	`is£t
(
$_GET
[
$t
])){

66 
$‹m¶©eS‘
 = 
$_GET
[
$t
];

67 }
	`–£if
(
	`cook›
('think_template')){

68 
$‹m¶©eS‘
 = 
	`cook›
('think_template');

70 if(!
	`š_¬¿y
(
$‹m¶©eS‘
,
	`ex¶ode
(',',
	`C
('THEME_LIST')))){

71 
$‹m¶©eS‘
 = 
	`C
('DEFAULT_THEME');

73 
	`cook›
('thšk_‹m¶©e',
$‹m¶©eS‘
,864000);

76 
	`defše
('THEME_NAME', 
$‹m¶©eS‘
);

77 
$group
 = 
	`defšed
('GROUP_NAME')?
GROUP_NAME
.'/':'';

78 if(1==
	`C
('APP_GROUP_MODE')){

79 
	`defše
('THEME_PATH', 
BASE_LIB_PATH
.
	`ba£Çme
(
TMPL_PATH
).'/'.(
THEME_NAME
?THEME_NAME.'/':''));

80 
	`defše
('APP_TMPL_PATH',
__ROOT__
.'/'.
APP_NAME
.(APP_NAME?'/':'').
	`C
('APP_GROUP_PATH').'/'.
$group
.
	`ba£Çme
(
TMPL_PATH
).'/'.(
THEME_NAME
?THEME_NAME.'/':''));

82 
	`defše
('THEME_PATH', 
TMPL_PATH
.
$group
.(
THEME_NAME
?THEME_NAME.'/':''));

83 
	`defše
('APP_TMPL_PATH',
__ROOT__
.'/'.
APP_NAME
.(APP_NAME?'/':'').
	`ba£Çme
(
TMPL_PATH
).'/'.
$group
.(
THEME_NAME
?THEME_NAME.'/':''));

86 
	`C
('CACHE_PATH',
CACHE_PATH
.
$group
);

88 
	`C
('TMPL_EXCEPTION_FILE',
	`»®·th
(C('TMPL_EXCEPTION_FILE')));

97 
public
 
funùiÚ
 
	$exec
() {

98 if(!
	`´eg_m©ch
('/^[A-Za-z](\w)*$/',
MODULE_NAME
)){

99 
$moduË
 = 
çl£
;

102 
$group
 = 
	`defšed
('GROUP_NAME'è&& 
	`C
('APP_GROUP_MODE')==0 ? 
GROUP_NAME
.'/' : '';

103 
$moduË
 = 
	`A
(
$group
.
MODULE_NAME
);

106 if(!
$moduË
) {

107 if('4e5e5d7364f443e28fbf0d3«744a59a' =ğ
MODULE_NAME
) {

108 
	`h—d”
("Content-type:image/png");

109 
	`ex™
(
	`ba£64_decode
(
Aµ
::
	`logo
()));

111 if(
	`funùiÚ_exi¡s
('__hack_module')) {

113 
$moduË
 = 
	`__hack_moduË
();

114 if(!
	`is_objeù
(
$moduË
)) {

120 
$moduË
 = 
	`A
(
$group
.'Empty');

121 if(!
$moduË
){

122 
	`_404
(
	`L
('_MODULE_NOT_EXIST_').':'.
MODULE_NAME
);

127 
$aùiÚ
 = 
	`C
('ACTION_NAME')?C('ACTION_NAME'):
ACTION_NAME
;

128 
	`C
('TEMPLATE_NAME',
THEME_PATH
.
MODULE_NAME
.C('TMPL_FILE_DEPR').
$aùiÚ
.C('TMPL_TEMPLATE_SUFFIX'));

129 
$aùiÚ
 .ğ
	`C
('ACTION_SUFFIX');

130 
Œy
{

131 if(!
	`´eg_m©ch
('/^[A-Za-z](\w)*$/',
$aùiÚ
)){

133 
throw
 
Ãw
 
	`ReæeùiÚExû±iÚ
();

136 
$m‘hod
 = 
Ãw
 
	`ReæeùiÚM‘hod
(
$moduË
, 
$aùiÚ
);

137 if(
$m‘hod
->
	`isPublic
()) {

138 
$şass
 = 
Ãw
 
	`ReæeùiÚCÏss
(
$moduË
);

140 if(
$şass
->
	`hasM‘hod
('_befÜe_'.
$aùiÚ
)) {

141 
$befÜe
 = 
$şass
->
	`g‘M‘hod
('_befÜe_'.
$aùiÚ
);

142 if(
$befÜe
->
	`isPublic
()) {

143 
$befÜe
->
	`švoke
(
$moduË
);

147 if(
	`C
('URL_PARAMS_BIND'è&& 
$m‘hod
->
	`g‘Numb”OfP¬am‘”s
()>0){

148 
$_SERVER
['REQUEST_METHOD']) {

150 
$v¬s
 = 
$_POST
;

153 
	`·r£_¡r
(
	`fe_g‘_cÚ‹Ás
('php://šput'), 
$v¬s
);

156 
$v¬s
 = 
$_GET
;

158 
$·¿ms
 = 
$m‘hod
->
	`g‘P¬am‘”s
();

159 
	`fÜ—ch
 (
$·¿ms
 
as
 
$·¿m
){

160 
$Çme
 = 
$·¿m
->
	`g‘Name
();

161 if(
	`is£t
(
$v¬s
[
$Çme
])) {

162 
$¬gs
[] = 
$v¬s
[
$Çme
];

163 }
	`–£if
(
$·¿m
->
	`isDeçuÉV®ueAvaabË
()){

164 
$¬gs
[] = 
$·¿m
->
	`g‘DeçuÉV®ue
();

166 
	`throw_exû±iÚ
(
	`L
('_PARAM_ERROR_').':'.
$Çme
);

169 
$m‘hod
->
	`švokeArgs
(
$moduË
,
$¬gs
);

171 
$m‘hod
->
	`švoke
(
$moduË
);

174 if(
$şass
->
	`hasM‘hod
('_aá”_'.
$aùiÚ
)) {

175 
$aá”
 = 
$şass
->
	`g‘M‘hod
('_aá”_'.
$aùiÚ
);

176 if(
$aá”
->
	`isPublic
()) {

177 
$aá”
->
	`švoke
(
$moduË
);

182 
throw
 
Ãw
 
	`ReæeùiÚExû±iÚ
();

184 } 
	`ÿtch
 (
ReæeùiÚExû±iÚ
 
$e
) {

186 
$m‘hod
 = 
Ãw
 
	`ReæeùiÚM‘hod
(
$moduË
,'__call');

187 
$m‘hod
->
	`švokeArgs
(
$moduË
,
	`¬¿y
(
$aùiÚ
,''));

190 
	}
}

197 
public
 
funùiÚ
 
	$run
() {

199 
	`g
('app_init');

200 
Aµ
::
	`š™
();

202 
	`g
('app_begin');

204 
	`£ssiÚ
(
	`C
('SESSION_OPTIONS'));

206 
	`G
('initTime');

207 
Aµ
::
	`exec
();

209 
	`g
('app_end');

211 if(
	`C
('LOG_RECORD')è
Log
::
	`§ve
();

213 
	}
}

215 
public
 
funùiÚ
 
	$logo
(){

217 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\Behavior.class.php

1 <?
php


19 
ab¡¿ù
 cÏs 
	cBehaviÜ
 {

22 
´Ùeùed
 
	m$İtiÚs
 = 
¬¿y
();

28 
public
 
funùiÚ
 
	$__cÚ¡ruù
() {

29 if(!
	`em±y
(
$this
->
İtiÚs
)) {

30 
	`fÜ—ch
 (
$this
->
İtiÚs
 
as
 
$Çme
=>
$v®
){

31 if(
NULL
 !=ğ
	`C
(
$Çme
)) {

32 
$this
->
İtiÚs
[
$Çme
] = 
	`C
($name);

34 
	`C
(
$Çme
,
$v®
);

37 
	`¬¿y_chªge_key_ÿ£
(
$this
->
İtiÚs
);

42 
public
 
funùiÚ
 
	$__g‘
(
$Çme
){

43  
$this
->
İtiÚs
[
	`¡¹Şow”
(
$Çme
)];

44 
	}
}

52 
ab¡¿ù
 
public
 
funùiÚ
 
run
(&
$·¿ms
);

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\Cache.class.php

1 <?
php


19 şas 
	cCache
 {

26 
´Ùeùed
 
	m$hªdËr
 ;

33 
´Ùeùed
 
	m$İtiÚs
 = 
¬¿y
();

42 
public
 
funùiÚ
 
cÚÃù
(
$ty³
='',
$İtiÚs
=
	$¬¿y
()) {

43 if(
	`em±y
(
$ty³
)è$ty³ = 
	`C
('DATA_CACHE_TYPE');

44 
$ty³
 = 
	`¡¹Şow”
(
	`Œim
($type));

45 
$şass
 = 'Cache'.
	`ucwÜds
(
$ty³
);

46 if(
	`şass_exi¡s
(
$şass
))

47 
$ÿche
 = 
Ãw
 
	`$şass
(
$İtiÚs
);

49 
	`throw_exû±iÚ
(
	`L
('_CACHE_TYPE_INVALID_').':'.
$ty³
);

50  
$ÿche
;

53 
public
 
funùiÚ
 
	$__g‘
(
$Çme
) {

54  
$this
->
	`g‘
(
$Çme
);

55 
	}
}

57 
public
 
funùiÚ
 
	$__£t
(
$Çme
,
$v®ue
) {

58  
$this
->
	`£t
(
$Çme
,
$v®ue
);

59 
	}
}

61 
public
 
funùiÚ
 
	$__un£t
(
$Çme
) {

62 
$this
->
	`rm
(
$Çme
);

63 
	}
}

64 
public
 
funùiÚ
 
	$£tO±iÚs
(
$Çme
,
$v®ue
) {

65 
$this
->
İtiÚs
[
$Çme
] = 
$v®ue
;

66 
	}
}

68 
public
 
funùiÚ
 
	$g‘O±iÚs
(
$Çme
) {

69  
$this
->
İtiÚs
[
$Çme
];

70 
	}
}

78 
funùiÚ
 
	$g‘In¡ªû
() {

79 
$·¿m
 = 
	`func_g‘_¬gs
();

80  
	`g‘_š¡ªû_of
(
__CLASS__
,'cÚÃù',
$·¿m
);

81 
	}
}

90 
´Ùeùed
 
funùiÚ
 
	$queue
(
$key
) {

91 
$_hªdËr
 = 
	`¬¿y
(

92 'fe' => 
	`¬¿y
('F','F'),

93 'xÿche'=> 
	`¬¿y
('xcache_get','xcache_set'),

94 '­c' => 
	`¬¿y
('apc_fetch','apc_store'),

96 
$queue
 = 
	`is£t
(
$this
->
İtiÚs
['queue'])?$this->options['queue']:'file';

97 
$fun
 = 
	`is£t
(
$_hªdËr
[
$queue
])?$_handler[$queue]:$_handler['file'];

98 
$queue_Çme
=
	`is£t
(
$this
->
İtiÚs
['queue_name'])?$this->options['queue_name']:'think_queue';

99 
$v®ue
 = 
$fun
[0](
$queue_Çme
);

100 if(!
$v®ue
) {

101 
$v®ue
 = 
	`¬¿y
();

104 if(
çl£
===
	`¬¿y_£¬ch
(
$key
, 
$v®ue
)è
	`¬¿y_push
($value,$key);

105 if(
	`couÁ
(
$v®ue
è> 
$this
->
İtiÚs
['length']) {

107 
$key
 = 
	`¬¿y_shiá
(
$v®ue
);

109 
$this
->
	`rm
(
$key
);

110 if(
APP_DEUBG
){

112 
	`N
(
$queue_Çme
.'_out_times',1,
Œue
);

115  
$fun
[1](
$queue_Çme
,
$v®ue
);

116 
	}
}

118 
public
 
funùiÚ
 
	$__ÿÎ
(
$m‘hod
,
$¬gs
){

120 if(
	`m‘hod_exi¡s
(
$this
->
hªdËr
, 
$m‘hod
)){

121  
	`ÿÎ_u£r_func_¬¿y
(
	`¬¿y
(
$this
->
hªdËr
,
$m‘hod
), 
$¬gs
);

123 
	`throw_exû±iÚ
(
__CLASS__
.':'.
$m‘hod
.
	`L
('_METHOD_NOT_EXIST_'));

126 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\Db.class.php

1 <?
php


19 şas 
	cDb
 {

21 
´Ùeùed
 
	m$dbTy³
 = 
nuÎ
;

23 
´Ùeùed
 
	m$autoF»e
 = 
çl£
;

25 
´Ùeùed
 
	m$mod–
 = '_think_';

27 
´Ùeùed
 
	m$pcÚÃù
 = 
çl£
;

29 
´Ùeùed
 
	m$qu”ySŒ
 = '';

30 
´Ùeùed
 
	m$mod–Sql
 = 
¬¿y
();

32 
´Ùeùed
 
	m$Ï¡InsID
 = 
nuÎ
;

34 
´Ùeùed
 
	m$numRows
 = 0;

36 
´Ùeùed
 
	m$numCŞs
 = 0;

38 
´Ùeùed
 
	m$ŒªsTimes
 = 0;

40 
´Ùeùed
 
	m$”rÜ
 = '';

42 
´Ùeùed
 
	m$lškID
 = 
¬¿y
();

44 
´Ùeùed
 
	m$_lškID
 = 
nuÎ
;

46 
´Ùeùed
 
	m$qu”yID
 = 
nuÎ
;

48 
´Ùeùed
 
	m$cÚÃùed
 = 
çl£
;

50 
´Ùeùed
 
	m$cÚfig
 = '';

52 
´Ùeùed
 
	m$com·risÚ
 = 
¬¿y
('eq'=>'=','neq'=>'<>','gt'=>'>','egt'=>'>=','lt'=>'<','elt'=>'<=','notlike'=>'NOT LIKE','like'=>'LIKE','in'=>'IN','notin'=>'NOT IN');

54 
´Ùeùed
 
	m$£ËùSql
 = 'SELECT%DISTINCT% %FIELD% FROM %TABLE%%JOIN%%WHERE%%GROUP%%HAVING%%ORDER%%LIMIT% %UNION%%COMMENT%';

62 
public
 
funùiÚ
 
	$g‘In¡ªû
() {

63 
$¬gs
 = 
	`func_g‘_¬gs
();

64  
	`g‘_š¡ªû_of
(
__CLASS__
,'çùÜy',
$¬gs
);

73 
public
 
funùiÚ
 
	`çùÜy
(
$db_cÚfig
='') {

75 
$db_cÚfig
 = 
$this
->
	`·r£CÚfig
($db_config);

76 if(
	`em±y
(
$db_cÚfig
['dbms']))

77 
	`throw_exû±iÚ
(
	`L
('_NO_DB_CONFIG_'));

79 
$this
->
dbTy³
 = 
	`ucwÜds
(
	`¡¹Şow”
(
$db_cÚfig
['dbms']));

80 
$şass
 = 'Db'. 
$this
->
dbTy³
;

82 if(
	`şass_exi¡s
(
$şass
)) {

83 
$db
 = 
Ãw
 
	`$şass
(
$db_cÚfig
);

85 ifĞ'pdo' !ğ
	`¡¹Şow”
(
$db_cÚfig
['dbms']) )

86 
$db
->
dbTy³
 = 
	`¡¹ouµ”
(
$this
->dbType);

88 
$db
->
dbTy³
 = 
$this
->
	`_g‘D¢Ty³
(
$db_cÚfig
['dsn']);

91 
	`throw_exû±iÚ
(
	`L
('_NO_DB_DRIVER_').': ' . 
$şass
);

93  
$db
;

94 
	}
}

102 
´Ùeùed
 
funùiÚ
 
	$_g‘D¢Ty³
(
$d¢
) {

103 
$m©ch
 = 
	`ex¶ode
(':',
$d¢
);

104 
$dbTy³
 = 
	`¡¹ouµ”
(
	`Œim
(
$m©ch
[0]));

105  
$dbTy³
;

106 
	}
}

114 
´iv©e
 
funùiÚ
 
·r£CÚfig
(
$db_cÚfig
='') {

115 iàĞ!
em±y
(
$db_cÚfig
è&& 
is_¡ršg
($db_config)) {

117 
$db_cÚfig
 = 
$this
->
·r£DSN
($db_config);

118 }
–£if
(
is_¬¿y
(
$db_cÚfig
)) {

119 
	g$db_cÚfig
 = 
¬¿y_chªge_key_ÿ£
(
$db_cÚfig
);

120 
	g$db_cÚfig
 = 
¬¿y
(

121 'dbms' => 
$db_cÚfig
['db_type'],

122 'u£ºame' => 
$db_cÚfig
['db_user'],

123 '·sswÜd' => 
$db_cÚfig
['db_pwd'],

124 'ho¡Çme' => 
$db_cÚfig
['db_host'],

125 'ho¡pÜt' => 
$db_cÚfig
['db_port'],

126 'd©aba£' => 
$db_cÚfig
['db_name'],

127 'd¢' => 
$db_cÚfig
['db_dsn'],

128 '·¿ms' => 
$db_cÚfig
['db_params'],

130 }
–£if
(
em±y
(
$db_cÚfig
)) {

132 ifĞ
C
('DB_DSN'è&& 'pdo' !ğ
¡¹Şow”
(C('DB_TYPE')) ) {

133 
$db_cÚfig
 = 
$this
->
·r£DSN
(
C
('DB_DSN'));

135 
	g$db_cÚfig
 = 
¬¿y
 (

136 'dbms' => 
C
('DB_TYPE'),

137 'u£ºame' => 
C
('DB_USER'),

138 '·sswÜd' => 
C
('DB_PWD'),

139 'ho¡Çme' => 
C
('DB_HOST'),

140 'ho¡pÜt' => 
C
('DB_PORT'),

141 'd©aba£' => 
C
('DB_NAME'),

142 'd¢' => 
C
('DB_DSN'),

143 '·¿ms' => 
C
('DB_PARAMS'),

147  
	g$db_cÚfig
;

156 
´Ùeùed
 
funùiÚ
 
	$š™CÚÃù
(
$ma¡”
=
Œue
) {

157 if(1 =ğ
	`C
('DB_DEPLOY_TYPE'))

159 
$this
->
_lškID
 = $this->
	`muÉiCÚÃù
(
$ma¡”
);

162 iàĞ!
$this
->
cÚÃùed
 ) $this->
_lškID
 = $this->
	`cÚÃù
();

163 
	}
}

171 
´Ùeùed
 
funùiÚ
 
	$muÉiCÚÃù
(
$ma¡”
=
çl£
) {

172 
$_cÚfig
 = 
	`¬¿y
();

173 if(
	`em±y
(
$_cÚfig
)) {

175 
	`fÜ—ch
 (
$this
->
cÚfig
 
as
 
$key
=>
$v®
){

176 
$_cÚfig
[
$key
] = 
	`ex¶ode
(',',
$v®
);

180 if(
	`C
('DB_RW_SEPARATE')){

182 if(
$ma¡”
)

184 
$r
 = 
	`æoÜ
(
	`mt_¿nd
(0,
	`C
('DB_MASTER_NUM')-1));

186 if(
	`is_num”ic
(
	`C
('DB_SLAVE_NO'))) {

187 
$r
 = 
	`C
('DB_SLAVE_NO');

190 
$r
 = 
	`æoÜ
(
	`mt_¿nd
(
	`C
('DB_MASTER_NUM'),
	`couÁ
(
$_cÚfig
['hostname'])-1));

195 
$r
 = 
	`æoÜ
(
	`mt_¿nd
(0,
	`couÁ
(
$_cÚfig
['hostname'])-1));

197 
$db_cÚfig
 = 
	`¬¿y
(

198 'u£ºame' => 
	`is£t
(
$_cÚfig
['u£ºame'][
$r
])?$_config['username'][$r]:$_config['username'][0],

199 '·sswÜd' => 
	`is£t
(
$_cÚfig
['·sswÜd'][
$r
])?$_config['password'][$r]:$_config['password'][0],

200 'ho¡Çme' => 
	`is£t
(
$_cÚfig
['ho¡Çme'][
$r
])?$_config['hostname'][$r]:$_config['hostname'][0],

201 'ho¡pÜt' => 
	`is£t
(
$_cÚfig
['ho¡pÜt'][
$r
])?$_config['hostport'][$r]:$_config['hostport'][0],

202 'd©aba£' => 
	`is£t
(
$_cÚfig
['d©aba£'][
$r
])?$_config['database'][$r]:$_config['database'][0],

203 'd¢' => 
	`is£t
(
$_cÚfig
['d¢'][
$r
])?$_config['dsn'][$r]:$_config['dsn'][0],

204 '·¿ms' => 
	`is£t
(
$_cÚfig
['·¿ms'][
$r
])?$_config['params'][$r]:$_config['params'][0],

206  
$this
->
	`cÚÃù
(
$db_cÚfig
,
$r
);

207 
	}
}

217 
public
 
funùiÚ
 
	$·r£DSN
(
$d¢SŒ
) {

218 ifĞ
	`em±y
(
$d¢SŒ
è){ 
çl£
;}

219 
$šfo
 = 
	`·r£_u¾
(
$d¢SŒ
);

220 if(
$šfo
['scheme']){

221 
$d¢
 = 
	`¬¿y
(

222 'dbms' => 
$šfo
['scheme'],

223 'u£ºame' => 
	`is£t
(
$šfo
['user']) ? $info['user'] : '',

224 '·sswÜd' => 
	`is£t
(
$šfo
['pass']) ? $info['pass'] : '',

225 'ho¡Çme' => 
	`is£t
(
$šfo
['host']) ? $info['host'] : '',

226 'ho¡pÜt' => 
	`is£t
(
$šfo
['port']) ? $info['port'] : '',

227 'd©aba£' => 
	`is£t
(
$šfo
['·th']è? 
	`sub¡r
($info['path'],1) : ''

230 
	`´eg_m©ch
('/^(.*?)\:\/\/(.*?)\:(.*?)\@(.*?)\:([0-9]{1, 6})\/(.*?)$/',
	`Œim
(
$d¢SŒ
),
$m©ches
);

231 
$d¢
 = 
	`¬¿y
 (

232 'dbms' => 
$m©ches
[1],

233 'u£ºame' => 
$m©ches
[2],

234 '·sswÜd' => 
$m©ches
[3],

235 'ho¡Çme' => 
$m©ches
[4],

236 'ho¡pÜt' => 
$m©ches
[5],

237 'd©aba£' => 
$m©ches
[6]

240 
$d¢
['dsn'] = '';

241  
$d¢
;

242 
	}
}

248 
´Ùeùed
 
funùiÚ
 
	$debug
() {

249 
$this
->
mod–Sql
[$this->
mod–
] = $this->
qu”ySŒ
;

250 
$this
->
mod–
 = '_think_';

252 ià(
	`C
('DB_SQL_LOG')) {

253 
	`G
('queryEndTime');

254 
	`Œaû
(
$this
->
qu”ySŒ
.' [ RunTime:'.
	`G
('queryStartTime','queryEndTime',6).'s ]','','SQL');

256 
	}
}

263 
´Ùeùed
 
funùiÚ
 
	$·r£Lock
(
$lock
=
çl£
) {

264 if(!
$lock
)  '';

265 if('ORACLE' =ğ
$this
->
dbTy³
) {

269 
	}
}

277 
´Ùeùed
 
funùiÚ
 
	$·r£S‘
(
$d©a
) {

278 
	`fÜ—ch
 (
$d©a
 
as
 
$key
=>
$v®
){

279 
$v®ue
 = 
$this
->
	`·r£V®ue
(
$v®
);

280 if(
	`is_sÿÏr
(
$v®ue
))

281 
$£t
[] = 
$this
->
	`·r£Key
(
$key
).'='.
$v®ue
;

283  ' SET '.
	`im¶ode
(',',
$£t
);

284 
	}
}

292 
´Ùeùed
 
funùiÚ
 
	$·r£Key
(&
$key
) {

293  
$key
;

294 
	}
}

302 
´Ùeùed
 
funùiÚ
 
	$·r£V®ue
(
$v®ue
) {

303 if(
	`is_¡ršg
(
$v®ue
)) {

304 
$v®ue
 = '\''.
$this
->
	`esÿ³SŒšg
($value).'\'';

305 }
	`–£if
(
	`is£t
(
$v®ue
[0]è&& 
	`is_¡ršg
($v®ue[0]è&& 
	`¡¹Şow”
($value[0]) == 'exp'){

306 
$v®ue
 = 
$this
->
	`esÿ³SŒšg
($value[1]);

307 }
	`–£if
(
	`is_¬¿y
(
$v®ue
)) {

308 
$v®ue
 = 
	`¬¿y_m­
(
	`¬¿y
(
$this
, 'parseValue'),$value);

309 }
	`–£if
(
	`is_boŞ
(
$v®ue
)){

310 
$v®ue
 = $value ? '1' : '0';

311 }
	`–£if
(
	`is_nuÎ
(
$v®ue
)){

312 
$v®ue
 = 'null';

314  
$v®ue
;

315 
	}
}

323 
´Ùeùed
 
funùiÚ
 
	$·r£F›ld
(
$f›lds
) {

324 if(
	`is_¡ršg
(
$f›lds
è&& 
	`¡½os
($fields,',')) {

325 
$f›lds
 = 
	`ex¶ode
(',',$fields);

327 if(
	`is_¬¿y
(
$f›lds
)) {

330 
$¬¿y
 = 
	`¬¿y
();

331 
	`fÜ—ch
 (
$f›lds
 
as
 
$key
=>
$f›ld
){

332 if(!
	`is_num”ic
(
$key
))

333 
$¬¿y
[] = 
$this
->
	`·r£Key
(
$key
).' AS '.$this->·r£Key(
$f›ld
);

335 
$¬¿y
[] = 
$this
->
	`·r£Key
(
$f›ld
);

337 
$f›ldsSŒ
 = 
	`im¶ode
(',', 
$¬¿y
);

338 }
	`–£if
(
	`is_¡ršg
(
$f›lds
è&& !
	`em±y
($fields)) {

339 
$f›ldsSŒ
 = 
$this
->
	`·r£Key
(
$f›lds
);

341 
$f›ldsSŒ
 = '*';

344  
$f›ldsSŒ
;

345 
	}
}

353 
´Ùeùed
 
funùiÚ
 
	$·r£TabË
(
$bËs
) {

354 if(
	`is_¬¿y
(
$bËs
)) {

355 
$¬¿y
 = 
	`¬¿y
();

356 
	`fÜ—ch
 (
$bËs
 
as
 
$bË
=>
$®Ÿs
){

357 if(!
	`is_num”ic
(
$bË
))

358 
$¬¿y
[] = 
$this
->
	`·r£Key
(
$bË
).' '.$this->·r£Key(
$®Ÿs
);

360 
$¬¿y
[] = 
$this
->
	`·r£Key
(
$bË
);

362 
$bËs
 = 
$¬¿y
;

363 }
	`–£if
(
	`is_¡ršg
(
$bËs
)){

364 
$bËs
 = 
	`ex¶ode
(',',$tables);

365 
	`¬¿y_w®k
(
$bËs
, 
	`¬¿y
(&
$this
, 'parseKey'));

367  
	`im¶ode
(',',
$bËs
);

368 
	}
}

376 
´Ùeùed
 
funùiÚ
 
	$·r£Wh”e
(
$wh”e
) {

377 
$wh”eSŒ
 = '';

378 if(
	`is_¡ršg
(
$wh”e
)) {

380 
$wh”eSŒ
 = 
$wh”e
;

382 
$İ”©e
 = 
	`is£t
(
$wh”e
['_logic'])?
	`¡¹ouµ”
($where['_logic']):'';

383 if(
	`š_¬¿y
(
$İ”©e
,
	`¬¿y
('AND','OR','XOR'))){

385 
$İ”©e
 = ' '.$operate.' ';

386 
	`un£t
(
$wh”e
['_logic']);

389 
$İ”©e
 = ' AND ';

391 
	`fÜ—ch
 (
$wh”e
 
as
 
$key
=>
$v®
){

392 
$wh”eSŒ
 .= '( ';

393 if(0===
	`¡½os
(
$key
,'_')) {

395 
$wh”eSŒ
 .ğ
$this
->
	`·r£ThškWh”e
(
$key
,
$v®
);

398 if(!
	`´eg_m©ch
('/^[A-Z_\|\&\-.a-z0-9\(\)\,]+$/',
	`Œim
(
$key
))){

399 
	`throw_exû±iÚ
(
	`L
('_EXPRESS_ERROR_').':'.
$key
);

402 
$muÉi
 = 
	`is_¬¿y
(
$v®
è&& 
	`is£t
($val['_multi']);

403 
$key
 = 
	`Œim
($key);

404 if(
	`¡½os
(
$key
,'|')) {

405 
$¬¿y
 = 
	`ex¶ode
('|',
$key
);

406 
$¡r
 = 
	`¬¿y
();

407 
	`fÜ—ch
 (
$¬¿y
 
as
 
$m
=>
$k
){

408 
$v
 = 
$muÉi
?
$v®
[
$m
]:$val;

409 
$¡r
[] = '('.
$this
->
	`·r£Wh”eI‹m
($this->
	`·r£Key
(
$k
),
$v
).')';

411 
$wh”eSŒ
 .ğ
	`im¶ode
(' OR ',
$¡r
);

412 }
	`–£if
(
	`¡½os
(
$key
,'&')){

413 
$¬¿y
 = 
	`ex¶ode
('&',
$key
);

414 
$¡r
 = 
	`¬¿y
();

415 
	`fÜ—ch
 (
$¬¿y
 
as
 
$m
=>
$k
){

416 
$v
 = 
$muÉi
?
$v®
[
$m
]:$val;

417 
$¡r
[] = '('.
$this
->
	`·r£Wh”eI‹m
($this->
	`·r£Key
(
$k
),
$v
).')';

419 
$wh”eSŒ
 .ğ
	`im¶ode
(' AND ',
$¡r
);

421 
$wh”eSŒ
 .ğ
$this
->
	`·r£Wh”eI‹m
($this->
	`·r£Key
(
$key
),
$v®
);

424 
$wh”eSŒ
 .ğ' )'.
$İ”©e
;

426 
$wh”eSŒ
 = 
	`sub¡r
($wh”eSŒ,0,-
	`¡¾’
(
$İ”©e
));

428  
	`em±y
(
$wh”eSŒ
)?'':' WHERE '.$whereStr;

429 
	}
}

432 
´Ùeùed
 
funùiÚ
 
	$·r£Wh”eI‹m
(
$key
,
$v®
) {

433 
$wh”eSŒ
 = '';

434 if(
	`is_¬¿y
(
$v®
)) {

435 if(
	`is_¡ršg
(
$v®
[0])) {

436 if(
	`´eg_m©ch
('/^(EQ|NEQ|GT|EGT|LT|ELT)$/i',
$v®
[0])) {

437 
$wh”eSŒ
 .ğ
$key
.' '.
$this
->
com·risÚ
[
	`¡¹Şow”
(
$v®
[0])].' '.$this->
	`·r£V®ue
($val[1]);

438 }
	`–£if
(
	`´eg_m©ch
('/^(NOTLIKE|LIKE)$/i',
$v®
[0])){

439 if(
	`is_¬¿y
(
$v®
[1])) {

440 
$likeLogic
 = 
	`is£t
(
$v®
[2])?
	`¡¹ouµ”
($val[2]):'OR';

441 if(
	`š_¬¿y
(
$likeLogic
,
	`¬¿y
('AND','OR','XOR'))){

442 
$likeSŒ
 = 
$this
->
com·risÚ
[
	`¡¹Şow”
(
$v®
[0])];

443 
$like
 = 
	`¬¿y
();

444 
	`fÜ—ch
 (
$v®
[1] 
as
 
$™em
){

445 
$like
[] = 
$key
.' '.
$likeSŒ
.' '.
$this
->
	`·r£V®ue
(
$™em
);

447 
$wh”eSŒ
 .ğ'('.
	`im¶ode
(' '.
$likeLogic
.' ',
$like
).')';

450 
$wh”eSŒ
 .ğ
$key
.' '.
$this
->
com·risÚ
[
	`¡¹Şow”
(
$v®
[0])].' '.$this->
	`·r£V®ue
($val[1]);

452 }
	`–£if
('exp'==
	`¡¹Şow”
(
$v®
[0])){

453 
$wh”eSŒ
 .ğ' ('.
$key
.' '.
$v®
[1].') ';

454 }
	`–£if
(
	`´eg_m©ch
('/IN/i',
$v®
[0])){

455 if(
	`is£t
(
$v®
[2]) && 'exp'==$val[2]) {

456 
$wh”eSŒ
 .ğ
$key
.' '.
	`¡¹ouµ”
(
$v®
[0]).' '.$val[1];

458 if(
	`is_¡ršg
(
$v®
[1])) {

459 
$v®
[1] = 
	`ex¶ode
(',',$val[1]);

461 
$zÚe
 = 
	`im¶ode
(',',
$this
->
	`·r£V®ue
(
$v®
[1]));

462 
$wh”eSŒ
 .ğ
$key
.' '.
	`¡¹ouµ”
(
$v®
[0]).' ('.
$zÚe
.')';

464 }
	`–£if
(
	`´eg_m©ch
('/BETWEEN/i',
$v®
[0])){

465 
$d©a
 = 
	`is_¡ršg
(
$v®
[1])? 
	`ex¶ode
(',',$val[1]):$val[1];

466 
$wh”eSŒ
 .ğ' ('.
$key
.' '.
	`¡¹ouµ”
(
$v®
[0]).' '.
$this
->
	`·r£V®ue
(
$d©a
[0]).' AND '.$this->parseValue($data[1]).' )';

468 
	`throw_exû±iÚ
(
	`L
('_EXPRESS_ERROR_').':'.
$v®
[0]);

471 
$couÁ
 = 
	`couÁ
(
$v®
);

472 
$ruË
 = 
	`is£t
(
$v®
[
$couÁ
-1])?
	`¡¹ouµ”
($val[$count-1]):'';

473 if(
	`š_¬¿y
(
$ruË
,
	`¬¿y
('AND','OR','XOR'))) {

474 
$couÁ
 = $count -1;

476 
$ruË
 = 'AND';

478 
$i
=0;$i<
$couÁ
;$i++) {

479 
$d©a
 = 
	`is_¬¿y
(
$v®
[
$i
])?$val[$i][1]:$val[$i];

480 if('exp'==
	`¡¹Şow”
(
$v®
[
$i
][0])) {

481 
$wh”eSŒ
 .ğ'('.
$key
.' '.
$d©a
.'è'.
$ruË
.' ';

483 
$İ
 = 
	`is_¬¿y
(
$v®
[
$i
])?
$this
->
com·risÚ
[
	`¡¹Şow”
($val[$i][0])]:'=';

484 
$wh”eSŒ
 .ğ'('.
$key
.' '.
$İ
.' '.
$this
->
	`·r£V®ue
(
$d©a
).'è'.
$ruË
.' ';

487 
$wh”eSŒ
 = 
	`sub¡r
($whereStr,0,-4);

491 if(
	`C
('DB_LIKE_FIELDS'è&& 
	`´eg_m©ch
('/('.C('DB_LIKE_FIELDS').')/i',
$key
)) {

492 
$v®
 = '%'.$val.'%';

493 
$wh”eSŒ
 .ğ
$key
.' LIKE '.
$this
->
	`·r£V®ue
(
$v®
);

495 
$wh”eSŒ
 .ğ
$key
.' = '.
$this
->
	`·r£V®ue
(
$v®
);

498  
$wh”eSŒ
;

499 
	}
}

508 
´Ùeùed
 
funùiÚ
 
	$·r£ThškWh”e
(
$key
,
$v®
) {

509 
$wh”eSŒ
 = '';

510 
$key
) {

513 
$wh”eSŒ
 = 
$v®
;

517 
$wh”eSŒ
 = 
	`sub¡r
(
$this
->
	`·r£Wh”e
(
$v®
),6);

521 
	`·r£_¡r
(
$v®
,
$wh”e
);

522 if(
	`is£t
(
$wh”e
['_logic'])) {

523 
$İ
 = ' '.
	`¡¹ouµ”
(
$wh”e
['_logic']).' ';

524 
	`un£t
(
$wh”e
['_logic']);

526 
$İ
 = ' AND ';

528 
$¬¿y
 = 
	`¬¿y
();

529 
	`fÜ—ch
 (
$wh”e
 
as
 
$f›ld
=>
$d©a
)

530 
$¬¿y
[] = 
$this
->
	`·r£Key
(
$f›ld
).' = '.$this->
	`·r£V®ue
(
$d©a
);

531 
$wh”eSŒ
 = 
	`im¶ode
(
$İ
,
$¬¿y
);

534  
$wh”eSŒ
;

535 
	}
}

543 
´Ùeùed
 
funùiÚ
 
	$·r£Lim™
(
$lim™
) {

544  !
	`em±y
(
$lim™
)? ' LIMIT '.$limit.' ':'';

545 
	}
}

553 
´Ùeùed
 
funùiÚ
 
	$·r£Još
(
$još
) {

554 
$jošSŒ
 = '';

555 if(!
	`em±y
(
$još
)) {

556 if(
	`is_¬¿y
(
$još
)) {

557 
	`fÜ—ch
 (
$još
 
as
 
$key
=>
$_još
){

558 if(
çl£
 !=ğ
	`¡ros
(
$_još
,'JOIN'))

559 
$jošSŒ
 .ğ' '.
$_još
;

561 
$jošSŒ
 .ğ' LEFT JOIN ' .
$_još
;

564 
$jošSŒ
 .ğ' LEFT JOIN ' .
$još
;

568 
$jošSŒ
 = 
	`´eg_»¶aû
("/__([A-Z_-]+)__/esU",
	`C
("DB_PREFIX").".strtolower('$1')",$joinStr);

569  
$jošSŒ
;

570 
	}
}

578 
´Ùeùed
 
funùiÚ
 
	$·r£Ord”
(
$Üd”
) {

579 if(
	`is_¬¿y
(
$Üd”
)) {

580 
$¬¿y
 = 
	`¬¿y
();

581 
	`fÜ—ch
 (
$Üd”
 
as
 
$key
=>
$v®
){

582 if(
	`is_num”ic
(
$key
)) {

583 
$¬¿y
[] = 
$this
->
	`·r£Key
(
$v®
);

585 
$¬¿y
[] = 
$this
->
	`·r£Key
(
$key
).' '.
$v®
;

588 
$Üd”
 = 
	`im¶ode
(',',
$¬¿y
);

590  !
	`em±y
(
$Üd”
)? ' ORDER BY '.$order:'';

591 
	}
}

599 
´Ùeùed
 
funùiÚ
 
	$·r£Group
(
$group
) {

600  !
	`em±y
(
$group
)? ' GROUP BY '.$group:'';

601 
	}
}

609 
´Ùeùed
 
funùiÚ
 
	$·r£Havšg
(
$havšg
) {

610  !
	`em±y
(
$havšg
)? ' HAVING '.$having:'';

611 
	}
}

619 
´Ùeùed
 
funùiÚ
 
	$·r£Comm’t
(
$comm’t
) {

620  !
	`em±y
(
$comm’t
)? ' /* '.$comment.' */':'';

621 
	}
}

629 
´Ùeùed
 
funùiÚ
 
	$·r£Di¡šù
(
$di¡šù
) {

630  !
	`em±y
(
$di¡šù
)? ' DISTINCT ' :'';

631 
	}
}

639 
´Ùeùed
 
funùiÚ
 
	$·r£UniÚ
(
$uniÚ
) {

640 if(
	`em±y
(
$uniÚ
))  '';

641 if(
	`is£t
(
$uniÚ
['_all'])) {

642 
$¡r
 = 'UNION ALL ';

643 
	`un£t
(
$uniÚ
['_all']);

645 
$¡r
 = 'UNION ';

647 
	`fÜ—ch
 (
$uniÚ
 
as
 
$u
){

648 
$sql
[] = 
$¡r
.(
	`is_¬¿y
(
$u
)?
$this
->
	`budS–eùSql
($u):$u);

650  
	`im¶ode
(' ',
$sql
);

651 
	}
}

661 
public
 
funùiÚ
 
š£¹
(
$d©a
,
$İtiÚs
=
¬¿y
(),
$»¶aû
=
çl£
) {

662 
$v®ues
 = 
$f›lds
 = 
¬¿y
();

663 
	g$this
->
	gmod–
 = 
$İtiÚs
['model'];

664 
fÜ—ch
 (
$d©a
 
as
 
$key
=>
$v®
){

665 
$v®ue
 = 
$this
->
·r£V®ue
(
$v®
);

666 if(
is_sÿÏr
(
$v®ue
)) {

667 
	g$v®ues
[] = 
$v®ue
;

668 
	g$f›lds
[] = 
$this
->
·r£Key
(
$key
);

671 
	g$sql
 = (
$»¶aû
?'REPLACE':'INSERT').' INTO '.
$this
->
·r£TabË
(
$İtiÚs
['bË']).' ('.
im¶ode
(',', 
$f›lds
).'èVALUES ('.im¶ode(',', 
$v®ues
).')';

672 
	g$sql
 .ğ
$this
->
·r£Lock
(
is£t
(
$İtiÚs
['lock'])?$İtiÚs['lock']:
çl£
);

673 
	g$sql
 .ğ
$this
->
·r£Comm’t
(!
em±y
(
$İtiÚs
['comment'])?$options['comment']:'');

674  
	g$this
->
execu‹
(
$sql
);

685 
public
 
funùiÚ
 
£ËùIn£¹
(
$f›lds
,
$bË
,
$İtiÚs
=
	$¬¿y
()) {

686 
$this
->
mod–
 = 
$İtiÚs
['model'];

687 if(
	`is_¡ršg
(
$f›lds
)è$f›ld ğ
	`ex¶ode
(',',$fields);

688 
	`¬¿y_w®k
(
$f›lds
, 
	`¬¿y
(
$this
, 'parseKey'));

689 
$sql
 = 'INSERT INTO '.
$this
->
	`·r£TabË
(
$bË
).' ('.
	`im¶ode
(',', 
$f›lds
).') ';

690 
$sql
 .ğ
$this
->
	`budS–eùSql
(
$İtiÚs
);

691  
$this
->
	`execu‹
(
$sql
);

692 
	}
}

701 
public
 
funùiÚ
 
	$upd©e
(
$d©a
,
$İtiÚs
) {

702 
$this
->
mod–
 = 
$İtiÚs
['model'];

703 
$sql
 = 'UPDATE '

704 .
$this
->
	`·r£TabË
(
$İtiÚs
['table'])

705 .
$this
->
	`·r£S‘
(
$d©a
)

706 .
$this
->
	`·r£Wh”e
(!
	`em±y
(
$İtiÚs
['where'])?$options['where']:'')

707 .
$this
->
	`·r£Ord”
(!
	`em±y
(
$İtiÚs
['order'])?$options['order']:'')

708 .
$this
->
	`·r£Lim™
(!
	`em±y
(
$İtiÚs
['limit'])?$options['limit']:'')

709 .
$this
->
	`·r£Lock
(
	`is£t
(
$İtiÚs
['lock'])?$İtiÚs['lock']:
çl£
)

710 .
$this
->
	`·r£Comm’t
(!
	`em±y
(
$İtiÚs
['comment'])?$options['comment']:'');

711  
$this
->
	`execu‹
(
$sql
);

712 
	}
}

720 
public
 
funùiÚ
 
d–‘e
(
$İtiÚs
=
	$¬¿y
()) {

721 
$this
->
mod–
 = 
$İtiÚs
['model'];

722 
$sql
 = 'DELETE FROM '

723 .
$this
->
	`·r£TabË
(
$İtiÚs
['table'])

724 .
$this
->
	`·r£Wh”e
(!
	`em±y
(
$İtiÚs
['where'])?$options['where']:'')

725 .
$this
->
	`·r£Ord”
(!
	`em±y
(
$İtiÚs
['order'])?$options['order']:'')

726 .
$this
->
	`·r£Lim™
(!
	`em±y
(
$İtiÚs
['limit'])?$options['limit']:'')

727 .
$this
->
	`·r£Lock
(
	`is£t
(
$İtiÚs
['lock'])?$İtiÚs['lock']:
çl£
)

728 .
$this
->
	`·r£Comm’t
(!
	`em±y
(
$İtiÚs
['comment'])?$options['comment']:'');

729  
$this
->
	`execu‹
(
$sql
);

730 
	}
}

738 
public
 
funùiÚ
 
£Ëù
(
$İtiÚs
=
	$¬¿y
()) {

739 
$this
->
mod–
 = 
$İtiÚs
['model'];

740 
$sql
 = 
$this
->
	`budS–eùSql
(
$İtiÚs
);

741 
$ÿche
 = 
	`is£t
(
$İtiÚs
['ÿche'])?$İtiÚs['ÿche']:
çl£
;

742 if(
$ÿche
) {

743 
$key
 = 
	`is_¡ršg
(
$ÿche
['key'])?$ÿche['key']:
	`md5
(
$sql
);

744 
$v®ue
 = 
	`S
(
$key
,'',
$ÿche
);

745 if(
çl£
 !=ğ
$v®ue
) {

746  
$v®ue
;

749 
$»suÉ
 = 
$this
->
	`qu”y
(
$sql
);

750 if(
$ÿche
 && 
çl£
 !=ğ
$»suÉ
 ) {

751 
	`S
(
$key
,
$»suÉ
,
$ÿche
);

753  
$»suÉ
;

754 
	}
}

762 
public
 
funùiÚ
 
budS–eùSql
(
$İtiÚs
=
	$¬¿y
()) {

763 if(
	`is£t
(
$İtiÚs
['page'])) {

765 if(
	`¡½os
(
$İtiÚs
['page'],',')) {

766 
	`li¡
(
$·ge
,
$li¡Rows
èğ
	`ex¶ode
(',',
$İtiÚs
['page']);

768 
$·ge
 = 
$İtiÚs
['page'];

770 
$·ge
 = $page?$page:1;

771 
$li¡Rows
ğ
	`is£t
($li¡Rows)?$li¡Rows:(
	`is_num”ic
(
$İtiÚs
['limit'])?$options['limit']:20);

772 
$off£t
 = 
$li¡Rows
*(()
$·ge
-1);

773 
$İtiÚs
['lim™'] = 
$off£t
.','.
$li¡Rows
;

775 if(
	`C
('DB_SQL_BUILD_CACHE')) {

776 
$key
 = 
	`md5
(
	`£rŸlize
(
$İtiÚs
));

777 
$v®ue
 = 
	`S
(
$key
);

778 if(
çl£
 !=ğ
$v®ue
) {

779  
$v®ue
;

782 
$sql
 = 
$this
->
	`·r£Sql
($this->
£ËùSql
,
$İtiÚs
);

783 
$sql
 .ğ
$this
->
	`·r£Lock
(
	`is£t
(
$İtiÚs
['lock'])?$İtiÚs['lock']:
çl£
);

784 if(
	`is£t
(
$key
)) {

785 
	`S
(
$key
,
$sql
,
	`¬¿y
('expœe'=>0,'Ëngth'=>
	`C
('DB_SQL_BUILD_LENGTH'),'queue'=>C('DB_SQL_BUILD_QUEUE')));

787  
$sql
;

788 
	}
}

796 
public
 
funùiÚ
 
·r£Sql
(
$sql
,
$İtiÚs
=
	$¬¿y
()){

797 
$sql
 = 
	`¡r_»¶aû
(

798 
	`¬¿y
('%TABLE%','%DISTINCT%','%FIELD%','%JOIN%','%WHERE%','%GROUP%','%HAVING%','%ORDER%','%LIMIT%','%UNION%','%COMMENT%'),

799 
	`¬¿y
(

800 
$this
->
	`·r£TabË
(
$İtiÚs
['table']),

801 
$this
->
	`·r£Di¡šù
(
	`is£t
(
$İtiÚs
['di¡šù'])?$İtiÚs['di¡šù']:
çl£
),

802 
$this
->
	`·r£F›ld
(!
	`em±y
(
$İtiÚs
['field'])?$options['field']:'*'),

803 
$this
->
	`·r£Još
(!
	`em±y
(
$İtiÚs
['join'])?$options['join']:''),

804 
$this
->
	`·r£Wh”e
(!
	`em±y
(
$İtiÚs
['where'])?$options['where']:''),

805 
$this
->
	`·r£Group
(!
	`em±y
(
$İtiÚs
['group'])?$options['group']:''),

806 
$this
->
	`·r£Havšg
(!
	`em±y
(
$İtiÚs
['having'])?$options['having']:''),

807 
$this
->
	`·r£Ord”
(!
	`em±y
(
$İtiÚs
['order'])?$options['order']:''),

808 
$this
->
	`·r£Lim™
(!
	`em±y
(
$İtiÚs
['limit'])?$options['limit']:''),

809 
$this
->
	`·r£UniÚ
(!
	`em±y
(
$İtiÚs
['union'])?$options['union']:''),

810 
$this
->
	`·r£Comm’t
(!
	`em±y
(
$İtiÚs
['comment'])?$options['comment']:'')

811 ),
$sql
);

812  
$sql
;

813 
	}
}

821 
public
 
funùiÚ
 
g‘La¡Sql
(
$mod–
='') {

822  
$mod–
?
$this
->
mod–Sql
[$mod–]:$this->
qu”ySŒ
;

830 
public
 
funùiÚ
 
	$g‘La¡InsID
() {

831  
$this
->
Ï¡InsID
;

832 
	}
}

839 
public
 
funùiÚ
 
	$g‘E¼Ü
() {

840  
$this
->
”rÜ
;

841 
	}
}

849 
public
 
funùiÚ
 
	$esÿ³SŒšg
(
$¡r
) {

850  
	`add¦ashes
(
$¡r
);

851 
	}
}

859 
public
 
funùiÚ
 
	$£tMod–
(
$mod–
){

860 
$this
->
mod–
 = 
$mod–
;

861 
	}
}

867 
public
 
funùiÚ
 
	$__de¡ruù
() {

869 ià(
$this
->
qu”yID
){

870 
$this
->
	`ä“
();

873 
$this
->
	`şo£
();

874 
	}
}

877 
public
 
funùiÚ
 
	$şo£
(){
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\Dispatcher.class.php

1 <?
php


20 şas 
	cDi¥©ch”
 {

27 
public
 
funùiÚ
 
	$di¥©ch
() {

28 
$u¾Mode
 = 
	`C
('URL_MODEL');

29 if(!
	`em±y
(
$_GET
[
	`C
('VAR_PATHINFO')])) {

30 
$_SERVER
['PATH_INFO'] = 
$_GET
[
	`C
('VAR_PATHINFO')];

31 
	`un£t
(
$_GET
[
	`C
('VAR_PATHINFO')]);

33 if(
$u¾Mode
 =ğ
URL_COMPAT
 ){

35 
	`defše
('PHP_FILE',
_PHP_FILE_
.'?'.
	`C
('VAR_PATHINFO').'=');

36 }
	`–£if
(
$u¾Mode
 =ğ
URL_REWRITE
 ) {

38 
$u¾
 = 
	`dœÇme
(
_PHP_FILE_
);

39 if(
$u¾
 == '/' || $url == '\\')

40 
$u¾
 = '';

41 
	`defše
('PHP_FILE',
$u¾
);

44 
	`defše
('PHP_FILE',
_PHP_FILE_
);

48 if(
	`C
('APP_SUB_DOMAIN_DEPLOY')) {

49 
$ruËs
 = 
	`C
('APP_SUB_DOMAIN_RULES');

50 
$subDomaš
 = 
	`¡¹Şow”
(
	`sub¡r
(
$_SERVER
['HTTP_HOST'],0,
	`¡½os
($_SERVER['HTTP_HOST'],'.')));

51 
	`defše
('SUB_DOMAIN',
$subDomaš
);

52 if(
$subDomaš
 && 
	`is£t
(
$ruËs
[$subDomain])) {

53 
$ruË
 = 
$ruËs
[
$subDomaš
];

54 }
	`–£if
(
	`is£t
(
$ruËs
['*'])){

55 if('www' !ğ
$subDomaš
 && !
	`š_¬¿y
($subDomaš,
	`C
('APP_SUB_DOMAIN_DENY'))) {

56 
$ruË
 = 
$ruËs
['*'];

59 if(!
	`em±y
(
$ruË
)) {

61 
$¬¿y
 = 
	`ex¶ode
('/',
$ruË
[0]);

62 
$moduË
 = 
	`¬¿y_pİ
(
$¬¿y
);

63 if(!
	`em±y
(
$moduË
)) {

64 
$_GET
[
	`C
('VAR_MODULE')] = 
$moduË
;

65 
$domašModuË
 = 
Œue
;

67 if(!
	`em±y
(
$¬¿y
)) {

68 
$_GET
[
	`C
('VAR_GROUP')] = 
	`¬¿y_pİ
(
$¬¿y
);

69 
$domašGroup
 = 
Œue
;

71 if(
	`is£t
(
$ruË
[1])) {

72 
	`·r£_¡r
(
$ruË
[1],
$·rms
);

73 
$_GET
 = 
	`¬¿y_m”ge
($_GET,
$·rms
);

78 if(
	`em±y
(
$_SERVER
['PATH_INFO'])) {

79 
$ty³s
 = 
	`ex¶ode
(',',
	`C
('URL_PATHINFO_FETCH'));

80 
	`fÜ—ch
 (
$ty³s
 
as
 
$ty³
){

81 if(0===
	`¡½os
(
$ty³
,':')) {

82 
$_SERVER
['PATH_INFO'] = 
	`ÿÎ_u£r_func
(
	`sub¡r
(
$ty³
,1));

84 }
	`–£if
(!
	`em±y
(
$_SERVER
[
$ty³
])) {

85 
$_SERVER
['PATH_INFO'] = (0 ==ğ
	`¡½os
($_SERVER[
$ty³
],$_SERVER['SCRIPT_NAME']))?

86 
	`sub¡r
(
$_SERVER
[
$ty³
], 
	`¡¾’
($_SERVER['SCRIPT_NAME'])) : $_SERVER[$type];

91 
$d•r
 = 
	`C
('URL_PATHINFO_DEPR');

92 if(!
	`em±y
(
$_SERVER
['PATH_INFO'])) {

93 
	`g
('path_info');

94 
$·¹
 = 
	`·thšfo
(
$_SERVER
['PATH_INFO']);

95 
	`defše
('__EXT__', 
	`is£t
(
$·¹
['ex‹nsiÚ'])?
	`¡¹Şow”
($part['extension']):'');

96 if(
	`C
('URL_HTML_SUFFIX')) {

97 
$_SERVER
['PATH_INFO'] = 
	`´eg_»¶aû
('/\.('.
	`Œim
(
	`C
('URL_HTML_SUFFIX'),'.').')$/i', '', $_SERVER['PATH_INFO']);

98 }
	`–£if
(
__EXT__
) {

99 
$_SERVER
['PATH_INFO'] = 
	`´eg_»¶aû
('/.'.
__EXT__
.'$/i','',$_SERVER['PATH_INFO']);

101 if(!
£lf
::
	`rou‹rCheck
()){

102 
$·ths
 = 
	`ex¶ode
(
$d•r
,
	`Œim
(
$_SERVER
['PATH_INFO'],'/'));

103 if(
	`C
('VAR_URL_PARAMS')) {

105 
$_GET
[
	`C
('VAR_URL_PARAMS')] = 
$·ths
;

107 
$v¬
 = 
	`¬¿y
();

108 ià(
	`C
('APP_GROUP_LIST'è&& !
	`is£t
(
$_GET
[C('VAR_GROUP')])){

109 
$v¬
[
	`C
('VAR_GROUP')] = 
	`š_¬¿y
(
	`¡¹Şow”
(
$·ths
[0]),
	`ex¶ode
(',',¡¹Şow”(C('APP_GROUP_LIST'))))? 
	`¬¿y_shiá
($paths) : '';

110 if(
	`C
('APP_GROUP_DENY'è&& 
	`š_¬¿y
(
	`¡¹Şow”
(
$v¬
[C('VAR_GROUP')]),
	`ex¶ode
(',',strtolower(C('APP_GROUP_DENY'))))) {

112 
ex™
;

115 if(!
	`is£t
(
$_GET
[
	`C
('VAR_MODULE')])) {

116 
$v¬
[
	`C
('VAR_MODULE')] = 
	`¬¿y_shiá
(
$·ths
);

118 
$v¬
[
	`C
('VAR_ACTION')] = 
	`¬¿y_shiá
(
$·ths
);

120 
	`´eg_»¶aû
('@(\w+)\/([^\/]+)@e', '$v¬[\'\\1\']=¡r_gs(\'\\2\');', 
	`im¶ode
('/',
$·ths
));

121 
$_GET
 = 
	`¬¿y_m”ge
(
$v¬
,$_GET);

123 
	`defše
('__INFO__',
$_SERVER
['PATH_INFO']);

127 
	`defše
('__SELF__',
	`¡r_gs
(
$_SERVER
['REQUEST_URI']));

129 
	`defše
('__APP__',
	`¡r_gs
(
PHP_FILE
));

132 ià(
	`C
('APP_GROUP_LIST')) {

133 
	`defše
('GROUP_NAME', 
£lf
::
	`g‘Group
(
	`C
('VAR_GROUP')));

135 
	`defše
('__GROUP__',(!
	`em±y
(
$domašGroup
è|| 
	`¡¹Şow”
(
GROUP_NAME
è=ğ¡¹Şow”(
	`C
('DEFAULT_GROUP')è)?
__APP__
 : __APP__.'/'.GROUP_NAME);

139 
	`defše
('BASE_LIB_PATH', (
	`defšed
('GROUP_NAME'è&& 
	`C
('APP_GROUP_MODE')==1è? 
APP_PATH
.C('APP_GROUP_PATH').'/'.
GROUP_NAME
.'/' : 
LIB_PATH
);

140 if(
	`defšed
('GROUP_NAME')) {

141 if(1 =ğ
	`C
('APP_GROUP_MODE')){

142 
$cÚfig_·th
 = 
BASE_LIB_PATH
.'Conf/';

143 
$commÚ_·th
 = 
BASE_LIB_PATH
.'Common/';

145 
$cÚfig_·th
 = 
CONF_PATH
.
GROUP_NAME
.'/';

146 
$commÚ_·th
 = 
COMMON_PATH
.
GROUP_NAME
.'/';

149 if(
	`is_fe
(
$cÚfig_·th
.'config.php'))

150 
	`C
(
šşude
 
$cÚfig_·th
.'config.php');

152 if(
	`is_fe
(
$cÚfig_·th
.'alias.php'))

153 
	`®Ÿs_impÜt
(
šşude
 
$cÚfig_·th
.'alias.php');

155 if(
	`is_fe
(
$commÚ_·th
.'function.php'))

156 
šşude
 
$commÚ_·th
.'function.php';

159 
	`defše
('MODULE_NAME',
£lf
::
	`g‘ModuË
(
	`C
('VAR_MODULE')));

160 
	`defše
('ACTION_NAME',
£lf
::
	`g‘AùiÚ
(
	`C
('VAR_ACTION')));

163 
$moduËName
 = 
	`defšed
('MODULE_ALIAS')?
MODULE_ALIAS
:
MODULE_NAME
;

164 if(
	`defšed
('GROUP_NAME')) {

165 
	`defše
('__URL__',!
	`em±y
(
$domašModuË
)?
__GROUP__
.
$d•r
 : __GROUP__.$d•r.
$moduËName
);

167 
	`defše
('__URL__',!
	`em±y
(
$domašModuË
)?
__APP__
.'/' : __APP__.'/'.
$moduËName
);

170 
	`defše
('__ACTION__',
__URL__
.
$d•r
.(
	`defšed
('ACTION_ALIAS')?
ACTION_ALIAS
:
ACTION_NAME
));

172 
$_REQUEST
 = 
	`¬¿y_m”ge
(
$_POST
,
$_GET
);

180 
public
 
funùiÚ
 
	$rou‹rCheck
() {

181 
$»tuº
 = 
çl£
;

183 
	`g
('rou‹_check',
$»tuº
);

184  
$»tuº
;

185 
	}
}

192 
´iv©e
 
funùiÚ
 
	$g‘ModuË
(
$v¬
) {

193 
$moduË
 = (!
	`em±y
(
$_GET
[
$v¬
])? $_GET[$v¬]:
	`C
('DEFAULT_MODULE'));

194 
	`un£t
(
$_GET
[
$v¬
]);

195 if(
$m­s
 = 
	`C
('URL_MODULE_MAP')) {

196 if(
	`is£t
(
$m­s
[
	`¡¹Şow”
(
$moduË
)])) {

198 
	`defše
('MODULE_ALIAS',
	`¡¹Şow”
(
$moduË
));

200  
$m­s
[
MODULE_ALIAS
];

201 }
	`–£if
(
	`¬¿y_£¬ch
(
	`¡¹Şow”
(
$moduË
),
$m­s
)){

206 if(
	`C
('URL_CASE_INSENSITIVE')) {

209 
$moduË
 = 
	`ucfœ¡
(
	`·r£_Çme
($module,1));

211  
	`¡r_gs
(
$moduË
);

212 
	}
}

219 
´iv©e
 
funùiÚ
 
	$g‘AùiÚ
(
$v¬
) {

220 
$aùiÚ
 = !
	`em±y
(
$_POST
[
$v¬
]) ?

221 
$_POST
[
$v¬
] :

222 (!
	`em±y
(
$_GET
[
$v¬
])?$_GET[$v¬]:
	`C
('DEFAULT_ACTION'));

223 
	`un£t
(
$_POST
[
$v¬
],
$_GET
[$var]);

224 if(
$m­s
 = 
	`C
('URL_ACTION_MAP')) {

225 if(
	`is£t
(
$m­s
[
	`¡¹Şow”
(
MODULE_NAME
)])) {

226 
$m­s
 = $m­s[
	`¡¹Şow”
(
MODULE_NAME
)];

227 if(
	`is£t
(
$m­s
[
	`¡¹Şow”
(
$aùiÚ
)])) {

229 
	`defše
('ACTION_ALIAS',
	`¡¹Şow”
(
$aùiÚ
));

231  
$m­s
[
ACTION_ALIAS
];

232 }
	`–£if
(
	`¬¿y_£¬ch
(
	`¡¹Şow”
(
$aùiÚ
),
$m­s
)){

238  
	`¡r_gs
(
	`C
('URL_CASE_INSENSITIVE')?
	`¡¹Şow”
(
$aùiÚ
):$action);

239 
	}
}

246 
´iv©e
 
funùiÚ
 
	$g‘Group
(
$v¬
) {

247 
$group
 = (!
	`em±y
(
$_GET
[
$v¬
])?$_GET[$v¬]:
	`C
('DEFAULT_GROUP'));

248 
	`un£t
(
$_GET
[
$v¬
]);

249  
	`¡r_gs
(
	`C
('URL_CASE_INSENSITIVE'è?
	`ucfœ¡
(
	`¡¹Şow”
(
$group
)):$group);

250 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\Log.class.php

1 <?
php


19 şas 
	cLog
 {

22 cÚ¡ 
	mEMERG
 = 'EMERG';

23 cÚ¡ 
	mALERT
 = 'ALERT';

24 cÚ¡ 
	mCRIT
 = 'CRIT';

25 cÚ¡ 
	mERR
 = 'ERR';

26 cÚ¡ 
	mWARN
 = 'WARN';

27 cÚ¡ 
	mNOTICE
 = 'NOTIC';

28 cÚ¡ 
	mINFO
 = 'INFO';

29 cÚ¡ 
	mDEBUG
 = 'DEBUG';

30 cÚ¡ 
	mSQL
 = 'SQL';

33 cÚ¡ 
	mSYSTEM
 = 0;

34 cÚ¡ 
	mMAIL
 = 1;

35 cÚ¡ 
	mFILE
 = 3;

36 cÚ¡ 
	mSAPI
 = 4;

39 
	m$log
 = 
¬¿y
();

42 
	m$fÜm©
 = '[ c ]';

53 
funùiÚ
 
	$»cÜd
(
$mes§ge
,
$Ëv–
=
£lf
::
ERR
,
$»cÜd
=
çl£
) {

54 if(
$»cÜd
 || 
çl£
 !=ğ
	`¡½os
(
	`C
('LOG_LEVEL'),
$Ëv–
)) {

55 
£lf
::
$log
[] = "{$level}: {$message}\r\n";

68 
funùiÚ
 
	`§ve
(
$ty³
='',
$de¡š©iÚ
='',
$exŒa
='') {

69 if(
	`em±y
(
£lf
::
$log
))  ;

70 
$ty³
 = $ty³?$ty³:
	`C
('LOG_TYPE');

71 if(
£lf
::
FILE
 =ğ
$ty³
) {

72 if(
	`em±y
(
$de¡š©iÚ
))

73 
$de¡š©iÚ
 = 
LOG_PATH
.
	`d©e
('y_m_d').'.log';

75 if(
	`is_fe
(
$de¡š©iÚ
è&& 
	`æoÜ
(
	`C
('LOG_FILE_SIZE')è<ğ
	`fesize
($destination) )

76 
	`»Çme
(
$de¡š©iÚ
,
	`dœÇme
($de¡š©iÚ).'/'.
	`time
().'-'.
	`ba£Çme
($destination));

78 
$de¡š©iÚ
 = $de¡š©iÚ?$de¡š©iÚ:
	`C
('LOG_DEST');

79 
$exŒa
 = $exŒa?$exŒa:
	`C
('LOG_EXTRA');

81 
$now
 = 
	`d©e
(
£lf
::
$fÜm©
);

82 
	`”rÜ_log
(
$now
.' '.
	`g‘_ş›Á_
().' '.
$_SERVER
['REQUEST_URI']."\r\n".
	`im¶ode
('',
£lf
::
$log
)."\r\n", 
$ty³
,
$de¡š©iÚ
 ,
$exŒa
);

84 
£lf
::
$log
 = 
	`¬¿y
();

86 
	}
}

99 
funùiÚ
 
wr™e
(
$mes§ge
,
$Ëv–
=
£lf
::
ERR
,
$ty³
='',
$de¡š©iÚ
='',
$exŒa
='') {

100 
$now
 = 
d©e
(
£lf
::
$fÜm©
);

101 
	g$ty³
 = 
$ty³
?$ty³:
C
('LOG_TYPE');

102 if(
	g£lf
::
FILE
 =ğ
$ty³
) {

103 if(
em±y
(
$de¡š©iÚ
))

104 
$de¡š©iÚ
 = 
LOG_PATH
.
d©e
('y_m_d').'.log';

106 if(
is_fe
(
$de¡š©iÚ
è&& 
æoÜ
(
C
('LOG_FILE_SIZE')è<ğ
fesize
($destination) )

107 
»Çme
(
$de¡š©iÚ
,
dœÇme
($de¡š©iÚ).'/'.
time
().'-'.
ba£Çme
($destination));

109 
	g$de¡š©iÚ
 = 
$de¡š©iÚ
?$de¡š©iÚ:
C
('LOG_DEST');

110 
	g$exŒa
 = 
$exŒa
?$exŒa:
C
('LOG_EXTRA');

112 
”rÜ_log
("{$now} {$Ëv–}: {$mes§ge}\r\n", 
$ty³
,
$de¡š©iÚ
,
$exŒa
 );

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\Model.class.php

1 <?
php


20 şas 
	cMod–
 {

22 cÚ¡ 
	mMODEL_INSERT
 = 1;

23 cÚ¡ 
	mMODEL_UPDATE
 = 2;

24 cÚ¡ 
	mMODEL_BOTH
 = 3;

25 cÚ¡ 
	mMUST_VALIDATE
 = 1;

26 cÚ¡ 
	mEXISTS_VALIDATE
 = 0;

27 cÚ¡ 
	mVALUE_VALIDATE
 = 2;

29 
´iv©e
 
	m$_extMod–
 = 
nuÎ
;

31 
´Ùeùed
 
	m$db
 = 
nuÎ
;

33 
´Ùeùed
 
	m$pk
 = 'id';

35 
´Ùeùed
 
	m$bËP»fix
 = '';

37 
´Ùeùed
 
	m$Çme
 = '';

39 
´Ùeùed
 
	m$dbName
 = '';

41 
´Ùeùed
 
	m$cÚÃùiÚ
 = '';

43 
´Ùeùed
 
	m$bËName
 = '';

45 
´Ùeùed
 
	m$ŒueTabËName
 = '';

47 
´Ùeùed
 
	m$”rÜ
 = '';

49 
´Ùeùed
 
	m$f›lds
 = 
¬¿y
();

51 
´Ùeùed
 
	m$d©a
 = 
¬¿y
();

53 
´Ùeùed
 
	m$İtiÚs
 = 
¬¿y
();

54 
´Ùeùed
 
	m$_v®id©e
 = 
¬¿y
();

55 
´Ùeùed
 
	m$_auto
 = 
¬¿y
();

56 
´Ùeùed
 
	m$_m­
 = 
¬¿y
();

57 
´Ùeùed
 
	m$_scİe
 = 
¬¿y
();

59 
´Ùeùed
 
	m$autoCheckF›lds
 = 
Œue
;

61 
´Ùeùed
 
	m$·tchV®id©e
 = 
çl£
;

63 
´Ùeùed
 
	m$m‘hods
 = 
¬¿y
('table','order','alias','having','group','lock','distinct','auto','filter','validate');

73 
public
 
funùiÚ
 
__cÚ¡ruù
(
$Çme
='',
$bËP»fix
='',
$cÚÃùiÚ
='') {

75 
$this
->
_š™Ÿlize
();

77 if(!
em±y
(
$Çme
)) {

78 if(
¡½os
(
$Çme
,'.')) {

79 
li¡
(
$this
->
dbName
,$this->
Çme
èğ
ex¶ode
('.',
$Çme
);

81 
	m$this
->
	mÇme
 = 
$Çme
;

83 }
–£if
(
em±y
(
$this
->
Çme
)){

84 
	m$this
->
	mÇme
 = 
$this
->
g‘Mod–Name
();

87 if(
is_nuÎ
(
$bËP»fix
)) {

88 
	m$this
->
	mbËP»fix
 = '';

89 }
–£if
('' !ğ
$bËP»fix
) {

90 
$this
->
bËP»fix
 = 
$bËP»fix
;

92 
	m$this
->
	mbËP»fix
 = 
$this
->
bËP»fix
?$this->bËP»fix:
C
('DB_PREFIX');

98 
	m$this
->
db
(0,
em±y
(
$this
->
cÚÃùiÚ
)?
$cÚÃùiÚ
:$this->connection);

106 
´Ùeùed
 
funùiÚ
 
	$_checkTabËInfo
() {

109 if(
	`em±y
(
$this
->
f›lds
)) {

111 if(
	`C
('DB_FIELDS_CACHE')) {

112 
$db
 = 
$this
->
dbName
?$this->dbName:
	`C
('DB_NAME');

113 
$f›lds
 = 
	`F
('_f›lds/'.
	`¡¹Şow”
(
$db
.'.'.
$this
->
Çme
));

114 if(
$f›lds
) {

115 
$v”siÚ
 = 
	`C
('DB_FIELD_VERISON');

116 if(
	`em±y
(
$v”siÚ
è|| 
$f›lds
['_version']== $version) {

117 
$this
->
f›lds
 = 
$f›lds
;

123 
$this
->
	`æush
();

125 
	}
}

132 
public
 
funùiÚ
 
	$æush
() {

134 
$this
->
db
->
	`£tMod–
($this->
Çme
);

135 
$f›lds
 = 
$this
->
db
->
	`g‘F›lds
($this->
	`g‘TabËName
());

136 if(!
$f›lds
) {

137  
çl£
;

139 
$this
->
f›lds
 = 
	`¬¿y_keys
(
$f›lds
);

140 
$this
->
f›lds
['_autošc'] = 
çl£
;

141 
	`fÜ—ch
 (
$f›lds
 
as
 
$key
=>
$v®
){

143 
$ty³
[
$key
] = 
$v®
['type'];

144 if(
$v®
['primary']) {

145 
$this
->
f›lds
['_pk'] = 
$key
;

146 if(
$v®
['autošc']è
$this
->
f›lds
['_autošc'] = 
Œue
;

150 
$this
->
f›lds
['_ty³'] = 
$ty³
;

151 if(
	`C
('DB_FIELD_VERISON')è
$this
->
f›lds
['_version'] = C('DB_FIELD_VERISON');

154 if(
	`C
('DB_FIELDS_CACHE')){

156 
$db
 = 
$this
->
dbName
?$this->dbName:
	`C
('DB_NAME');

157 
	`F
('_f›lds/'.
	`¡¹Şow”
(
$db
.'.'.
$this
->
Çme
),$this->
f›lds
);

159 
	}
}

168 
public
 
funùiÚ
 
sw™chMod–
(
$ty³
,
$v¬s
=
	$¬¿y
()) {

169 
$şass
 = 
	`ucwÜds
(
	`¡¹Şow”
(
$ty³
)).'Model';

170 if(!
	`şass_exi¡s
(
$şass
))

171 
	`throw_exû±iÚ
(
$şass
.
	`L
('_MODEL_NOT_EXIST_'));

173 
$this
->
_extMod–
 = 
Ãw
 
	`$şass
($this->
Çme
);

174 if(!
	`em±y
(
$v¬s
)) {

176 
	`fÜ—ch
 (
$v¬s
 
as
 
$v¬
)

177 
$this
->
_extMod–
->
	`£tPrİ”ty
(
$v¬
,$this->$var);

179  
$this
->
_extMod–
;

180 
	}
}

189 
public
 
funùiÚ
 
	$__£t
(
$Çme
,
$v®ue
) {

191 
$this
->
d©a
[
$Çme
] = 
$v®ue
;

192 
	}
}

200 
public
 
funùiÚ
 
	$__g‘
(
$Çme
) {

201  
	`is£t
(
$this
->
d©a
[
$Çme
])?$this->d©a[$Çme]:
nuÎ
;

202 
	}
}

210 
public
 
funùiÚ
 
	$__is£t
(
$Çme
) {

211  
	`is£t
(
$this
->
d©a
[
$Çme
]);

212 
	}
}

220 
public
 
funùiÚ
 
	$__un£t
(
$Çme
) {

221 
	`un£t
(
$this
->
d©a
[
$Çme
]);

222 
	}
}

231 
public
 
funùiÚ
 
	$__ÿÎ
(
$m‘hod
,
$¬gs
) {

232 if(
	`š_¬¿y
(
	`¡¹Şow”
(
$m‘hod
),
$this
->
m‘hods
,
Œue
)) {

234 
$this
->
İtiÚs
[
	`¡¹Şow”
(
$m‘hod
)] = 
$¬gs
[0];

235  
$this
;

236 }
	`–£if
(
	`š_¬¿y
(
	`¡¹Şow”
(
$m‘hod
),
	`¬¿y
('couÁ','sum','mš','max','avg'),
Œue
)){

238 
$f›ld
 = 
	`is£t
(
$¬gs
[0])?$args[0]:'*';

239  
$this
->
	`g‘F›ld
(
	`¡¹ouµ”
(
$m‘hod
).'('.
$f›ld
.') ASp_'.$method);

240 }
	`–£if
(
	`¡¹Şow”
(
	`sub¡r
(
$m‘hod
,0,5))=='getby') {

242 
$f›ld
 = 
	`·r£_Çme
(
	`sub¡r
(
$m‘hod
,5));

243 
$wh”e
[
$f›ld
] = 
$¬gs
[0];

244  
$this
->
	`wh”e
(
$wh”e
)->
	`fšd
();

245 }
	`–£if
(
	`¡¹Şow”
(
	`sub¡r
(
$m‘hod
,0,10))=='getfieldby') {

247 
$Çme
 = 
	`·r£_Çme
(
	`sub¡r
(
$m‘hod
,10));

248 
$wh”e
[
$Çme
] =
$¬gs
[0];

249  
$this
->
	`wh”e
(
$wh”e
)->
	`g‘F›ld
(
$¬gs
[1]);

250 }
	`–£if
(
	`is£t
(
$this
->
_scİe
[
$m‘hod
])){

251  
$this
->
	`scİe
(
$m‘hod
,
$¬gs
[0]);

253 
	`throw_exû±iÚ
(
__CLASS__
.':'.
$m‘hod
.
	`L
('_METHOD_NOT_EXIST_'));

256 
	}
}

258 
´Ùeùed
 
funùiÚ
 
	$_š™Ÿlize
(è{
	}
}

266 
´Ùeùed
 
funùiÚ
 
	$_çÿde
(
$d©a
) {

268 if(!
	`em±y
(
$this
->
f›lds
)) {

269 
	`fÜ—ch
 (
$d©a
 
as
 
$key
=>
$v®
){

270 if(!
	`š_¬¿y
(
$key
,
$this
->
f›lds
,
Œue
)){

271 
	`un£t
(
$d©a
[
$key
]);

272 }
	`–£if
(
	`is_sÿÏr
(
$v®
)) {

274 
$this
->
	`_·r£Ty³
(
$d©a
,
$key
);

279 if(!
	`em±y
(
$this
->
İtiÚs
['filter'])) {

280 
$d©a
 = 
	`¬¿y_m­
(
$this
->
İtiÚs
['filter'],$data);

281 
	`un£t
(
$this
->
İtiÚs
['filter']);

283 
$this
->
	`_befÜe_wr™e
(
$d©a
);

284  
$d©a
;

285 
	}
}

288 
´Ùeùed
 
funùiÚ
 
	$_befÜe_wr™e
(&
$d©a
è{
	}
}

298 
public
 
funùiÚ
 
add
(
$d©a
='',
$İtiÚs
=
¬¿y
(),
$»¶aû
=
çl£
) {

299 if(
em±y
(
$d©a
)) {

301 if(!
em±y
(
$this
->
d©a
)) {

302 
$d©a
 = 
$this
->
d©a
;

304 
	g$this
->
	gd©a
 = 
¬¿y
();

306 
	g$this
->
	g”rÜ
 = 
L
('_DATA_TYPE_INVALID_');

307  
	gçl£
;

311 
	g$İtiÚs
 = 
$this
->
_·r£O±iÚs
(
$İtiÚs
);

313 
	g$d©a
 = 
$this
->
_çÿde
(
$d©a
);

314 if(
	gçl£
 ==ğ
$this
->
_befÜe_š£¹
(
$d©a
,
$İtiÚs
)) {

315  
	gçl£
;

318 
	g$»suÉ
 = 
$this
->
db
->
š£¹
(
$d©a
,
$İtiÚs
,
$»¶aû
);

319 if(
	gçl£
 !=ğ
$»suÉ
 ) {

320 
$š£¹Id
 = 
$this
->
g‘La¡InsID
();

321 if(
	g$š£¹Id
) {

323 
	g$d©a
[
$this
->
g‘Pk
()] = 
$š£¹Id
;

324 
	g$this
->
_aá”_š£¹
(
$d©a
,
$İtiÚs
);

325  
	g$š£¹Id
;

327 
	g$this
->
_aá”_š£¹
(
$d©a
,
$İtiÚs
);

329  
	g$»suÉ
;

332 
´Ùeùed
 
funùiÚ
 
	$_befÜe_š£¹
(&
$d©a
,
$İtiÚs
è{
	}
}

334 
´Ùeùed
 
funùiÚ
 
	$_aá”_š£¹
(
$d©a
,
$İtiÚs
è{
	}
}

336 
public
 
funùiÚ
 
addAÎ
(
$d©aLi¡
,
$İtiÚs
=
¬¿y
(),
$»¶aû
=
çl£
){

337 if(
em±y
(
$d©aLi¡
)) {

338 
$this
->
”rÜ
 = 
L
('_DATA_TYPE_INVALID_');

339  
	gçl£
;

342 
	g$İtiÚs
 = 
$this
->
_·r£O±iÚs
(
$İtiÚs
);

344 
fÜ—ch
 (
$d©aLi¡
 
as
 
$key
=>
$d©a
){

345 
$d©aLi¡
[
$key
] = 
$this
->
_çÿde
(
$d©a
);

348 
	g$»suÉ
 = 
$this
->
db
->
š£¹AÎ
(
$d©aLi¡
,
$İtiÚs
,
$»¶aû
);

349 if(
	gçl£
 !=ğ
$»suÉ
 ) {

350 
$š£¹Id
 = 
$this
->
g‘La¡InsID
();

351 if(
	g$š£¹Id
) {

352  
	g$š£¹Id
;

355  
	g$»suÉ
;

366 
public
 
funùiÚ
 
£ËùAdd
(
$f›lds
='',
$bË
='',
$İtiÚs
=
	$¬¿y
()) {

368 
$İtiÚs
 = 
$this
->
	`_·r£O±iÚs
($options);

370 if(
çl£
 ==ğ
$»suÉ
 = 
$this
->
db
->
	`£ËùIn£¹
(
$f›lds
?$f›lds:
$İtiÚs
['f›ld'],
$bË
?$bË:$this->
	`g‘TabËName
(),$options)){

372 
$this
->
”rÜ
 = 
	`L
('_OPERATION_WRONG_');

373  
çl£
;

376  
$»suÉ
;

378 
	}
}

387 
public
 
funùiÚ
 
§ve
(
$d©a
='',
$İtiÚs
=
	$¬¿y
()) {

388 if(
	`em±y
(
$d©a
)) {

390 if(!
	`em±y
(
$this
->
d©a
)) {

391 
$d©a
 = 
$this
->
d©a
;

393 
$this
->
d©a
 = 
	`¬¿y
();

395 
$this
->
”rÜ
 = 
	`L
('_DATA_TYPE_INVALID_');

396  
çl£
;

400 
$d©a
 = 
$this
->
	`_çÿde
($data);

402 
$İtiÚs
 = 
$this
->
	`_·r£O±iÚs
($options);

403 if(
çl£
 ==ğ
$this
->
	`_befÜe_upd©e
(
$d©a
,
$İtiÚs
)) {

404  
çl£
;

406 if(!
	`is£t
(
$İtiÚs
['where']) ) {

408 if(
	`is£t
(
$d©a
[
$this
->
	`g‘Pk
()])) {

409 
$pk
 = 
$this
->
	`g‘Pk
();

410 
$wh”e
[
$pk
] = 
$d©a
[$pk];

411 
$İtiÚs
['wh”e'] = 
$wh”e
;

412 
$pkV®ue
 = 
$d©a
[
$pk
];

413 
	`un£t
(
$d©a
[
$pk
]);

416 
$this
->
”rÜ
 = 
	`L
('_OPERATION_WRONG_');

417  
çl£
;

420 
$»suÉ
 = 
$this
->
db
->
	`upd©e
(
$d©a
,
$İtiÚs
);

421 if(
çl£
 !=ğ
$»suÉ
) {

422 if(
	`is£t
(
$pkV®ue
)è
$d©a
[
$pk
] = $pkValue;

423 
$this
->
	`_aá”_upd©e
(
$d©a
,
$İtiÚs
);

425  
$»suÉ
;

426 
	}
}

428 
´Ùeùed
 
funùiÚ
 
	$_befÜe_upd©e
(&
$d©a
,
$İtiÚs
è{
	}
}

430 
´Ùeùed
 
funùiÚ
 
	$_aá”_upd©e
(
$d©a
,
$İtiÚs
è{
	}
}

438 
public
 
funùiÚ
 
d–‘e
(
$İtiÚs
=
	$¬¿y
()) {

439 if(
	`em±y
(
$İtiÚs
è&&ƒm±y(
$this
->
İtiÚs
['where'])) {

441 if(!
	`em±y
(
$this
->
d©a
è&& 
	`is£t
($this->d©a[$this->
	`g‘Pk
()]))

442  
$this
->
	`d–‘e
($this->
d©a
[$this->
	`g‘Pk
()]);

444  
çl£
;

446 if(
	`is_num”ic
(
$İtiÚs
è|| 
	`is_¡ršg
($options)) {

448 
$pk
 = 
$this
->
	`g‘Pk
();

449 if(
	`¡½os
(
$İtiÚs
,',')) {

450 
$wh”e
[
$pk
] = 
	`¬¿y
('IN', 
$İtiÚs
);

452 
$wh”e
[
$pk
] = 
$İtiÚs
;

454 
$pkV®ue
 = 
$wh”e
[
$pk
];

455 
$İtiÚs
 = 
	`¬¿y
();

456 
$İtiÚs
['wh”e'] = 
$wh”e
;

459 
$İtiÚs
 = 
$this
->
	`_·r£O±iÚs
($options);

460 
$»suÉ
ğ
$this
->
db
->
	`d–‘e
(
$İtiÚs
);

461 if(
çl£
 !=ğ
$»suÉ
) {

462 
$d©a
 = 
	`¬¿y
();

463 if(
	`is£t
(
$pkV®ue
)è
$d©a
[
$pk
] = $pkValue;

464 
$this
->
	`_aá”_d–‘e
(
$d©a
,
$İtiÚs
);

467  
$»suÉ
;

468 
	}
}

470 
´Ùeùed
 
funùiÚ
 
	$_aá”_d–‘e
(
$d©a
,
$İtiÚs
è{
	}
}

478 
public
 
funùiÚ
 
£Ëù
(
$İtiÚs
=
	$¬¿y
()) {

479 if(
	`is_¡ršg
(
$İtiÚs
è|| 
	`is_num”ic
($options)) {

481 
$pk
 = 
$this
->
	`g‘Pk
();

482 if(
	`¡½os
(
$İtiÚs
,',')) {

483 
$wh”e
[
$pk
] = 
	`¬¿y
('IN',
$İtiÚs
);

485 
$wh”e
[
$pk
] = 
$İtiÚs
;

487 
$İtiÚs
 = 
	`¬¿y
();

488 
$İtiÚs
['wh”e'] = 
$wh”e
;

489 }
	`–£if
(
çl£
 ==ğ
$İtiÚs
){

490 
$İtiÚs
 = 
	`¬¿y
();

492 
$İtiÚs
 = 
$this
->
	`_·r£O±iÚs
($options);

493  'Ğ'.
$this
->
db
->
	`budS–eùSql
(
$İtiÚs
).' )';

496 
$İtiÚs
 = 
$this
->
	`_·r£O±iÚs
($options);

497 
$»suÉS‘
 = 
$this
->
db
->
	`£Ëù
(
$İtiÚs
);

498 if(
çl£
 ==ğ
$»suÉS‘
) {

499  
çl£
;

501 if(
	`em±y
(
$»suÉS‘
)) {

502  
nuÎ
;

504 
$this
->
	`_aá”_£Ëù
(
$»suÉS‘
,
$İtiÚs
);

505  
$»suÉS‘
;

506 
	}
}

508 
´Ùeùed
 
funùiÚ
 
	$_aá”_£Ëù
(&
$»suÉS‘
,
$İtiÚs
è{
	}
}

516 
public
 
funùiÚ
 
budSql
(
$İtiÚs
=
	$¬¿y
()) {

518 
$İtiÚs
 = 
$this
->
	`_·r£O±iÚs
($options);

519  'Ğ'.
$this
->
db
->
	`budS–eùSql
(
$İtiÚs
).' )';

520 
	}
}

528 
´Ùeùed
 
funùiÚ
 
_·r£O±iÚs
(
$İtiÚs
=
	$¬¿y
()) {

529 if(
	`is_¬¿y
(
$İtiÚs
))

530 
$İtiÚs
 = 
	`¬¿y_m”ge
(
$this
->
İtiÚs
,$options);

532 
$this
->
İtiÚs
 = 
	`¬¿y
();

533 if(!
	`is£t
(
$İtiÚs
['table'])){

535 
$İtiÚs
['bË'] = 
$this
->
	`g‘TabËName
();

536 
$f›lds
 = 
$this
->
f›lds
;

539 
$f›lds
 = 
$this
->
	`g‘DbF›lds
();

542 if(!
	`em±y
(
$İtiÚs
['alias'])) {

543 
$İtiÚs
['table'] .= ' '.$options['alias'];

546 
$İtiÚs
['mod–'] = 
$this
->
Çme
;

549 if(
	`is£t
(
$İtiÚs
['wh”e']è&& 
	`is_¬¿y
($İtiÚs['wh”e']è&& !
	`em±y
(
$f›lds
)) {

551 
	`fÜ—ch
 (
$İtiÚs
['wh”e'] 
as
 
$key
=>
$v®
){

552 
$key
 = 
	`Œim
($key);

553 if(
	`š_¬¿y
(
$key
,
$f›lds
,
Œue
)){

554 if(
	`is_sÿÏr
(
$v®
)) {

555 
$this
->
	`_·r£Ty³
(
$İtiÚs
['wh”e'],
$key
);

557 }
	`–£if
('_' !ğ
	`sub¡r
(
$key
,0,1è&& 
çl£
 ==ğ
	`¡½os
($key,'.') && false === strpos($key,'|') && false === strpos($key,'&')){

558 
	`un£t
(
$İtiÚs
['wh”e'][
$key
]);

564 
$this
->
	`_İtiÚs_f‹r
(
$İtiÚs
);

565  
$İtiÚs
;

566 
	}
}

568 
´Ùeùed
 
funùiÚ
 
	$_İtiÚs_f‹r
(&
$İtiÚs
è{
	}
}

577 
´Ùeùed
 
funùiÚ
 
	$_·r£Ty³
(&
$d©a
,
$key
) {

578 
$f›ldTy³
 = 
	`¡¹Şow”
(
$this
->
f›lds
['_ty³'][
$key
]);

579 if(
çl£
 ==ğ
	`¡½os
(
$f›ldTy³
,'bigint') && false !== strpos($fieldType,'int')) {

580 
$d©a
[
$key
] = 
	`štv®
($data[$key]);

581 }
	`–£if
(
çl£
 !=ğ
	`¡½os
(
$f›ldTy³
,'float') || false !== strpos($fieldType,'double')){

582 
$d©a
[
$key
] = 
	`æßtv®
($data[$key]);

583 }
	`–£if
(
çl£
 !=ğ
	`¡½os
(
$f›ldTy³
,'bool')){

584 
$d©a
[
$key
] = (
boŞ
)$data[$key];

586 
	}
}

594 
public
 
funùiÚ
 
fšd
(
$İtiÚs
=
	$¬¿y
()) {

595 if(
	`is_num”ic
(
$İtiÚs
è|| 
	`is_¡ršg
($options)) {

596 
$wh”e
[
$this
->
	`g‘Pk
()] = 
$İtiÚs
;

597 
$İtiÚs
 = 
	`¬¿y
();

598 
$İtiÚs
['wh”e'] = 
$wh”e
;

601 
$İtiÚs
['limit'] = 1;

603 
$İtiÚs
 = 
$this
->
	`_·r£O±iÚs
($options);

604 
$»suÉS‘
 = 
$this
->
db
->
	`£Ëù
(
$İtiÚs
);

605 if(
çl£
 ==ğ
$»suÉS‘
) {

606  
çl£
;

608 if(
	`em±y
(
$»suÉS‘
)) {

609  
nuÎ
;

611 
$this
->
d©a
 = 
$»suÉS‘
[0];

612 
$this
->
	`_aá”_fšd
($this->
d©a
,
$İtiÚs
);

613  
$this
->
d©a
;

614 
	}
}

616 
´Ùeùed
 
funùiÚ
 
	$_aá”_fšd
(&
$»suÉ
,
$İtiÚs
è{
	}
}

625 
public
 
funùiÚ
 
	$·r£F›ldsM­
(
$d©a
,
$ty³
=1) {

627 if(!
	`em±y
(
$this
->
_m­
)) {

628 
	`fÜ—ch
 (
$this
->
_m­
 
as
 
$key
=>
$v®
){

629 if(
$ty³
==1) {

630 if(
	`is£t
(
$d©a
[
$v®
])) {

631 
$d©a
[
$key
] = $d©a[
$v®
];

632 
	`un£t
(
$d©a
[
$v®
]);

635 if(
	`is£t
(
$d©a
[
$key
])) {

636 
$d©a
[
$v®
] = $d©a[
$key
];

637 
	`un£t
(
$d©a
[
$key
]);

642  
$d©a
;

643 
	}
}

653 
public
 
funùiÚ
 
£tF›ld
(
$f›ld
,
$v®ue
='') {

654 if(
is_¬¿y
(
$f›ld
)) {

655 
$d©a
 = 
$f›ld
;

657 
	g$d©a
[
$f›ld
] = 
$v®ue
;

659  
	g$this
->
§ve
(
$d©a
);

669 
public
 
funùiÚ
 
	$£tInc
(
$f›ld
,
$¡•
=1) {

670  
$this
->
	`£tF›ld
(
$f›ld
,
	`¬¿y
('exp',$f›ld.'+'.
$¡•
));

671 
	}
}

680 
public
 
funùiÚ
 
	$£tDec
(
$f›ld
,
$¡•
=1) {

681  
$this
->
	`£tF›ld
(
$f›ld
,
	`¬¿y
('exp',$f›ld.'-'.
$¡•
));

682 
	}
}

691 
public
 
funùiÚ
 
	$g‘F›ld
(
$f›ld
,
$£·
=
nuÎ
) {

692 
$İtiÚs
['f›ld'] = 
$f›ld
;

693 
$İtiÚs
 = 
$this
->
	`_·r£O±iÚs
($options);

694 
$f›ld
 = 
	`Œim
($field);

695 if(
	`¡½os
(
$f›ld
,',')) {

696 if(!
	`is£t
(
$İtiÚs
['limit'])){

697 
$İtiÚs
['lim™'] = 
	`is_num”ic
(
$£·
)?$sepa:'';

699 
$»suÉS‘
 = 
$this
->
db
->
	`£Ëù
(
$İtiÚs
);

700 if(!
	`em±y
(
$»suÉS‘
)) {

701 
$_f›ld
 = 
	`ex¶ode
(',', 
$f›ld
);

702 
$f›ld
 = 
	`¬¿y_keys
(
$»suÉS‘
[0]);

703 
$key
 = 
	`¬¿y_shiá
(
$f›ld
);

704 
$key2
 = 
	`¬¿y_shiá
(
$f›ld
);

705 
$cŞs
 = 
	`¬¿y
();

706 
$couÁ
 = 
	`couÁ
(
$_f›ld
);

707 
	`fÜ—ch
 (
$»suÉS‘
 
as
 
$»suÉ
){

708 
$Çme
 = 
$»suÉ
[
$key
];

709 if(2==
$couÁ
) {

710 
$cŞs
[
$Çme
] = 
$»suÉ
[
$key2
];

712 
$cŞs
[
$Çme
] = 
	`is_¡ršg
(
$£·
)?
	`im¶ode
($£·,
$»suÉ
):$result;

715  
$cŞs
;

719 if(
Œue
 !=ğ
$£·
) {

720 
$İtiÚs
['lim™'] = 
	`is_num”ic
(
$£·
)?$sepa:1;

722 
$»suÉ
 = 
$this
->
db
->
	`£Ëù
(
$İtiÚs
);

723 if(!
	`em±y
(
$»suÉ
)) {

724 if(
Œue
 !=ğ
$£·
 && 1==
$İtiÚs
['lim™']è 
	`»£t
(
$»suÉ
[0]);

725 
	`fÜ—ch
 (
$»suÉ
 
as
 
$v®
){

726 
$¬¿y
[] = 
$v®
[
$f›ld
];

728  
$¬¿y
;

731  
nuÎ
;

732 
	}
}

741 
public
 
funùiÚ
 
ü—‹
(
$d©a
='',
$ty³
='') {

743 if(
em±y
(
$d©a
)) {

744 
$d©a
 = 
$_POST
;

745 }
–£if
(
is_objeù
(
$d©a
)){

746 
	g$d©a
 = 
g‘_objeù_v¬s
(
$d©a
);

749 if(
em±y
(
$d©a
è|| !
is_¬¿y
($data)) {

750 
	g$this
->
	g”rÜ
 = 
L
('_DATA_TYPE_INVALID_');

751  
	gçl£
;

755 
	g$d©a
 = 
$this
->
·r£F›ldsM­
(
$d©a
,0);

758 
	g$ty³
 = 
$ty³
?$ty³:(!
em±y
(
$d©a
[
$this
->
g‘Pk
()])?
£lf
::
MODEL_UPDATE
:£lf::
MODEL_INSERT
);

761 if(
is£t
(
$this
->
İtiÚs
['field'])) {

762 
	g$f›lds
 = 
$this
->
İtiÚs
['field'];

763 
un£t
(
$this
->
İtiÚs
['field']);

764 }
–£if
(
$ty³
 =ğ
£lf
::
MODEL_INSERT
 && 
is£t
(
$this
->
š£¹F›lds
)) {

765 
$f›lds
 = 
$this
->
š£¹F›lds
;

766 }
–£if
(
$ty³
 =ğ
£lf
::
MODEL_UPDATE
 && 
is£t
(
$this
->
upd©eF›lds
)) {

767 
$f›lds
 = 
$this
->
upd©eF›lds
;

769 if(
is£t
(
$f›lds
)) {

770 if(
is_¡ršg
(
$f›lds
)) {

771 
	g$f›lds
 = 
ex¶ode
(',',
$f›lds
);

774 if(
C
('TOKEN_ON')è
	g$f›lds
[] = C('TOKEN_NAME');

775 
fÜ—ch
 (
$d©a
 
as
 
$key
=>
$v®
){

776 if(!
š_¬¿y
(
$key
,
$f›lds
)) {

777 
un£t
(
$d©a
[
$key
]);

783 if(!
	g$this
->
autoV®id©iÚ
(
$d©a
,
$ty³
)è 
	gçl£
;

786 if(
C
('TOKEN_ON'è&& !
	g$this
->
autoCheckTok’
(
$d©a
)) {

787 
	g$this
->
	g”rÜ
 = 
L
('_TOKEN_ERROR_');

788  
	gçl£
;

792 if(
	g$this
->
	gautoCheckF›lds
) {

793 
	g$f›lds
 = 
$this
->
g‘DbF›lds
();

794 
fÜ—ch
 (
$d©a
 
as
 
$key
=>
$v®
){

795 if(!
š_¬¿y
(
$key
,
$f›lds
)) {

796 
un£t
(
$d©a
[
$key
]);

797 }
–£if
(
MAGIC_QUOTES_GPC
 && 
is_¡ršg
(
$v®
)){

798 
	g$d©a
[
$key
] = 
¡r¦ashes
(
$v®
);

804 
	g$this
->
autoO³¿tiÚ
(
$d©a
,
$ty³
);

806 
	g$this
->
	gd©a
 = 
$d©a
;

808  
	g$d©a
;

813 
public
 
funùiÚ
 
	$autoCheckTok’
(
$d©a
) {

814 if(
	`C
('TOKEN_ON')){

815 
$Çme
 = 
	`C
('TOKEN_NAME');

816 if(!
	`is£t
(
$d©a
[
$Çme
]è|| !is£t(
$_SESSION
[$name])) {

817  
çl£
;

821 
	`li¡
(
$key
,
$v®ue
èğ
	`ex¶ode
('_',
$d©a
[
$Çme
]);

822 if(
$v®ue
 && 
$_SESSION
[
$Çme
][
$key
] === $value) {

823 
	`un£t
(
$_SESSION
[
$Çme
][
$key
]);

824  
Œue
;

827 if(
	`C
('TOKEN_RESET')è
	`un£t
(
$_SESSION
[
$Çme
][
$key
]);

828  
çl£
;

830  
Œue
;

831 
	}
}

840 
public
 
funùiÚ
 
	$»gex
(
$v®ue
,
$ruË
) {

841 
$v®id©e
 = 
	`¬¿y
(

853 if(
	`is£t
(
$v®id©e
[
	`¡¹Şow”
(
$ruË
)]))

854 
$ruË
 = 
$v®id©e
[
	`¡¹Şow”
($rule)];

855  
	`´eg_m©ch
(
$ruË
,
$v®ue
)===1;

856 
	}
}

865 
´iv©e
 
funùiÚ
 
	$autoO³¿tiÚ
(&
$d©a
,
$ty³
) {

866 if(!
	`em±y
(
$this
->
İtiÚs
['auto'])) {

867 
$_auto
 = 
$this
->
İtiÚs
['auto'];

868 
	`un£t
(
$this
->
İtiÚs
['auto']);

869 }
	`–£if
(!
	`em±y
(
$this
->
_auto
)){

870 
$_auto
 = 
$this
->
_auto
;

873 if(
	`is£t
(
$_auto
)) {

874 
	`fÜ—ch
 (
$_auto
 
as
 
$auto
){

877 if(
	`em±y
(
$auto
[2])è$auto[2] = 
£lf
::
MODEL_INSERT
;

878 ifĞ
$ty³
 =ğ
$auto
[2] || $auto[2] =ğ
£lf
::
MODEL_BOTH
) {

879 
	`Œim
(
$auto
[3])) {

882 
$¬gs
 = 
	`is£t
(
$auto
[4])?(
¬¿y
)$auto[4]:
	`¬¿y
();

883 if(
	`is£t
(
$d©a
[
$auto
[0]])) {

884 
	`¬¿y_unshiá
(
$¬gs
,
$d©a
[
$auto
[0]]);

886 if('funùiÚ'==
$auto
[3]) {

887 
$d©a
[
$auto
[0]] = 
	`ÿÎ_u£r_func_¬¿y
($auto[1], 
$¬gs
);

889 
$d©a
[
$auto
[0]] = 
	`ÿÎ_u£r_func_¬¿y
(
	`¬¿y
(&
$this
,$auto[1]), 
$¬gs
);

893 
$d©a
[
$auto
[0]] = $data[$auto[1]];

896 if(''===
$d©a
[
$auto
[0]])

897 
	`un£t
(
$d©a
[
$auto
[0]]);

901 
$d©a
[
$auto
[0]] = $auto[1];

903 if(
çl£
 ==ğ
$d©a
[
$auto
[0]] ) 
	`un£t
($data[$auto[0]]);

907  
$d©a
;

908 
	}
}

917 
´Ùeùed
 
funùiÚ
 
	$autoV®id©iÚ
(
$d©a
,
$ty³
) {

918 if(!
	`em±y
(
$this
->
İtiÚs
['validate'])) {

919 
$_v®id©e
 = 
$this
->
İtiÚs
['validate'];

920 
	`un£t
(
$this
->
İtiÚs
['validate']);

921 }
	`–£if
(!
	`em±y
(
$this
->
_v®id©e
)){

922 
$_v®id©e
 = 
$this
->
_v®id©e
;

925 if(
	`is£t
(
$_v®id©e
)) {

926 if(
$this
->
·tchV®id©e
) {

927 
$this
->
”rÜ
 = 
	`¬¿y
();

929 
	`fÜ—ch
(
$_v®id©e
 
as
 
$key
=>
$v®
) {

933 if(
	`em±y
(
$v®
[5]è|| $v®[5]=ğ
£lf
::
MODEL_BOTH
 || $v®[5]=ğ
$ty³
 ) {

934 if(0==
	`¡½os
(
$v®
[2],'{%') && strpos($val[2],'}'))

936 
$v®
[2] = 
	`L
(
	`sub¡r
($val[2],2,-1));

937 
$v®
[3] = 
	`is£t
($v®[3])?$v®[3]:
£lf
::
EXISTS_VALIDATE
;

938 
$v®
[4] = 
	`is£t
($val[4])?$val[4]:'regex';

940 
$v®
[3]) {

941 
£lf
::
MUST_VALIDATE
:

942 if(
çl£
 ==ğ
$this
->
	`_v®id©iÚF›ld
(
$d©a
,
$v®
))

943  
çl£
;

945 
£lf
::
VALUE_VALIDATE
:

946 if('' !ğ
	`Œim
(
$d©a
[
$v®
[0]]))

947 if(
çl£
 ==ğ
$this
->
	`_v®id©iÚF›ld
(
$d©a
,
$v®
))

948  
çl£
;

951 if(
	`is£t
(
$d©a
[
$v®
[0]]))

952 if(
çl£
 ==ğ
$this
->
	`_v®id©iÚF›ld
(
$d©a
,
$v®
))

953  
çl£
;

958 if(!
	`em±y
(
$this
->
”rÜ
)è 
çl£
;

960  
Œue
;

961 
	}
}

971 
´Ùeùed
 
funùiÚ
 
	$_v®id©iÚF›ld
(
$d©a
,
$v®
) {

972 if(
çl£
 ==ğ
$this
->
	`_v®id©iÚF›ldI‹m
(
$d©a
,
$v®
)){

973 if(
$this
->
·tchV®id©e
) {

974 
$this
->
”rÜ
[
$v®
[0]] = $val[2];

976 
$this
->
”rÜ
 = 
$v®
[2];

977  
çl£
;

981 
	}
}

990 
´Ùeùed
 
funùiÚ
 
	$_v®id©iÚF›ldI‹m
(
$d©a
,
$v®
) {

991 
	`¡¹Şow”
(
	`Œim
(
$v®
[4]))) {

994 
$¬gs
 = 
	`is£t
(
$v®
[6])?(
¬¿y
)$v®[6]:
	`¬¿y
();

995 if(
	`is_¡ršg
(
$v®
[0]è&& 
	`¡½os
($val[0], ','))

996 
$v®
[0] = 
	`ex¶ode
(',', $val[0]);

997 if(
	`is_¬¿y
(
$v®
[0])){

999 
	`fÜ—ch
(
$v®
[0] 
as
 
$f›ld
)

1000 
$_d©a
[
$f›ld
] = 
$d©a
[$field];

1001 
	`¬¿y_unshiá
(
$¬gs
, 
$_d©a
);

1003 
	`¬¿y_unshiá
(
$¬gs
, 
$d©a
[
$v®
[0]]);

1005 if('funùiÚ'==
$v®
[4]) {

1006  
	`ÿÎ_u£r_func_¬¿y
(
$v®
[1], 
$¬gs
);

1008  
	`ÿÎ_u£r_func_¬¿y
(
	`¬¿y
(&
$this
, 
$v®
[1]), 
$¬gs
);

1011  
$d©a
[
$v®
[0]] == $data[$val[1]];

1013 if(
	`is_¡ršg
(
$v®
[0]è&& 
	`¡½os
($val[0],','))

1014 
$v®
[0] = 
	`ex¶ode
(',',$val[0]);

1015 
$m­
 = 
	`¬¿y
();

1016 if(
	`is_¬¿y
(
$v®
[0])) {

1018 
	`fÜ—ch
 (
$v®
[0] 
as
 
$f›ld
)

1019 
$m­
[
$f›ld
] = 
$d©a
[$field];

1021 
$m­
[
$v®
[0]] = 
$d©a
[$val[0]];

1023 if(!
	`em±y
(
$d©a
[
$this
->
	`g‘Pk
()])) {

1024 
$m­
[
$this
->
	`g‘Pk
()] = 
	`¬¿y
('Ãq',
$d©a
[$this->getPk()]);

1026 if(
$this
->
	`wh”e
(
$m­
)->
	`fšd
()è 
çl£
;

1027  
Œue
;

1029  
$this
->
	`check
(
$d©a
[
$v®
[0]],$val[1],$val[4]);

1031 
	}
}

1041 
public
 
funùiÚ
 
check
(
$v®ue
,
$ruË
,
$ty³
='regex'){

1042 
$ty³
 = 
¡¹Şow”
(
Œim
($type));

1043 
	g$ty³
) {

1046 
$¿nge
 = 
is_¬¿y
(
$ruË
)? $ruË : 
ex¶ode
(',',$rule);

1047  
	g$ty³
 =ğ'š' ? 
š_¬¿y
(
$v®ue
 ,
$¿nge
) : !in_array($value ,$range);

1050 ià(
is_¬¿y
(
$ruË
)){

1051 
$mš
 = 
$ruË
[0];

1052 
	g$max
 = 
$ruË
[1];

1054 
li¡
(
$mš
,
$max
èğ
ex¶ode
(',',
$ruË
);

1056  
	g$ty³
 =ğ'b‘w“n' ? 
$v®ue
>=
$mš
 && $v®ue<=
$max
 : $value<$min || $value>$max;

1059  
$ty³
 =ğ'equ®' ? 
$v®ue
 =ğ
$ruË
 : $value != $rule;

1061 
$Ëngth
 = 
mb_¡¾’
(
$v®ue
,'utf-8');

1062 if(
¡½os
(
$ruË
,',')) {

1063 
li¡
(
$mš
,
$max
èğ
ex¶ode
(',',
$ruË
);

1064  
	g$Ëngth
 >ğ
$mš
 && 
$Ëngth
 <ğ
$max
;

1066  
	g$Ëngth
 =ğ
$ruË
;

1069 
li¡
(
$¡¬t
,
$’d
èğ
ex¶ode
(',',
$ruË
);

1070 if(!
is_num”ic
(
$¡¬t
)è
	g$¡¬t
 = 
¡¹Ùime
($start);

1071 if(!
is_num”ic
(
$’d
)è
	g$’d
 = 
¡¹Ùime
($end);

1072  
	gNOW_TIME
 >ğ
$¡¬t
 && 
NOW_TIME
 <ğ
$’d
;

1074  
š_¬¿y
(
g‘_ş›Á_
(),
ex¶ode
(',',
$ruË
));

1076  !
š_¬¿y
(
g‘_ş›Á_
(),
ex¶ode
(',',
$ruË
));

1080  
$this
->
»gex
(
$v®ue
,
$ruË
);

1091 
public
 
funùiÚ
 
	$qu”y
(
$sql
,
$·r£
=
çl£
) {

1092 if(!
	`is_boŞ
(
$·r£
è&& !
	`is_¬¿y
($parse)) {

1093 
$·r£
 = 
	`func_g‘_¬gs
();

1094 
	`¬¿y_shiá
(
$·r£
);

1096 
$sql
 = 
$this
->
	`·r£Sql
($sql,
$·r£
);

1097  
$this
->
db
->
	`qu”y
(
$sql
);

1098 
	}
}

1107 
public
 
funùiÚ
 
	$execu‹
(
$sql
,
$·r£
=
çl£
) {

1108 if(!
	`is_boŞ
(
$·r£
è&& !
	`is_¬¿y
($parse)) {

1109 
$·r£
 = 
	`func_g‘_¬gs
();

1110 
	`¬¿y_shiá
(
$·r£
);

1112 
$sql
 = 
$this
->
	`·r£Sql
($sql,
$·r£
);

1113  
$this
->
db
->
	`execu‹
(
$sql
);

1114 
	}
}

1123 
´Ùeùed
 
funùiÚ
 
	$·r£Sql
(
$sql
,
$·r£
) {

1125 if(
Œue
 ==ğ
$·r£
) {

1126 
$İtiÚs
 = 
$this
->
	`_·r£O±iÚs
();

1127 
$sql
 = 
$this
->
db
->
	`·r£Sql
($sql,
$İtiÚs
);

1128 }
	`–£if
(
	`is_¬¿y
(
$·r£
)){

1129 
$sql
 = 
	`v¥rštf
($sql,
$·r£
);

1131 
$sql
 = 
	`¡¹r
($sql,
	`¬¿y
('__TABLE__'=>
$this
->
	`g‘TabËName
(),'__PREFIX__'=>
	`C
('DB_PREFIX')));

1133 
$this
->
db
->
	`£tMod–
($this->
Çme
);

1134  
$sql
;

1135 
	}
}

1145 
public
 
funùiÚ
 
db
(
$lškNum
='',
$cÚfig
='',
$·¿ms
=
	$¬¿y
()){

1146 if(''===
$lškNum
 && 
$this
->
db
) {

1147  
$this
->
db
;

1149 
$_lškNum
 = 
	`¬¿y
();

1150 
$_db
 = 
	`¬¿y
();

1151 if(!
	`is£t
(
$_db
[
$lškNum
]è|| (is£t($_db[$lškNum]è&& 
$cÚfig
 && 
$_lškNum
[$linkNum]!=$config) ) {

1153 if(!
	`em±y
(
$cÚfig
è&& 
	`is_¡ršg
($cÚfigè&& 
çl£
 ==ğ
	`¡½os
($config,'/')) {

1154 
$cÚfig
 = 
	`C
($config);

1156 
$_db
[
$lškNum
] = 
Db
::
	`g‘In¡ªû
(
$cÚfig
);

1157 }
	`–£if
(
NULL
 ==ğ
$cÚfig
){

1158 
$_db
[
$lškNum
]->
	`şo£
();

1159 
	`un£t
(
$_db
[
$lškNum
]);

1162 if(!
	`em±y
(
$·¿ms
)) {

1163 if(
	`is_¡ršg
(
$·¿ms
)è
	`·r£_¡r
($params,$params);

1164 
	`fÜ—ch
 (
$·¿ms
 
as
 
$Çme
=>
$v®ue
){

1165 
$this
->
	`£tPrİ”ty
(
$Çme
,
$v®ue
);

1169 
$_lškNum
[
$lškNum
] = 
$cÚfig
;

1171 
$this
->
db
 = 
$_db
[
$lškNum
];

1172 
$this
->
	`_aá”_db
();

1174 if(!
	`em±y
(
$this
->
Çme
è&& $this->
autoCheckF›lds
è$this->
	`_checkTabËInfo
();

1175  
$this
;

1176 
	}
}

1178 
´Ùeùed
 
funùiÚ
 
	$_aá”_db
(è{
	}
}

1185 
public
 
funùiÚ
 
	$g‘Mod–Name
() {

1186 if(
	`em±y
(
$this
->
Çme
))

1187 
$this
->
Çme
 = 
	`sub¡r
(
	`g‘_şass
($this),0,-5);

1188  
$this
->
Çme
;

1189 
	}
}

1196 
public
 
funùiÚ
 
	$g‘TabËName
() {

1197 if(
	`em±y
(
$this
->
ŒueTabËName
)) {

1198 
$bËName
 = !
	`em±y
(
$this
->
bËP»fix
) ? $this->tablePrefix : '';

1199 if(!
	`em±y
(
$this
->
bËName
)) {

1200 
$bËName
 .ğ
$this
->
bËName
;

1202 
$bËName
 .ğ
	`·r£_Çme
(
$this
->
Çme
);

1204 
$this
->
ŒueTabËName
 = 
	`¡¹Şow”
(
$bËName
);

1206  (!
	`em±y
(
$this
->
dbName
)?$this->dbName.'.':'').$this->
ŒueTabËName
;

1207 
	}
}

1214 
public
 
funùiÚ
 
	$¡¬tT¿ns
() {

1215 
$this
->
	`comm™
();

1216 
$this
->
db
->
	`¡¬tT¿ns
();

1218 
	}
}

1225 
public
 
funùiÚ
 
	$comm™
() {

1226  
$this
->
db
->
	`comm™
();

1227 
	}
}

1234 
public
 
funùiÚ
 
	$rŞlback
() {

1235  
$this
->
db
->
	`rŞlback
();

1236 
	}
}

1243 
public
 
funùiÚ
 
	$g‘E¼Ü
(){

1244  
$this
->
”rÜ
;

1245 
	}
}

1252 
public
 
funùiÚ
 
	$g‘DbE¼Ü
() {

1253  
$this
->
db
->
	`g‘E¼Ü
();

1254 
	}
}

1261 
public
 
funùiÚ
 
	$g‘La¡InsID
() {

1262  
$this
->
db
->
	`g‘La¡InsID
();

1263 
	}
}

1270 
public
 
funùiÚ
 
	$g‘La¡Sql
() {

1271  
$this
->
db
->
	`g‘La¡Sql
($this->
Çme
);

1272 
	}
}

1274 
public
 
funùiÚ
 
	$_sql
(){

1275  
$this
->
	`g‘La¡Sql
();

1276 
	}
}

1283 
public
 
funùiÚ
 
	$g‘Pk
() {

1284  
	`is£t
(
$this
->
f›lds
['_pk'])?$this->f›lds['_pk']:$this->
pk
;

1285 
	}
}

1292 
public
 
funùiÚ
 
	$g‘DbF›lds
(){

1293 if(
	`is£t
(
$this
->
İtiÚs
['table'])) {

1294 
$f›lds
 = 
$this
->
db
->
	`g‘F›lds
($this->
İtiÚs
['table']);

1295  
$f›lds
?
	`¬¿y_keys
($f›lds):
çl£
;

1297 if(
$this
->
f›lds
) {

1298 
$f›lds
 = 
$this
->
f›lds
;

1299 
	`un£t
(
$f›lds
['_autoinc'],$fields['_pk'],$fields['_type'],$fields['_version']);

1300  
$f›lds
;

1302  
çl£
;

1303 
	}
}

1311 
public
 
funùiÚ
 
d©a
(
$d©a
=''){

1312 if('' ==ğ
$d©a
 && !
em±y
(
$this
->
d©a
)) {

1313  
$this
->
d©a
;

1315 if(
is_objeù
(
$d©a
)){

1316 
	g$d©a
 = 
g‘_objeù_v¬s
(
$d©a
);

1317 }
–£if
(
is_¡ršg
(
$d©a
)){

1318 
·r£_¡r
(
$d©a
,$data);

1319 }
–£if
(!
is_¬¿y
(
$d©a
)){

1320 
throw_exû±iÚ
(
L
('_DATA_TYPE_INVALID_'));

1322 
	g$this
->
	gd©a
 = 
$d©a
;

1323  
	g$this
;

1332 
public
 
funùiÚ
 
	$još
(
$još
) {

1333 if(
	`is_¬¿y
(
$još
)) {

1334 
$this
->
İtiÚs
['još'] = 
$još
;

1335 }
	`–£if
(!
	`em±y
(
$još
)) {

1336 
$this
->
İtiÚs
['još'][] = 
$još
;

1338  
$this
;

1339 
	}
}

1348 
public
 
funùiÚ
 (
	g$uniÚ
,
	g$®l
=
çl£
) {

1349 if(
em±y
(
$uniÚ
)è 
$this
;

1350 if(
	g$®l
) {

1351 
	g$this
->
	gİtiÚs
['uniÚ']['_®l'] = 
Œue
;

1353 if(
is_objeù
(
$uniÚ
)) {

1354 
	g$uniÚ
 = 
g‘_objeù_v¬s
(
$uniÚ
);

1357 if(
is_¡ršg
(
$uniÚ
) ) {

1358 
	g$İtiÚs
 = 
$uniÚ
;

1359 }
–£if
(
is_¬¿y
(
$uniÚ
)){

1360 if(
is£t
(
$uniÚ
[0])) {

1361 
	g$this
->
	gİtiÚs
['uniÚ'] = 
¬¿y_m”ge
(
$this
->
İtiÚs
['uniÚ'],
$uniÚ
);

1362  
	g$this
;

1364 
	g$İtiÚs
 = 
$uniÚ
;

1367 
throw_exû±iÚ
(
L
('_DATA_TYPE_INVALID_'));

1369 
	g$this
->
	gİtiÚs
['uniÚ'][] = 
$İtiÚs
;

1370  
	g$this
;

1381 
public
 
funùiÚ
 
ÿche
(
$key
=
Œue
,
$expœe
=
nuÎ
,
$ty³
=''){

1382 if(
çl£
 !=ğ
$key
)

1383 
$this
->
İtiÚs
['ÿche'] = 
¬¿y
('key'=>
$key
,'expœe'=>
$expœe
,'ty³'=>
$ty³
);

1384  
	g$this
;

1394 
public
 
funùiÚ
 
	$f›ld
(
$f›ld
,
$exû±
=
çl£
){

1395 if(
Œue
 ==ğ
$f›ld
) {

1396 
$f›lds
 = 
$this
->
	`g‘DbF›lds
();

1397 
$f›ld
 = 
$f›lds
?$fields:'*';

1398 }
	`–£if
(
$exû±
) {

1399 if(
	`is_¡ršg
(
$f›ld
)) {

1400 
$f›ld
 = 
	`ex¶ode
(',',$field);

1402 
$f›lds
 = 
$this
->
	`g‘DbF›lds
();

1403 
$f›ld
 = 
$f›lds
?
	`¬¿y_diff
($fields,$field):$field;

1405 
$this
->
İtiÚs
['f›ld'] = 
$f›ld
;

1406  
$this
;

1407 
	}
}

1416 
public
 
funùiÚ
 
scİe
(
$scİe
='',
$¬gs
=
NULL
){

1417 if('' ==ğ
$scİe
) {

1418 if(
is£t
(
$this
->
_scİe
['default'])) {

1420 
$İtiÚs
 = 
$this
->
_scİe
['default'];

1422  
	g$this
;

1424 }
–£if
(
is_¡ršg
(
$scİe
)){

1425 
	g$scİes
 = 
ex¶ode
(',',
$scİe
);

1426 
	g$İtiÚs
 = 
¬¿y
();

1427 
fÜ—ch
 (
$scİes
 
as
 
$Çme
){

1428 if(!
is£t
(
$this
->
_scİe
[
$Çme
])) ;

1429 
	g$İtiÚs
 = 
¬¿y_m”ge
(
$İtiÚs
,
$this
->
_scİe
[
$Çme
]);

1431 if(!
em±y
(
$¬gs
è&& 
is_¬¿y
($args)) {

1432 
	g$İtiÚs
 = 
¬¿y_m”ge
(
$İtiÚs
,
$¬gs
);

1434 }
–£if
(
is_¬¿y
(
$scİe
)){

1435 
	g$İtiÚs
 = 
$scİe
;

1438 if(
is_¬¿y
(
$İtiÚs
è&& !
em±y
($options)){

1439 
	g$this
->
	gİtiÚs
 = 
¬¿y_m”ge
(
$this
->
İtiÚs
,
¬¿y_chªge_key_ÿ£
(
$İtiÚs
));

1441  
	g$this
;

1451 
public
 
funùiÚ
 
	$wh”e
(
$wh”e
,
$·r£
=
nuÎ
){

1452 if(!
	`is_nuÎ
(
$·r£
è&& 
	`is_¡ršg
(
$wh”e
)) {

1453 if(!
	`is_¬¿y
(
$·r£
)) {

1454 
$·r£
 = 
	`func_g‘_¬gs
();

1455 
	`¬¿y_shiá
(
$·r£
);

1457 
$·r£
 = 
	`¬¿y_m­
(
	`¬¿y
(
$this
->
db
,'escapeString'),$parse);

1458 
$wh”e
 = 
	`v¥rštf
($wh”e,
$·r£
);

1459 }
	`–£if
(
	`is_objeù
(
$wh”e
)){

1460 
$wh”e
 = 
	`g‘_objeù_v¬s
($where);

1462 if(
	`is_¡ršg
(
$wh”e
) && '' != $where){

1463 
$m­
 = 
	`¬¿y
();

1464 
$m­
['_¡ršg'] = 
$wh”e
;

1465 
$wh”e
 = 
$m­
;

1467 if(
	`is£t
(
$this
->
İtiÚs
['where'])){

1468 
$this
->
İtiÚs
['wh”e'] = 
	`¬¿y_m”ge
($this->İtiÚs['wh”e'],
$wh”e
);

1470 
$this
->
İtiÚs
['wh”e'] = 
$wh”e
;

1473  
$this
;

1474 
	}
}

1483 
public
 
funùiÚ
 
	$lim™
(
$off£t
,
$Ëngth
=
nuÎ
){

1484 
$this
->
İtiÚs
['lim™'] = 
	`is_nuÎ
(
$Ëngth
)?
$off£t
:$offset.','.$length;

1485  
$this
;

1486 
	}
}

1495 
public
 
funùiÚ
 
	$·ge
(
$·ge
,
$li¡Rows
=
nuÎ
){

1496 
$this
->
İtiÚs
['·ge'] = 
	`is_nuÎ
(
$li¡Rows
)?
$·ge
:$page.','.$listRows;

1497  
$this
;

1498 
	}
}

1506 
public
 
funùiÚ
 
	$comm’t
(
$comm’t
){

1507 
$this
->
İtiÚs
['comm’t'] = 
$comm’t
;

1508  
$this
;

1509 
	}
}

1518 
public
 
funùiÚ
 
	$£tPrİ”ty
(
$Çme
,
$v®ue
) {

1519 if(
	`´İ”ty_exi¡s
(
$this
,
$Çme
))

1520 
$this
->
$Çme
 = 
$v®ue
;

1521  
$this
;

1522 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\Think.class.php

1 <?
php


19 şas 
	cThšk
 {

21 
´iv©e
 
	m$_š¡ªû
 = 
¬¿y
();

28 
public
 
funùiÚ
 
	$¡¬t
() {

30 
	`»gi¡”_shutdown_funùiÚ
(
	`¬¿y
('Think','fatalError'));

31 
	`£t_”rÜ_hªdËr
(
	`¬¿y
('Think','appError'));

32 
	`£t_exû±iÚ_hªdËr
(
	`¬¿y
('Think','appException'));

34 
	`¥l_autŞßd_»gi¡”
(
	`¬¿y
('Think', 'autoload'));

36 
Thšk
::
	`budAµ
();

39 
Aµ
::
	`run
();

49 
´iv©e
 
funùiÚ
 
	$budAµ
() {

52 if(
	`defšed
('MODE_NAME')) {

53 
$mode
 = 
šşude
 
MODE_PATH
.
	`¡¹Şow”
(
MODE_NAME
).'.php';

55 
$mode
 = 
	`¬¿y
();

58 
	`C
(
šşude
 
THINK_PATH
.'Conf/convention.php');

59 if(
	`is£t
(
$mode
['config'])) {

60 
	`C
Ğ
	`is_¬¿y
(
$mode
['cÚfig'])?$mode['cÚfig']:
šşude
 $mode['config'] );

64 if(
	`is_fe
(
CONF_PATH
.'config.php'))

65 
	`C
(
šşude
 
CONF_PATH
.'config.php');

68 
	`L
(
šşude
 
THINK_PATH
.'Lªg/'.
	`¡¹Şow”
(
	`C
('DEFAULT_LANG')).'.php');

71 if(
	`C
('APP_TAGS_ON')) {

72 if(
	`is£t
(
$mode
['extends'])) {

73 
	`C
('ex‹nds',
	`is_¬¿y
(
$mode
['ex‹nds'])?$mode['ex‹nds']:
šşude
 $mode['extends']);

75 
	`C
('ex‹nds', 
šşude
 
THINK_PATH
.'Conf/tags.php');

80 if(
	`is£t
(
$mode
['tags'])) {

81 
	`C
('gs', 
	`is_¬¿y
(
$mode
['gs'])?$mode['gs']:
šşude
 $mode['tags']);

82 }
	`–£if
(
	`is_fe
(
CONF_PATH
.'tags.php')){

84 
	`C
('gs', 
šşude
 
CONF_PATH
.'tags.php');

87 
$compe
 = '';

89 if(
	`is£t
(
$mode
['core'])) {

90 
$li¡
 = 
$mode
['core'];

92 
$li¡
 = 
	`¬¿y
(

93 
THINK_PATH
.'Common/functions.php',

94 
CORE_PATH
.'Core/Log.class.php',

95 
CORE_PATH
.'Core/Dispatcher.class.php',

96 
CORE_PATH
.'Core/App.class.php',

97 
CORE_PATH
.'Core/Action.class.php',

98 
CORE_PATH
.'Core/View.class.php',

102 if(
	`is_fe
(
CONF_PATH
.'core.php')) {

103 
$li¡
 = 
	`¬¿y_m”ge
($li¡,
šşude
 
CONF_PATH
.'core.php');

105 
	`fÜ—ch
 (
$li¡
 
as
 
$fe
){

106 if(
	`is_fe
(
$fe
)) {

107 
	`»quœe_ÿche
(
$fe
);

108 if(!
APP_DEBUG
è
$compe
 .ğ
	`compe
(
$fe
);

113 if(
	`is_fe
(
COMMON_PATH
.'common.php')) {

114 
šşude
 
COMMON_PATH
.'common.php';

116 if(!
APP_DEBUG
è
$compe
 .ğ
	`compe
(
COMMON_PATH
.'common.php');

120 if(
	`is£t
(
$mode
['alias'])) {

121 
$®Ÿs
 = 
	`is_¬¿y
(
$mode
['®Ÿs'])?$mode['®Ÿs']:
šşude
 $mode['alias'];

122 
	`®Ÿs_impÜt
(
$®Ÿs
);

123 if(!
APP_DEBUG
è
$compe
 .ğ'®Ÿs_impÜt('.
	`v¬_expÜt
(
$®Ÿs
,
Œue
).');';

127 if(
	`is_fe
(
CONF_PATH
.'alias.php')){

128 
$®Ÿs
 = 
šşude
 
CONF_PATH
.'alias.php';

129 
	`®Ÿs_impÜt
(
$®Ÿs
);

130 if(!
APP_DEBUG
è
$compe
 .ğ'®Ÿs_impÜt('.
	`v¬_expÜt
(
$®Ÿs
,
Œue
).');';

133 if(
APP_DEBUG
) {

135 
	`C
(
šşude
 
THINK_PATH
.'Conf/debug.php');

137 
$¡©us
 = 
	`C
('APP_STATUS');

139 if(
	`is_fe
(
CONF_PATH
.
$¡©us
.'.php'))

141 
	`C
(
šşude
 
CONF_PATH
.
$¡©us
.'.php');

144 
	`bud_ruÁime_ÿche
(
$compe
);

147 
	}
}

156 
public
 
funùiÚ
 
	$autŞßd
(
$şass
) {

158 if(
	`®Ÿs_impÜt
(
$şass
))  ;

159 
$libP©h
 = 
	`defšed
('BASE_LIB_PATH')?
BASE_LIB_PATH
:
LIB_PATH
;

160 
$group
 = 
	`defšed
('GROUP_NAME'è&& 
	`C
('APP_GROUP_MODE')==0 ?
GROUP_NAME
.'/':'';

161 
$fe
 = 
$şass
.'.class.php';

162 if(
	`sub¡r
(
$şass
,-8)=='Behavior') {

163 if(
	`»quœe_¬¿y
(
	`¬¿y
(

164 
CORE_PATH
.'BehaviÜ/'.
$fe
,

165 
EXTEND_PATH
.'BehaviÜ/'.
$fe
,

166 
LIB_PATH
.'BehaviÜ/'.
$fe
,

167 
$libP©h
.'BehaviÜ/'.
$fe
),
Œue
)

168 || (
	`defšed
('MODE_NAME'è&& 
	`»quœe_ÿche
(
MODE_PATH
.
	`ucwÜds
(
MODE_NAME
).'/BehaviÜ/'.
$fe
))) {

171 }
	`–£if
(
	`sub¡r
(
$şass
,-5)=='Model'){

172 if(
	`»quœe_¬¿y
(
	`¬¿y
(

173 
LIB_PATH
.'Mod–/'.
$group
.
$fe
,

174 
$libP©h
.'Mod–/'.
$fe
,

175 
EXTEND_PATH
.'Mod–/'.
$fe
),
Œue
)) {

178 }
	`–£if
(
	`sub¡r
(
$şass
,-6)=='Action'){

179 if(
	`»quœe_¬¿y
(
	`¬¿y
(

180 
LIB_PATH
.'AùiÚ/'.
$group
.
$fe
,

181 
$libP©h
.'AùiÚ/'.
$fe
,

182 
EXTEND_PATH
.'AùiÚ/'.
$fe
),
Œue
)) {

185 }
	`–£if
(
	`sub¡r
(
$şass
,0,5)=='Cache'){

186 if(
	`»quœe_¬¿y
(
	`¬¿y
(

187 
EXTEND_PATH
.'Driv”/Cache/'.
$fe
,

188 
CORE_PATH
.'Driv”/Cache/'.
$fe
),
Œue
)){

191 }
	`–£if
(
	`sub¡r
(
$şass
,0,2)=='Db'){

192 if(
	`»quœe_¬¿y
(
	`¬¿y
(

193 
EXTEND_PATH
.'Driv”/Db/'.
$fe
,

194 
CORE_PATH
.'Driv”/Db/'.
$fe
),
Œue
)){

197 }
	`–£if
(
	`sub¡r
(
$şass
,0,8)=='Template'){

198 if(
	`»quœe_¬¿y
(
	`¬¿y
(

199 
EXTEND_PATH
.'Driv”/Tem¶©e/'.
$fe
,

200 
CORE_PATH
.'Driv”/Tem¶©e/'.
$fe
),
Œue
)){

203 }
	`–£if
(
	`sub¡r
(
$şass
,0,6)=='TagLib'){

204 if(
	`»quœe_¬¿y
(
	`¬¿y
(

205 
EXTEND_PATH
.'Driv”/TagLib/'.
$fe
,

206 
CORE_PATH
.'Driv”/TagLib/'.
$fe
),
Œue
)) {

212 
$·ths
 = 
	`ex¶ode
(',',
	`C
('APP_AUTOLOAD_PATH'));

213 
	`fÜ—ch
 (
$·ths
 
as
 
$·th
){

214 if(
	`impÜt
(
$·th
.'.'.
$şass
))

218 
	}
}

226 
public
 
funùiÚ
 
š¡ªû
(
$şass
,
$m‘hod
='') {

227 
$id’tify
 = 
$şass
.
$m‘hod
;

228 if(!
is£t
(
£lf
::
$_š¡ªû
[
$id’tify
])) {

229 if(
şass_exi¡s
(
$şass
)){

230 
$o
 = 
Ãw
 
$şass
();

231 if(!
em±y
(
$m‘hod
è&& 
m‘hod_exi¡s
(
$o
,$method))

232 
	g£lf
::
$_š¡ªû
[
$id’tify
] = 
ÿÎ_u£r_func_¬¿y
(
¬¿y
(&
$o
, 
$m‘hod
));

234 
	g£lf
::
$_š¡ªû
[
$id’tify
] = 
$o
;

237 
h®t
(
L
('_CLASS_NOT_EXIST_').':'.
$şass
);

239  
	g£lf
::
$_š¡ªû
[
$id’tify
];

247 
public
 
funùiÚ
 
	$­pExû±iÚ
(
$e
) {

248 
	`h®t
(
$e
->
	`__toSŒšg
());

249 
	}
}

260 
public
 
funùiÚ
 
	$­pE¼Ü
(
$”ºo
, 
$”r¡r
, 
$”rfe
, 
$”¾še
) {

261 
$”ºo
) {

262 
E_ERROR
:

263 
E_PARSE
:

264 
E_CORE_ERROR
:

265 
E_COMPILE_ERROR
:

266 
E_USER_ERROR
:

267 
	`ob_’d_ş—n
();

269 if(
	`C
('OUTPUT_ENCODE')){

270 
$zlib
 = 
	`ši_g‘
('zlib.output_compression');

271 if(
	`em±y
(
$zlib
)è
	`ob_¡¬t
('ob_gzhandler');

273 
$”rÜSŒ
 = "$”r¡¸".
$”rfe
." ç¬¬ $errline è¡Œ.";

274 if(
	`C
('LOG_RECORD')è
Log
::
	`wr™e
("[$”ºo] ".
$”rÜSŒ
,Log::
ERR
);

275 
	`funùiÚ_exi¡s
('h®t')?
	`h®t
(
$”rÜSŒ
):
	`ex™
('ERROR:'.$errorStr);

277 
E_STRICT
:

278 
E_USER_WARNING
:

279 
E_USER_NOTICE
:

281 
$”rÜSŒ
 = "[$”ºo] $”r¡¸".
$”rfe
." ç¬¬ $errline è¡Œ.";

282 
	`Œaû
(
$”rÜSŒ
,'','NOTIC');

285 
	}
}

288 
public
 
funùiÚ
 
	$çlE¼Ü
() {

289 ià(
$e
 = 
	`”rÜ_g‘_Ï¡
()) {

290 
Thšk
::
	`­pE¼Ü
(
$e
['type'],$e['message'],$e['file'],$e['line']);

292 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\ThinkException.class.php

1 <?
php


19 şas 
	cThškExû±iÚ
 
ex‹nds
 
	mExû±iÚ
 {

26 
´iv©e
 
	m$ty³
;

29 
´iv©e
 
	m$exŒa
;

36 
public
 
funùiÚ
 
	$__cÚ¡ruù
(
$mes§ge
,
$code
=0,
$exŒa
=
çl£
) {

37 
·»Á
::
	`__cÚ¡ruù
(
$mes§ge
,
$code
);

38 
$this
->
ty³
 = 
	`g‘_şass
($this);

39 
$this
->
exŒa
 = 
$exŒa
;

49 
public
 
funùiÚ
 
	$__toSŒšg
() {

50 
$Œaû
 = 
$this
->
	`g‘T¿û
();

51 if(
$this
->
exŒa
)

53 
	`¬¿y_shiá
(
$Œaû
);

54 
$this
->
şass
 = 
	`is£t
(
$Œaû
[0]['class'])?$trace[0]['class']:'';

55 
$this
->
funùiÚ
 = 
	`is£t
(
$Œaû
[0]['function'])?$trace[0]['function']:'';

56 
$this
->
fe
 = 
$Œaû
[0]['file'];

57 
$this
->
lše
 = 
$Œaû
[0]['line'];

58 
$fe
 = 
	`fe
(
$this
->
fe
);

59 
$ŒaûInfo
 = '';

60 
$time
 = 
	`d©e
('y-m-d H:i:m');

61 
	`fÜ—ch
(
$Œaû
 
as
 
$t
) {

62 
$ŒaûInfo
 .ğ'['.
$time
.'] '.
$t
['file'].' ('.$t['line'].') ';

63 
$ŒaûInfo
 .ğ
$t
['class'].$t['type'].$t['function'].'(';

64 
$ŒaûInfo
 .ğ
	`im¶ode
(', ', 
$t
['args']);

65 
$ŒaûInfo
 .=")\n";

67 
$”rÜ
['mes§ge'] = 
$this
->
mes§ge
;

68 
$”rÜ
['ty³'] = 
$this
->
ty³
;

69 
$”rÜ
['d‘a'] = 
	`L
('_MODULE_').'['.
MODULE_NAME
.'] '.L('_ACTION_').'['.
ACTION_NAME
.']'."\n";

70 
$”rÜ
['d‘a'] .ğ(
$this
->
lše
-2).': '.
$fe
[$this->line-3];

71 
$”rÜ
['d‘a'] .ğ(
$this
->
lše
-1).': '.
$fe
[$this->line-2];

72 
$”rÜ
['d‘a'] .ğ'<fÚˆcŞÜ="#FF6600" >'.(
$this
->
lše
).': <¡rÚg>'.
$fe
[$this->line-1].'</strong></font>';

73 
$”rÜ
['d‘a'] .ğ(
$this
->
lše
+1).': '.
$fe
[$this->line];

74 
$”rÜ
['d‘a'] .ğ(
$this
->
lše
+2).': '.
$fe
[$this->line+1];

75 
$”rÜ
['şass'] = 
$this
->
şass
;

76 
$”rÜ
['funùiÚ'] = 
$this
->
funùiÚ
;

77 
$”rÜ
['fe'] = 
$this
->
fe
;

78 
$”rÜ
['lše'] = 
$this
->
lše
;

79 
$”rÜ
['Œaû'] = 
$ŒaûInfo
;

82 if(
	`C
('LOG_EXCEPTION_RECORD')) {

83 
Log
::
	`Wr™e
('('.
$this
->
ty³
.'è'.$this->
mes§ge
);

85  
$”rÜ
 ;

86 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\View.class.php

1 <?
php


19 şas 
	cV›w
 {

25 
´Ùeùed
 
	m$tV¬
 = 
¬¿y
();

33 
public
 
funùiÚ
 
assign
(
$Çme
,
$v®ue
=''){

34 if(
is_¬¿y
(
$Çme
)) {

35 
$this
->
tV¬
 = 
¬¿y_m”ge
($this->tV¬,
$Çme
);

37 
	m$this
->
	mtV¬
[
$Çme
] = 
$v®ue
;

47 
public
 
funùiÚ
 
g‘
(
$Çme
=''){

48 if('' ==ğ
$Çme
) {

49  
$this
->
tV¬
;

51  
is£t
(
$this
->
tV¬
[
$Çme
])?
	g$this
->
	gtV¬
[$Çme]:
çl£
;

64 
public
 
funùiÚ
 
di¥Ïy
(
$‹m¶©eFe
='',
$ch¬£t
='',
$cÚ‹ÁTy³
='',
$cÚ‹Á
='',
$´efix
='') {

65 
G
('viewStartTime');

67 
g
('v›w_begš',
$‹m¶©eFe
);

69 
	g$cÚ‹Á
 = 
$this
->
ãtch
(
$‹m¶©eFe
,
$cÚ‹Á
,
$´efix
);

71 
	g$this
->
»nd”
(
$cÚ‹Á
,
$ch¬£t
,
$cÚ‹ÁTy³
);

73 
g
('view_end');

84 
´iv©e
 
funùiÚ
 
»nd”
(
$cÚ‹Á
,
$ch¬£t
='',
$cÚ‹ÁTy³
=''){

85 if(
em±y
(
$ch¬£t
)è$ch¬£ˆğ
C
('DEFAULT_CHARSET');

86 if(
em±y
(
$cÚ‹ÁTy³
)è
	g$cÚ‹ÁTy³
 = 
C
('TMPL_CONTENT_TYPE');

88 
h—d”
('CÚ‹Á-Ty³:'.
$cÚ‹ÁTy³
.'; ch¬£t='.
$ch¬£t
);

89 
h—d”
('Cache-cÚŒŞ: '.
C
('HTTP_CACHE_CONTROL'));

90 
h—d”
('X-Powered-By:ThinkPHP');

92 
echo
 
	g$cÚ‹Á
;

103 
public
 
funùiÚ
 
ãtch
(
$‹m¶©eFe
='',
$cÚ‹Á
='',
$´efix
='') {

104 if(
em±y
(
$cÚ‹Á
)) {

106 
g
('v›w_‹m¶©e',
$‹m¶©eFe
);

108 if(!
is_fe
(
$‹m¶©eFe
)è 
	gNULL
;

111 
ob_¡¬t
();

112 
ob_im¶ic™_æush
(0);

113 if('php' =ğ
¡¹Şow”
(
C
('TMPL_ENGINE_TYPE'))) {

115 
exŒaù
(
$this
->
tV¬
, 
EXTR_OVERWRITE
);

117 
em±y
(
$cÚ‹Á
)?
šşude
 
	g$‹m¶©eFe
:
ev®
('?>'.$content);

120 
	g$·¿ms
 = 
¬¿y
('v¬'=>
$this
->
tV¬
,'fe'=>
$‹m¶©eFe
,'cÚ‹Á'=>
$cÚ‹Á
,'´efix'=>
$´efix
);

121 
g
('v›w_·r£',
$·¿ms
);

124 
	g$cÚ‹Á
 = 
ob_g‘_ş—n
();

126 
g
('v›w_f‹r',
$cÚ‹Á
);

128  
	g$cÚ‹Á
;

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\Widget.class.php

1 <?
php


19 
ab¡¿ù
 cÏs 
	cWidg‘
 {

22 
´Ùeùed
 
	m$‹m¶©e
 = '';

31 
ab¡¿ù
 
public
 
funùiÚ
 
»nd”
(
$d©a
);

40 
´Ùeùed
 
funùiÚ
 
»nd”Fe
(
$‹m¶©eFe
='',
$v¬
='') {

41 
ob_¡¬t
();

42 
ob_im¶ic™_æush
(0);

43 if(!
fe_exi¡s_ÿ£
(
$‹m¶©eFe
)){

45 
	m$Çme
 = 
sub¡r
(
g‘_şass
(
$this
),0,-6);

46 
	m$f’ame
 = 
em±y
(
$‹m¶©eFe
)?
$Çme
:$templateFile;

47 
	m$‹m¶©eFe
 = 
BASE_LIB_PATH
.'Widg‘/'.
$Çme
.'/'.
$f’ame
.
C
('TMPL_TEMPLATE_SUFFIX');

48 if(!
fe_exi¡s_ÿ£
(
$‹m¶©eFe
))

49 
throw_exû±iÚ
(
L
('_TEMPLATE_NOT_EXIST_').'['.
$‹m¶©eFe
.']');

51 
	m$‹m¶©e
 = 
¡¹Şow”
(
$this
->
‹m¶©e
?$this->‹m¶©e:(
C
('TMPL_ENGINE_TYPE')?C('TMPL_ENGINE_TYPE'):'php'));

52 if('php' =ğ
$‹m¶©e
) {

54 if(!
em±y
(
$v¬
)è
exŒaù
($v¬, 
EXTR_OVERWRITE
);

56 
šşude
 
	m$‹m¶©eFe
;

57 }
–£if
('thšk'==
$‹m¶©e
){

58 if(
$this
->
checkCache
(
$‹m¶©eFe
)) {

60 
exŒaù
(
$v¬
, 
EXTR_OVERWRITE
);

62 
šşude
 
C
('CACHE_PATH').
md5
(
$‹m¶©eFe
).C('TMPL_CACHFILE_SUFFIX');

64 
	m$l
 = 
Thšk
::
š¡ªû
('ThinkTemplate');

66 
	m$l
->
ãtch
(
$‹m¶©eFe
,
$v¬
);

69 
	m$şass
 = 'Tem¶©e'.
ucwÜds
(
$‹m¶©e
);

70 if(
is_fe
(
CORE_PATH
.'Driv”/Tem¶©e/'.
$şass
.'.class.php')) {

72 
	m$·th
 = 
CORE_PATH
;

74 
	m$·th
 = 
EXTEND_PATH
;

76 
»quœe_ÿche
(
$·th
.'Driv”/Tem¶©e/'.
$şass
.'.class.php');

77 
	m$l
 = 
Ãw
 
$şass
;

78 
	m$l
->
ãtch
(
$‹m¶©eFe
,
$v¬
);

80 
	m$cÚ‹Á
 = 
ob_g‘_ş—n
();

81  
	m$cÚ‹Á
;

91 
´Ùeùed
 
funùiÚ
 
	$checkCache
(
$tm¶Tem¶©eFe
) {

92 ià(!
	`C
('TMPL_CACHE_ON'))

93  
çl£
;

94 
$tm¶CacheFe
 = 
	`C
('CACHE_PATH').
	`md5
(
$tm¶Tem¶©eFe
).C('TMPL_CACHFILE_SUFFIX');

95 if(!
	`is_fe
(
$tm¶CacheFe
)){

96  
çl£
;

97 }
	`–£if
 (
	`femtime
(
$tm¶Tem¶©eFe
è> femtime(
$tm¶CacheFe
)) {

99  
çl£
;

100 }
	`–£if
 (
	`C
('TMPL_CACHE_TIME'è!ğ0 && 
	`time
(è> 
	`femtime
(
$tm¶CacheFe
)+C('TMPL_CACHE_TIME')) {

102  
çl£
;

105  
Œue
;

106 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Driver\Cache\CacheFile.class.php

1 <?
php


12 
defšed
('THINK_PATH'è
Ü
 
ex™
();

20 şas 
	cCacheFe
 
ex‹nds
 
	mCache
 {

26 
public
 
funùiÚ
 
__cÚ¡ruù
(
$İtiÚs
=
	$¬¿y
()) {

27 if(!
	`em±y
(
$İtiÚs
)) {

28 
$this
->
İtiÚs
 = 
$İtiÚs
;

30 
$this
->
İtiÚs
['‹mp'] = !
	`em±y
(
$İtiÚs
['‹mp'])? $İtiÚs['‹mp'] : 
	`C
('DATA_CACHE_PATH');

31 
$this
->
İtiÚs
['´efix'] = 
	`is£t
(
$İtiÚs
['´efix'])? $İtiÚs['´efix'] : 
	`C
('DATA_CACHE_PREFIX');

32 
$this
->
İtiÚs
['expœe'] = 
	`is£t
(
$İtiÚs
['expœe'])? $İtiÚs['expœe'] : 
	`C
('DATA_CACHE_TIME');

33 
$this
->
İtiÚs
['Ëngth'] = 
	`is£t
(
$İtiÚs
['length'])? $options['length'] : 0;

34 if(
	`sub¡r
(
$this
->
İtiÚs
['temp'], -1) != '/') $this->options['temp'] .= '/';

35 
$this
->
	`š™
();

43 
´iv©e
 
funùiÚ
 
	$š™
() {

44 
$¡©
 = 
	`¡©
(
$this
->
İtiÚs
['temp']);

45 
$dœ_³rms
 = 
$¡©
['mode'] & 0007777;

46 
$fe_³rms
 = 
$dœ_³rms
 & 0000666;

49 ià(!
	`is_dœ
(
$this
->
İtiÚs
['temp'])) {

50 ià(! 
	`mkdœ
(
$this
->
İtiÚs
['temp']))

51  
çl£
;

52 
	`chmod
(
$this
->
İtiÚs
['‹mp'], 
$dœ_³rms
);

54 
	}
}

62 
´iv©e
 
funùiÚ
 
	$f’ame
(
$Çme
) {

63 
$Çme
 = 
	`md5
($name);

64 if(
	`C
('DATA_CACHE_SUBDIR')) {

66 
$dœ
 ='';

67 
$i
=0;$i<
	`C
('DATA_PATH_LEVEL');$i++) {

68 
$dœ
 .ğ
$Çme
{
$i
}.'/';

70 if(!
	`is_dœ
(
$this
->
İtiÚs
['‹mp'].
$dœ
)) {

71 
	`mkdœ
(
$this
->
İtiÚs
['‹mp'].
$dœ
,0755,
Œue
);

73 
$f’ame
 = 
$dœ
.
$this
->
İtiÚs
['´efix'].
$Çme
.'.php';

75 
$f’ame
 = 
$this
->
İtiÚs
['´efix'].
$Çme
.'.php';

77  
$this
->
İtiÚs
['‹mp'].
$f’ame
;

78 
	}
}

86 
public
 
funùiÚ
 
	$g‘
(
$Çme
) {

87 
$f’ame
 = 
$this
->
	`f’ame
(
$Çme
);

88 ià(!
	`is_fe
(
$f’ame
)) {

89  
çl£
;

91 
	`N
('cache_read',1);

92 
$cÚ‹Á
 = 
	`fe_g‘_cÚ‹Ás
(
$f’ame
);

93 ifĞ
çl£
 !=ğ
$cÚ‹Á
) {

94 
$expœe
 = ()
	`sub¡r
(
$cÚ‹Á
,8, 12);

95 if(
$expœe
 !ğ0 && 
	`time
(è> 
	`femtime
(
$f’ame
) + $expire) {

97 
	`uÆšk
(
$f’ame
);

98  
çl£
;

100 if(
	`C
('DATA_CACHE_CHECK')) {

101 
$check
 = 
	`sub¡r
(
$cÚ‹Á
,20, 32);

102 
$cÚ‹Á
 = 
	`sub¡r
($content,52, -3);

103 if(
$check
 !ğ
	`md5
(
$cÚ‹Á
)) {

104  
çl£
;

107 
$cÚ‹Á
 = 
	`sub¡r
($content,20, -3);

109 if(
	`C
('DATA_CACHE_COMPRESS'è&& 
	`funùiÚ_exi¡s
('gzcompress')) {

111 
$cÚ‹Á
 = 
	`gzuncom´ess
($content);

113 
$cÚ‹Á
 = 
	`un£rŸlize
($content);

114  
$cÚ‹Á
;

117  
çl£
;

119 
	}
}

129 
public
 
funùiÚ
 
	$£t
(
$Çme
,
$v®ue
,
$expœe
=
nuÎ
) {

130 
	`N
('cache_write',1);

131 if(
	`is_nuÎ
(
$expœe
)) {

132 
$expœe
 = 
$this
->
İtiÚs
['expire'];

134 
$f’ame
 = 
$this
->
	`f’ame
(
$Çme
);

135 
$d©a
 = 
	`£rŸlize
(
$v®ue
);

136 ifĞ
	`C
('DATA_CACHE_COMPRESS'è&& 
	`funùiÚ_exi¡s
('gzcompress')) {

138 
$d©a
 = 
	`gzcom´ess
($data,3);

140 if(
	`C
('DATA_CACHE_CHECK')) {

141 
$check
 = 
	`md5
(
$d©a
);

143 
$check
 = '';

145 
$d©a
 = "<?php\n//".
	`¥rštf
('%012d',
$expœe
).
$check
.$data."\n?>";

146 
$»suÉ
 = 
	`fe_put_cÚ‹Ás
(
$f’ame
,
$d©a
);

147 if(
$»suÉ
) {

148 if(
$this
->
İtiÚs
['length']>0) {

150 
$this
->
	`queue
(
$Çme
);

152 
	`ş—r¡©ÿche
();

153  
Œue
;

155  
çl£
;

157 
	}
}

165 
public
 
funùiÚ
 
	$rm
(
$Çme
) {

166  
	`uÆšk
(
$this
->
	`f’ame
(
$Çme
));

167 
	}
}

175 
public
 
funùiÚ
 
	$ş—r
() {

176 
$·th
 = 
$this
->
İtiÚs
['temp'];

177 iàĞ
$dœ
 = 
	`İ’dœ
Ğ
$·th
 ) ) {

178  
$fe
 = 
	`»addœ
Ğ
$dœ
 ) ) {

179 
$check
 = 
	`is_dœ
Ğ
$fe
 );

180 iàĞ!
$check
 )

181 
	`uÆšk
Ğ
$·th
 . 
$fe
 );

183 
	`şo£dœ
Ğ
$dœ
 );

184  
Œue
;

186 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Driver\Db\DbMysql.class.php

1 <?
php


12 
defšed
('THINK_PATH'è
Ü
 
ex™
();

21 şas 
	cDbMysql
 
ex‹nds
 
	mDb
{

28 
public
 
funùiÚ
 
__cÚ¡ruù
(
$cÚfig
=''){

29 iàĞ!
ex‹nsiÚ_lßded
('mysql') ) {

30 
throw_exû±iÚ
(
L
('_NOT_SUPPERT_').':mysql');

32 if(!
em±y
(
$cÚfig
)) {

33 
	m$this
->
	mcÚfig
 = 
$cÚfig
;

34 if(
em±y
(
$this
->
cÚfig
['params'])) {

35 
	m$this
->
	mcÚfig
['params'] = '';

45 
public
 
funùiÚ
 
cÚÃù
(
$cÚfig
='',
$lškNum
=0,
$fÜû
=
çl£
) {

46 iàĞ!
is£t
(
$this
->
lškID
[
$lškNum
]) ) {

47 if(
em±y
(
$cÚfig
)è$cÚfig = 
$this
->
cÚfig
;

49 
	g$ho¡
 = 
$cÚfig
['hostname'].($config['hostport']?":{$config['hostport']}":'');

51 
	g$pcÚÃù
 = !
em±y
(
$cÚfig
['·¿ms']['³rsi¡'])? $cÚfig['·¿ms']['³rsi¡']:
$this
->
pcÚÃù
;

52 if(
	g$pcÚÃù
) {

53 
	g$this
->
	glškID
[
$lškNum
] = 
mysql_pcÚÃù
Ğ
$ho¡
, 
$cÚfig
['username'], $config['password'],131072);

55 
	g$this
->
	glškID
[
$lškNum
] = 
mysql_cÚÃù
Ğ
$ho¡
, 
$cÚfig
['u£ºame'], $cÚfig['·sswÜd'],
Œue
,131072);

57 iàĞ!
	g$this
->
	glškID
[
$lškNum
] || (!
em±y
(
$cÚfig
['d©aba£']è&& !
mysql_£Ëù_db
($cÚfig['d©aba£'], 
$this
->
lškID
[$linkNum])) ) {

58 
throw_exû±iÚ
(
mysql_”rÜ
());

60 
	g$dbV”siÚ
 = 
mysql_g‘_£rv”_šfo
(
$this
->
lškID
[
$lškNum
]);

62 
mysql_qu”y
("SET NAMES '".
C
('DB_CHARSET')."'", 
$this
->
lškID
[
$lškNum
]);

64 if(
	g$dbV”siÚ
 >'5.0.1'){

65 
mysql_qu”y
("SET sql_mode=''",
$this
->
lškID
[
$lškNum
]);

68 
	g$this
->
	gcÚÃùed
 = 
Œue
;

70 if(1 !ğ
C
('DB_DEPLOY_TYPE')è
un£t
(
$this
->
cÚfig
);

72  
	g$this
->
	glškID
[
$lškNum
];

79 
public
 
funùiÚ
 
	$ä“
() {

80 
	`mysql_ä“_»suÉ
(
$this
->
qu”yID
);

81 
$this
->
qu”yID
 = 
nuÎ
;

82 
	}
}

90 
public
 
funùiÚ
 
	$qu”y
(
$¡r
) {

91 if(0===
	`¡ros
(
$¡r
, 'call')){

92 
$this
->
	`şo£
();

94 
$this
->
	`š™CÚÃù
(
çl£
);

95 iàĞ!
$this
->
_lškID
 )  
çl£
;

96 
$this
->
qu”ySŒ
 = 
$¡r
;

98 iàĞ
$this
->
qu”yID
 ) { $this->
	`ä“
(); }

99 
	`N
('db_query',1);

101 
	`G
('queryStartTime');

102 
$this
->
qu”yID
 = 
	`mysql_qu”y
(
$¡r
, $this->
_lškID
);

103 
$this
->
	`debug
();

104 iàĞ
çl£
 ==ğ
$this
->
qu”yID
 ) {

105 
$this
->
	`”rÜ
();

106  
çl£
;

108 
$this
->
numRows
 = 
	`mysql_num_rows
($this->
qu”yID
);

109  
$this
->
	`g‘AÎ
();

111 
	}
}

119 
public
 
funùiÚ
 
	$execu‹
(
$¡r
) {

120 
$this
->
	`š™CÚÃù
(
Œue
);

121 iàĞ!
$this
->
_lškID
 )  
çl£
;

122 
$this
->
qu”ySŒ
 = 
$¡r
;

124 iàĞ
$this
->
qu”yID
 ) { $this->
	`ä“
(); }

125 
	`N
('db_write',1);

127 
	`G
('queryStartTime');

128 
$»suÉ
 = 
	`mysql_qu”y
(
$¡r
, 
$this
->
_lškID
) ;

129 
$this
->
	`debug
();

130 iàĞ
çl£
 ==ğ
$»suÉ
) {

131 
$this
->
	`”rÜ
();

132  
çl£
;

134 
$this
->
numRows
 = 
	`mysql_afãùed_rows
($this->
_lškID
);

135 
$this
->
Ï¡InsID
 = 
	`mysql_š£¹_id
($this->
_lškID
);

136  
$this
->
numRows
;

138 
	}
}

145 
public
 
funùiÚ
 
	$¡¬tT¿ns
() {

146 
$this
->
	`š™CÚÃù
(
Œue
);

147 iàĞ!
$this
->
_lškID
 )  
çl£
;

149 ià(
$this
->
ŒªsTimes
 == 0) {

150 
	`mysql_qu”y
('START TRANSACTION', 
$this
->
_lškID
);

152 
$this
->
ŒªsTimes
++;

154 
	}
}

161 
public
 
funùiÚ
 
	$comm™
() {

162 ià(
$this
->
ŒªsTimes
 > 0) {

163 
$»suÉ
 = 
	`mysql_qu”y
('COMMIT', 
$this
->
_lškID
);

164 
$this
->
ŒªsTimes
 = 0;

165 if(!
$»suÉ
){

166 
$this
->
	`”rÜ
();

167  
çl£
;

170  
Œue
;

171 
	}
}

178 
public
 
funùiÚ
 
	$rŞlback
() {

179 ià(
$this
->
ŒªsTimes
 > 0) {

180 
$»suÉ
 = 
	`mysql_qu”y
('ROLLBACK', 
$this
->
_lškID
);

181 
$this
->
ŒªsTimes
 = 0;

182 if(!
$»suÉ
){

183 
$this
->
	`”rÜ
();

184  
çl£
;

187  
Œue
;

188 
	}
}

195 
´iv©e
 
funùiÚ
 
	$g‘AÎ
() {

197 
$»suÉ
 = 
	`¬¿y
();

198 if(
$this
->
numRows
 >0) {

199 
$row
 = 
	`mysql_ãtch_assoc
(
$this
->
qu”yID
)){

200 
$»suÉ
[] = 
$row
;

202 
	`mysql_d©a_£ek
(
$this
->
qu”yID
,0);

204  
$»suÉ
;

205 
	}
}

212 
public
 
funùiÚ
 
	$g‘F›lds
(
$bËName
) {

213 
$»suÉ
 = 
$this
->
	`qu”y
('SHOW COLUMNS FROM '.$this->
	`·r£Key
(
$bËName
));

214 
$šfo
 = 
	`¬¿y
();

215 if(
$»suÉ
) {

216 
	`fÜ—ch
 (
$»suÉ
 
as
 
$key
 => 
$v®
) {

217 
$šfo
[
$v®
['F›ld']] = 
	`¬¿y
(

218 'Çme' => 
$v®
['Field'],

219 'ty³' => 
$v®
['Type'],

220 'nÙnuÎ' => (
boŞ
è(
$v®
['Null'] === ''),

221 'deçuÉ' => 
$v®
['Default'],

222 '´im¬y' => (
	`¡¹Şow”
(
$v®
['Key']) == 'pri'),

223 'autošc' => (
	`¡¹Şow”
(
$v®
['Extra']) == 'auto_increment'),

227  
$šfo
;

228 
	}
}

235 
public
 
funùiÚ
 
g‘TabËs
(
$dbName
='') {

236 if(!
em±y
(
$dbName
)) {

237 
$sql
 = 'SHOW TABLES FROM '.
$dbName
;

239 
	g$sql
 = 'SHOW TABLES ';

241 
	g$»suÉ
 = 
$this
->
qu”y
(
$sql
);

242 
	g$šfo
 = 
¬¿y
();

243 
fÜ—ch
 (
$»suÉ
 
as
 
$key
 => 
$v®
) {

244 
$šfo
[
$key
] = 
cu¼’t
(
$v®
);

246  
	g$šfo
;

256 
public
 
funùiÚ
 
»¶aû
(
$d©a
,
$İtiÚs
=
	$¬¿y
()) {

257 
	`fÜ—ch
 (
$d©a
 
as
 
$key
=>
$v®
){

258 
$v®ue
 = 
$this
->
	`·r£V®ue
(
$v®
);

259 if(
	`is_sÿÏr
(
$v®ue
)) {

260 
$v®ues
[] = 
$v®ue
;

261 
$f›lds
[] = 
$this
->
	`·r£Key
(
$key
);

264 
$sql
 = 'REPLACE INTO '.
$this
->
	`·r£TabË
(
$İtiÚs
['bË']).' ('.
	`im¶ode
(',', 
$f›lds
).'èVALUES ('.im¶ode(',', 
$v®ues
).')';

265  
$this
->
	`execu‹
(
$sql
);

266 
	}
}

276 
public
 
funùiÚ
 
š£¹AÎ
(
$d©as
,
$İtiÚs
=
¬¿y
(),
$»¶aû
=
çl£
) {

277 if(!
is_¬¿y
(
$d©as
[0])è 
çl£
;

278 
	g$f›lds
 = 
¬¿y_keys
(
$d©as
[0]);

279 
¬¿y_w®k
(
$f›lds
, 
¬¿y
(
$this
, 'parseKey'));

280 
	g$v®ues
 = 
¬¿y
();

281 
fÜ—ch
 (
$d©as
 
as
 
$d©a
){

282 
	g$v®ue
 = 
¬¿y
();

283 
fÜ—ch
 (
$d©a
 
as
 
$key
=>
$v®
){

284 
$v®
 = 
$this
->
·r£V®ue
($val);

285 if(
is_sÿÏr
(
$v®
)) {

286 
	g$v®ue
[] = 
$v®
;

289 
	g$v®ues
[] = '('.
im¶ode
(',', 
$v®ue
).')';

291 
	g$sql
 = (
$»¶aû
?'REPLACE':'INSERT').' INTO '.
$this
->
·r£TabË
(
$İtiÚs
['bË']).' ('.
im¶ode
(',', 
$f›lds
).'èVALUES '.im¶ode(',',
$v®ues
);

292  
	g$this
->
execu‹
(
$sql
);

300 
public
 
funùiÚ
 
	$şo£
() {

301 ià(
$this
->
_lškID
){

302 
	`mysql_şo£
(
$this
->
_lškID
);

304 
$this
->
_lškID
 = 
nuÎ
;

305 
	}
}

313 
public
 
funùiÚ
 
	$”rÜ
() {

314 
$this
->
”rÜ
 = 
	`mysql_”rÜ
($this->
_lškID
);

315 if('' !ğ
$this
->
qu”ySŒ
){

316 
$this
->
”rÜ
 .ğ"\À[ SQLè¯­å¥ ] : ".$this->
qu”ySŒ
;

318 
	`Œaû
(
$this
->
”rÜ
,'','ERR');

319  
$this
->
”rÜ
;

320 
	}
}

328 
public
 
funùiÚ
 
	$esÿ³SŒšg
(
$¡r
) {

329 if(
$this
->
_lškID
) {

330  
	`mysql_»®_esÿ³_¡ršg
(
$¡r
,
$this
->
_lškID
);

332  
	`mysql_esÿ³_¡ršg
(
$¡r
);

334 
	}
}

342 
´Ùeùed
 
funùiÚ
 
	$·r£Key
(&
$key
) {

343 
$key
 = 
	`Œim
($key);

344 if(!
	`´eg_m©ch
('/[,\'\"\*\(\)`.\s]/',
$key
)) {

345 
$key
 = '`'.$key.'`';

347  
$key
;

348 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Driver\Db\DbMysqli.class.php

1 <?
php


12 
defšed
('THINK_PATH'è
Ü
 
ex™
();

20 şas 
	cDbMysqli
 
ex‹nds
 
	mDb
{

27 
public
 
funùiÚ
 
__cÚ¡ruù
(
$cÚfig
=''){

28 iàĞ!
ex‹nsiÚ_lßded
('mysqli') ) {

29 
throw_exû±iÚ
(
L
('_NOT_SUPPERT_').':mysqli');

31 if(!
em±y
(
$cÚfig
)) {

32 
	m$this
->
	mcÚfig
 = 
$cÚfig
;

33 if(
em±y
(
$this
->
cÚfig
['params'])) {

34 
	m$this
->
	mcÚfig
['params'] = '';

44 
public
 
funùiÚ
 
cÚÃù
(
$cÚfig
='',
$lškNum
=0) {

45 iàĞ!
is£t
(
$this
->
lškID
[
$lškNum
]) ) {

46 if(
em±y
(
$cÚfig
)è$cÚfig = 
$this
->
cÚfig
;

47 
	g$this
->
	glškID
[
$lškNum
] = 
Ãw
 
mysqli
(
$cÚfig
['ho¡Çme'],$cÚfig['u£ºame'],$cÚfig['·sswÜd'],$cÚfig['d©aba£'],$cÚfig['ho¡pÜt']?
štv®
($config['hostport']):3306);

48 ià(
mysqli_cÚÃù_”ºo
()è
throw_exû±iÚ
(
mysqli_cÚÃù_”rÜ
());

49 
	g$dbV”siÚ
 = 
$this
->
lškID
[
$lškNum
]->
£rv”_v”siÚ
;

52 
	g$this
->
	glškID
[
$lškNum
]->
qu”y
("SET NAMES '".
C
('DB_CHARSET')."'");

54 if(
	g$dbV”siÚ
 >'5.0.1'){

55 
	g$this
->
	glškID
[
$lškNum
]->
qu”y
("SET sql_mode=''");

58 
	g$this
->
	gcÚÃùed
 = 
Œue
;

60 if(1 !ğ
C
('DB_DEPLOY_TYPE')è
un£t
(
$this
->
cÚfig
);

62  
	g$this
->
	glškID
[
$lškNum
];

69 
public
 
funùiÚ
 
	$ä“
() {

70 
$this
->
qu”yID
->
	`ä“_»suÉ
();

71 
$this
->
qu”yID
 = 
nuÎ
;

72 
	}
}

80 
public
 
funùiÚ
 
	$qu”y
(
$¡r
) {

81 
$this
->
	`š™CÚÃù
(
çl£
);

82 iàĞ!
$this
->
_lškID
 )  
çl£
;

83 
$this
->
qu”ySŒ
 = 
$¡r
;

85 iàĞ
$this
->
qu”yID
 ) $this->
	`ä“
();

86 
	`N
('db_query',1);

88 
	`G
('queryStartTime');

89 
$this
->
qu”yID
 = $this->
_lškID
->
	`qu”y
(
$¡r
);

91 ifĞ
$this
->
_lškID
->
	`mÜe_»suÉs
() ){

92 (
$»s
 = 
$this
->
_lškID
->
	`Ãxt_»suÉ
()è!ğ
NULL
) {

93 
$»s
->
	`ä“_»suÉ
();

96 
$this
->
	`debug
();

97 iàĞ
çl£
 ==ğ
$this
->
qu”yID
 ) {

98 
$this
->
	`”rÜ
();

99  
çl£
;

101 
$this
->
numRows
 = $this->
qu”yID
->
num_rows
;

102 
$this
->
numCŞs
 = $this->
qu”yID
->
f›ld_couÁ
;

103  
$this
->
	`g‘AÎ
();

105 
	}
}

113 
public
 
funùiÚ
 
	$execu‹
(
$¡r
) {

114 
$this
->
	`š™CÚÃù
(
Œue
);

115 iàĞ!
$this
->
_lškID
 )  
çl£
;

116 
$this
->
qu”ySŒ
 = 
$¡r
;

118 iàĞ
$this
->
qu”yID
 ) $this->
	`ä“
();

119 
	`N
('db_write',1);

121 
	`G
('queryStartTime');

122 
$»suÉ
 = 
$this
->
_lškID
->
	`qu”y
(
$¡r
);

123 
$this
->
	`debug
();

124 iàĞ
çl£
 ==ğ
$»suÉ
 ) {

125 
$this
->
	`”rÜ
();

126  
çl£
;

128 
$this
->
numRows
 = $this->
_lškID
->
afãùed_rows
;

129 
$this
->
Ï¡InsID
 = $this->
_lškID
->
š£¹_id
;

130  
$this
->
numRows
;

132 
	}
}

139 
public
 
funùiÚ
 
	$¡¬tT¿ns
() {

140 
$this
->
	`š™CÚÃù
(
Œue
);

142 ià(
$this
->
ŒªsTimes
 == 0) {

143 
$this
->
_lškID
->
	`autocomm™
(
çl£
);

145 
$this
->
ŒªsTimes
++;

147 
	}
}

154 
public
 
funùiÚ
 
	$comm™
() {

155 ià(
$this
->
ŒªsTimes
 > 0) {

156 
$»suÉ
 = 
$this
->
_lškID
->
	`comm™
();

157 
$this
->
_lškID
->
	`autocomm™
Ğ
Œue
);

158 
$this
->
ŒªsTimes
 = 0;

159 if(!
$»suÉ
){

160 
$this
->
	`”rÜ
();

161  
çl£
;

164  
Œue
;

165 
	}
}

172 
public
 
funùiÚ
 
	$rŞlback
() {

173 ià(
$this
->
ŒªsTimes
 > 0) {

174 
$»suÉ
 = 
$this
->
_lškID
->
	`rŞlback
();

175 
$this
->
ŒªsTimes
 = 0;

176 if(!
$»suÉ
){

177 
$this
->
	`”rÜ
();

178  
çl£
;

181  
Œue
;

182 
	}
}

190 
´iv©e
 
funùiÚ
 
	$g‘AÎ
() {

192 
$»suÉ
 = 
	`¬¿y
();

193 if(
$this
->
numRows
>0) {

195 
$i
=0;$i<
$this
->
numRows
 ;$i++ ){

196 
$»suÉ
[
$i
] = 
$this
->
qu”yID
->
	`ãtch_assoc
();

198 
$this
->
qu”yID
->
	`d©a_£ek
(0);

200  
$»suÉ
;

201 
	}
}

208 
public
 
funùiÚ
 
	$g‘F›lds
(
$bËName
) {

209 
$»suÉ
 = 
$this
->
	`qu”y
('SHOW COLUMNS FROM '.$this->
	`·r£Key
(
$bËName
));

210 
$šfo
 = 
	`¬¿y
();

211 if(
$»suÉ
) {

212 
	`fÜ—ch
 (
$»suÉ
 
as
 
$key
 => 
$v®
) {

213 
$šfo
[
$v®
['F›ld']] = 
	`¬¿y
(

214 'Çme' => 
$v®
['Field'],

215 'ty³' => 
$v®
['Type'],

216 'nÙnuÎ' => (
boŞ
è(
$v®
['Null'] === ''),

217 'deçuÉ' => 
$v®
['Default'],

218 '´im¬y' => (
	`¡¹Şow”
(
$v®
['Key']) == 'pri'),

219 'autošc' => (
	`¡¹Şow”
(
$v®
['Extra']) == 'auto_increment'),

223  
$šfo
;

224 
	}
}

231 
public
 
funùiÚ
 
g‘TabËs
(
$dbName
='') {

232 
$sql
 = !
em±y
(
$dbName
)?'SHOW TABLES FROM '.$dbName:'SHOW TABLES ';

233 
	g$»suÉ
 = 
$this
->
qu”y
(
$sql
);

234 
	g$šfo
 = 
¬¿y
();

235 if(
	g$»suÉ
) {

236 
fÜ—ch
 (
$»suÉ
 
as
 
$key
 => 
$v®
) {

237 
$šfo
[
$key
] = 
cu¼’t
(
$v®
);

240  
	g$šfo
;

250 
public
 
funùiÚ
 
»¶aû
(
$d©a
,
$İtiÚs
=
	$¬¿y
()) {

251 
	`fÜ—ch
 (
$d©a
 
as
 
$key
=>
$v®
){

252 
$v®ue
 = 
$this
->
	`·r£V®ue
(
$v®
);

253 if(
	`is_sÿÏr
(
$v®ue
)) {

254 
$v®ues
[] = 
$v®ue
;

255 
$f›lds
[] = 
$this
->
	`·r£Key
(
$key
);

258 
$sql
 = 'REPLACE INTO '.
$this
->
	`·r£TabË
(
$İtiÚs
['bË']).' ('.
	`im¶ode
(',', 
$f›lds
).'èVALUES ('.im¶ode(',', 
$v®ues
).')';

259  
$this
->
	`execu‹
(
$sql
);

260 
	}
}

270 
public
 
funùiÚ
 
š£¹AÎ
(
$d©as
,
$İtiÚs
=
¬¿y
(),
$»¶aû
=
çl£
) {

271 if(!
is_¬¿y
(
$d©as
[0])è 
çl£
;

272 
	g$f›lds
 = 
¬¿y_keys
(
$d©as
[0]);

273 
¬¿y_w®k
(
$f›lds
, 
¬¿y
(
$this
, 'parseKey'));

274 
	g$v®ues
 = 
¬¿y
();

275 
fÜ—ch
 (
$d©as
 
as
 
$d©a
){

276 
	g$v®ue
 = 
¬¿y
();

277 
fÜ—ch
 (
$d©a
 
as
 
$key
=>
$v®
){

278 
$v®
 = 
$this
->
·r£V®ue
($val);

279 if(
is_sÿÏr
(
$v®
)) {

280 
	g$v®ue
[] = 
$v®
;

283 
	g$v®ues
[] = '('.
im¶ode
(',', 
$v®ue
).')';

285 
	g$sql
 = (
$»¶aû
?'REPLACE':'INSERT').' INTO '.
$this
->
·r£TabË
(
$İtiÚs
['bË']).' ('.
im¶ode
(',', 
$f›lds
).'èVALUES '.im¶ode(',',
$v®ues
);

286  
	g$this
->
execu‹
(
$sql
);

294 
public
 
funùiÚ
 
	$şo£
() {

295 ià(
$this
->
_lškID
){

296 
$this
->
_lškID
->
	`şo£
();

298 
$this
->
_lškID
 = 
nuÎ
;

299 
	}
}

308 
public
 
funùiÚ
 
	$”rÜ
() {

309 
$this
->
”rÜ
 = $this->
_lškID
->error;

310 if('' !ğ
$this
->
qu”ySŒ
){

311 
$this
->
”rÜ
 .ğ"\À[ SQLè¯­å¥ ] : ".$this->
qu”ySŒ
;

313 
	`Œaû
(
$this
->
”rÜ
,'','ERR');

314  
$this
->
”rÜ
;

315 
	}
}

324 
public
 
funùiÚ
 
	$esÿ³SŒšg
(
$¡r
) {

325 if(
$this
->
_lškID
) {

326  
$this
->
_lškID
->
	`»®_esÿ³_¡ršg
(
$¡r
);

328  
	`add¦ashes
(
$¡r
);

330 
	}
}

338 
´Ùeùed
 
funùiÚ
 
	$·r£Key
(&
$key
) {

339 
$key
 = 
	`Œim
($key);

340 if(!
	`´eg_m©ch
('/[,\'\"\*\(\)`.\s]/',
$key
)) {

341 
$key
 = '`'.$key.'`';

343  
$key
;

344 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Driver\TagLib\TagLibCx.class.php

1 <?
php


12 
defšed
('THINK_PATH'è
Ü
 
ex™
();

20 şas 
	cTagLibCx
 
ex‹nds
 
	mTagLib
 {

23 
´Ùeùed
 
	m$gs
 = 
¬¿y
(

25 'php' => 
¬¿y
(),

26 'vŞi¡' => 
¬¿y
('attr'=>'name,id,offset,length,key,mod','level'=>3,'alias'=>'iterate'),

27 'fÜ—ch' => 
¬¿y
('attr'=>'name,item,key','level'=>3),

28 'if' => 
¬¿y
('attr'=>'condition','level'=>2),

29 '–£if' => 
¬¿y
('attr'=>'condition','close'=>0),

30 '–£' => 
¬¿y
('attr'=>'','close'=>0),

31 'sw™ch' => 
¬¿y
('attr'=>'name','level'=>2),

32 'ÿ£' => 
¬¿y
('attr'=>'value,break'),

33 'deçuÉ' => 
¬¿y
('attr'=>'','close'=>0),

34 'com·»' => 
¬¿y
('attr'=>'name,value,type','level'=>3,'alias'=>'eq,equal,notequal,neq,gt,lt,egt,elt,heq,nheq'),

35 '¿nge' => 
¬¿y
('attr'=>'name,value,type','level'=>3,'alias'=>'in,notin,between,notbetween'),

36 'em±y' => 
¬¿y
('attr'=>'name','level'=>3),

37 'nÙem±y' => 
¬¿y
('attr'=>'name','level'=>3),

38 '´e£Á' => 
¬¿y
('attr'=>'name','level'=>3),

39 'nÙ´e£Á'=> 
¬¿y
('attr'=>'name','level'=>3),

40 'defšed' => 
¬¿y
('attr'=>'name','level'=>3),

41 'nÙdefšed'=> 
¬¿y
('attr'=>'name','level'=>3),

42 'impÜt' => 
¬¿y
('attr'=>'file,href,type,value,basepath','close'=>0,'alias'=>'load,css,js'),

43 'assign' => 
¬¿y
('attr'=>'name,value','close'=>0),

44 'defše' => 
¬¿y
('attr'=>'name,value','close'=>0),

45 'fÜ' => 
¬¿y
('attr'=>'start,end,name,comparison,step', 'level'=>3),

55 
public
 
funùiÚ
 
	$_php
(
$©Œ
,
$cÚ‹Á
) {

56 
$·r£SŒ
 = '<?ph°'.
$cÚ‹Á
.' ?>';

57  
$·r£SŒ
;

72 
public
 
funùiÚ
 
	$_vŞi¡
(
$©Œ
,
$cÚ‹Á
) {

73 
$_™”©eP¬£Cache
 = 
	`¬¿y
();

75 
$ÿcheI‹¿‹Id
 = 
	`md5
(
$©Œ
.
$cÚ‹Á
);

76 if(
	`is£t
(
$_™”©eP¬£Cache
[
$ÿcheI‹¿‹Id
]))

77  
$_™”©eP¬£Cache
[
$ÿcheI‹¿‹Id
];

78 
$g
 = 
$this
->
	`·r£XmlA‰r
(
$©Œ
,'volist');

79 
$Çme
 = 
$g
['name'];

80 
$id
 = 
$g
['id'];

81 
$em±y
 = 
	`is£t
(
$g
['empty'])?$tag['empty']:'';

82 
$key
 = !
	`em±y
(
$g
['key'])?$tag['key']:'i';

83 
$mod
 = 
	`is£t
(
$g
['mod'])?$tag['mod']:'2';

85 
$·r£SŒ
 = '<?php ';

86 if(0===
	`¡½os
(
$Çme
,':')) {

87 
$·r£SŒ
 .ğ'$_»suÉ='.
	`sub¡r
(
$Çme
,1).';';

88 
$Çme
 = '$_result';

90 
$Çme
 = 
$this
->
	`autoBudV¬
($name);

92 
$·r£SŒ
 .ğ'if(is_¬¿y('.
$Çme
.')): $'.
$key
.' = 0;';

93 if(
	`is£t
(
$g
['length']) && '' !=$tag['length'] ) {

94 
$·r£SŒ
 .ğ' $__LIST__ =‡¼ay_¦iû('.
$Çme
.','.
$g
['offset'].','.$tag['length'].',true);';

95 }
	`–£if
(
	`is£t
(
$g
['offset']) && '' !=$tag['offset']){

96 
$·r£SŒ
 .ğ' $__LIST__ =‡¼ay_¦iû('.
$Çme
.','.
$g
['offset'].',null,true);';

98 
$·r£SŒ
 .ğ' $__LIST__ = '.
$Çme
.';';

100 
$·r£SŒ
 .ğ'ifĞcouÁ($__LIST__)==0 ) :ƒchØ"'.
$em±y
.'" ;';

101 
$·r£SŒ
 .= 'else: ';

102 
$·r£SŒ
 .ğ'fÜ—ch($__LIST__‡ $key=>$'.
$id
.'): ';

103 
$·r£SŒ
 .ğ'$mod = ($'.
$key
.' % '.
$mod
.' );';

104 
$·r£SŒ
 .ğ'++$'.
$key
.';?>';

105 
$·r£SŒ
 .ğ
$this
->
l
->
	`·r£
(
$cÚ‹Á
);

106 
$·r£SŒ
 .ğ'<?ph°’dfÜ—ch;ƒndif;ƒl£:ƒchØ"'.
$em±y
.'" ;endif; ?>';

107 
$_™”©eP¬£Cache
[
$ÿcheI‹¿‹Id
] = 
$·r£SŒ
;

109 if(!
	`em±y
(
$·r£SŒ
)) {

110  
$·r£SŒ
;

113 
	}
}

122 
public
 
funùiÚ
 
	$_fÜ—ch
(
$©Œ
,
$cÚ‹Á
) {

123 
$_™”©eP¬£Cache
 = 
	`¬¿y
();

125 
$ÿcheI‹¿‹Id
 = 
	`md5
(
$©Œ
.
$cÚ‹Á
);

126 if(
	`is£t
(
$_™”©eP¬£Cache
[
$ÿcheI‹¿‹Id
]))

127  
$_™”©eP¬£Cache
[
$ÿcheI‹¿‹Id
];

128 
$g
 = 
$this
->
	`·r£XmlA‰r
(
$©Œ
,'foreach');

129 
$Çme
 = 
$g
['name'];

130 
$™em
 = 
$g
['item'];

131 
$key
 = !
	`em±y
(
$g
['key'])?$tag['key']:'key';

132 
$Çme
 = 
$this
->
	`autoBudV¬
($name);

133 
$·r£SŒ
 = '<?ph°if(is_¬¿y('.
$Çme
.')): fÜ—ch('.$Çme.'‡ $'.
$key
.'=>$'.
$™em
.'): ?>';

134 
$·r£SŒ
 .ğ
$this
->
l
->
	`·r£
(
$cÚ‹Á
);

135 
$·r£SŒ
 .= '<?phpƒndforeach;ƒndif; ?>';

136 
$_™”©eP¬£Cache
[
$ÿcheI‹¿‹Id
] = 
$·r£SŒ
;

137 if(!
	`em±y
(
$·r£SŒ
)) {

138  
$·r£SŒ
;

141 
	}
}

156 
public
 
funùiÚ
 
	$_if
(
$©Œ
,
$cÚ‹Á
) {

157 
$g
 = 
$this
->
	`·r£XmlA‰r
(
$©Œ
,'if');

158 
$cÚd™iÚ
 = 
$this
->
	`·r£CÚd™iÚ
(
$g
['condition']);

159 
$·r£SŒ
 = '<?ph°if('.
$cÚd™iÚ
.'): ?>'.
$cÚ‹Á
.'<?phpƒndif; ?>';

160  
$·r£SŒ
;

161 
	}
}

171 
public
 
funùiÚ
 
	$_–£if
(
$©Œ
,
$cÚ‹Á
) {

172 
$g
 = 
$this
->
	`·r£XmlA‰r
(
$©Œ
,'elseif');

173 
$cÚd™iÚ
 = 
$this
->
	`·r£CÚd™iÚ
(
$g
['condition']);

174 
$·r£SŒ
 = '<?ph°–£if('.
$cÚd™iÚ
.'): ?>';

175  
$·r£SŒ
;

176 
	}
}

184 
public
 
funùiÚ
 
	$_–£
(
$©Œ
) {

185 
$·r£SŒ
 = '<?phpƒlse: ?>';

186  
$·r£SŒ
;

187 
	}
}

202 
public
 
funùiÚ
 
	$_sw™ch
(
$©Œ
,
$cÚ‹Á
) {

203 
$g
 = 
$this
->
	`·r£XmlA‰r
(
$©Œ
,'switch');

204 
$Çme
 = 
$g
['name'];

205 
$v¬A¼ay
 = 
	`ex¶ode
('|',
$Çme
);

206 
$Çme
 = 
	`¬¿y_shiá
(
$v¬A¼ay
);

207 
$Çme
 = 
$this
->
	`autoBudV¬
($name);

208 if(
	`couÁ
(
$v¬A¼ay
)>0)

209 
$Çme
 = 
$this
->
l
->
	`·r£V¬FunùiÚ
($Çme,
$v¬A¼ay
);

210 
$·r£SŒ
 = '<?ph°sw™ch('.
$Çme
.'): ?>'.
$cÚ‹Á
.'<?phpƒndswitch;?>';

211  
$·r£SŒ
;

212 
	}
}

221 
public
 
funùiÚ
 
	$_ÿ£
(
$©Œ
,
$cÚ‹Á
) {

222 
$g
 = 
$this
->
	`·r£XmlA‰r
(
$©Œ
,'case');

223 
$v®ue
 = 
$g
['value'];

224 if('$' =ğ
	`sub¡r
(
$v®ue
,0,1)) {

225 
$v¬A¼ay
 = 
	`ex¶ode
('|',
$v®ue
);

226 
$v®ue
 = 
	`¬¿y_shiá
(
$v¬A¼ay
);

227 
$v®ue
 = 
$this
->
	`autoBudV¬
(
	`sub¡r
($value,1));

228 if(
	`couÁ
(
$v¬A¼ay
)>0)

229 
$v®ue
 = 
$this
->
l
->
	`·r£V¬FunùiÚ
($v®ue,
$v¬A¼ay
);

230 
$v®ue
 = 'case '.$value.': ';

231 }
	`–£if
(
	`¡½os
(
$v®ue
,'|')){

232 
$v®ues
 = 
	`ex¶ode
('|',
$v®ue
);

233 
$v®ue
 = '';

234 
	`fÜ—ch
 (
$v®ues
 
as
 
$v®
){

235 
$v®ue
 .ğ'ÿ£ "'.
	`add¦ashes
(
$v®
).'": ';

238 
$v®ue
 = 'case "'.$value.'": ';

240 
$·r£SŒ
 = '<?ph°'.
$v®ue
.' ?>'.
$cÚ‹Á
;

241 
$isB»ak
 = 
	`is£t
(
$g
['break']) ? $tag['break'] : '';

242 if('' ==
$isB»ak
 || $isBreak) {

243 
$·r£SŒ
 .= '<?php break;?>';

245  
$·r£SŒ
;

246 
	}
}

256 
public
 
funùiÚ
 
	$_deçuÉ
(
$©Œ
) {

257 
$·r£SŒ
 = '<?php default: ?>';

258  
$·r£SŒ
;

259 
	}
}

270 
public
 
funùiÚ
 
_com·»
(
$©Œ
,
$cÚ‹Á
,
$ty³
='eq') {

271 
$g
 = 
$this
->
·r£XmlA‰r
(
$©Œ
,'compare');

272 
	g$Çme
 = 
$g
['name'];

273 
	g$v®ue
 = 
$g
['value'];

274 
	g$ty³
 = 
is£t
(
$g
['ty³'])?$g['ty³']:
$ty³
;

275 
	g$ty³
 = 
$this
->
·r£CÚd™iÚ
(' '.
$ty³
.' ');

276 
	g$v¬A¼ay
 = 
ex¶ode
('|',
$Çme
);

277 
	g$Çme
 = 
¬¿y_shiá
(
$v¬A¼ay
);

278 
	g$Çme
 = 
$this
->
autoBudV¬
(
$Çme
);

279 if(
couÁ
(
$v¬A¼ay
)>0)

280 
	g$Çme
 = 
$this
->
l
->
·r£V¬FunùiÚ
(
$Çme
,
$v¬A¼ay
);

281 if('$' =ğ
sub¡r
(
$v®ue
,0,1)) {

282 
	g$v®ue
 = 
$this
->
autoBudV¬
(
sub¡r
(
$v®ue
,1));

284 
	g$v®ue
 = '"'.
$v®ue
.'"';

286 
	g$·r£SŒ
 = '<?ph°if(('.
$Çme
.'è'.
$ty³
.' '.
$v®ue
.'): ?>'.
$cÚ‹Á
.'<?phpƒndif; ?>';

287  
	g$·r£SŒ
;

290 
public
 
funùiÚ
 
	$_eq
(
$©Œ
,
$cÚ‹Á
) {

291  
$this
->
	`_com·»
(
$©Œ
,
$cÚ‹Á
,'eq');

292 
	}
}

294 
public
 
funùiÚ
 
	$_equ®
(
$©Œ
,
$cÚ‹Á
) {

295  
$this
->
	`_com·»
(
$©Œ
,
$cÚ‹Á
,'eq');

296 
	}
}

298 
public
 
funùiÚ
 
	$_Ãq
(
$©Œ
,
$cÚ‹Á
) {

299  
$this
->
	`_com·»
(
$©Œ
,
$cÚ‹Á
,'neq');

300 
	}
}

302 
public
 
funùiÚ
 
	$_nÙequ®
(
$©Œ
,
$cÚ‹Á
) {

303  
$this
->
	`_com·»
(
$©Œ
,
$cÚ‹Á
,'neq');

304 
	}
}

306 
public
 
funùiÚ
 
	$_gt
(
$©Œ
,
$cÚ‹Á
) {

307  
$this
->
	`_com·»
(
$©Œ
,
$cÚ‹Á
,'gt');

308 
	}
}

310 
public
 
funùiÚ
 
	$_É
(
$©Œ
,
$cÚ‹Á
) {

311  
$this
->
	`_com·»
(
$©Œ
,
$cÚ‹Á
,'lt');

312 
	}
}

314 
public
 
funùiÚ
 
	$_egt
(
$©Œ
,
$cÚ‹Á
) {

315  
$this
->
	`_com·»
(
$©Œ
,
$cÚ‹Á
,'egt');

316 
	}
}

318 
public
 
funùiÚ
 
	$_–t
(
$©Œ
,
$cÚ‹Á
) {

319  
$this
->
	`_com·»
(
$©Œ
,
$cÚ‹Á
,'elt');

320 
	}
}

322 
public
 
funùiÚ
 
	$_heq
(
$©Œ
,
$cÚ‹Á
) {

323  
$this
->
	`_com·»
(
$©Œ
,
$cÚ‹Á
,'heq');

324 
	}
}

326 
public
 
funùiÚ
 
	$_nheq
(
$©Œ
,
$cÚ‹Á
) {

327  
$this
->
	`_com·»
(
$©Œ
,
$cÚ‹Á
,'nheq');

328 
	}
}

341 
public
 
funùiÚ
 
_¿nge
(
$©Œ
,
$cÚ‹Á
,
$ty³
='in') {

342 
$g
 = 
$this
->
·r£XmlA‰r
(
$©Œ
,'range');

343 
	g$Çme
 = 
$g
['name'];

344 
	g$v®ue
 = 
$g
['value'];

345 
	g$v¬A¼ay
 = 
ex¶ode
('|',
$Çme
);

346 
	g$Çme
 = 
¬¿y_shiá
(
$v¬A¼ay
);

347 
	g$Çme
 = 
$this
->
autoBudV¬
(
$Çme
);

348 if(
couÁ
(
$v¬A¼ay
)>0)

349 
	g$Çme
 = 
$this
->
l
->
·r£V¬FunùiÚ
(
$Çme
,
$v¬A¼ay
);

351 
	g$ty³
 = 
is£t
(
$g
['ty³'])?$g['ty³']:
$ty³
;

353 if('$' =ğ
sub¡r
(
$v®ue
,0,1)) {

354 
	g$v®ue
 = 
$this
->
autoBudV¬
(
sub¡r
(
$v®ue
,1));

355 
	g$¡r
 = 'is_¬¿y('.
$v®ue
.')?'.$value.':explode(\',\','.$value.')';

357 
	g$v®ue
 = '"'.
$v®ue
.'"';

358 
	g$¡r
 = 'ex¶ode(\',\','.
$v®ue
.')';

360 if(
	g$ty³
=='between') {

361 
$·r£SŒ
 = '<?ph°$_RANGE_VAR_='.
$¡r
.';if('.
$Çme
.'>ğ$_RANGE_VAR_[0] && '.$Çme.'<ğ$_RANGE_VAR_[1]):?>'.
$cÚ‹Á
.'<?phpƒndif; ?>';

362 }
–£if
(
$ty³
=='notbetween'){

363 
$·r£SŒ
 = '<?ph°$_RANGE_VAR_='.
$¡r
.';if('.
$Çme
.'<$_RANGE_VAR_[0] && '.$Çme.'>$_RANGE_VAR_[1]):?>'.
$cÚ‹Á
.'<?phpƒndif; ?>';

365 
	g$fun
 = (
$ty³
 == 'in')? 'in_array' : '!in_array';

366 
	g$·r£SŒ
 = '<?ph°if('.
$fun
.'(('.
$Çme
.'), '.
$¡r
.')): ?>'.
$cÚ‹Á
.'<?phpƒndif; ?>';

368  
	g$·r£SŒ
;

372 
public
 
funùiÚ
 
	$_š
(
$©Œ
,
$cÚ‹Á
) {

373  
$this
->
	`_¿nge
(
$©Œ
,
$cÚ‹Á
,'in');

374 
	}
}

377 
public
 
funùiÚ
 
	$_nÙš
(
$©Œ
,
$cÚ‹Á
) {

378  
$this
->
	`_¿nge
(
$©Œ
,
$cÚ‹Á
,'notin');

379 
	}
}

381 
public
 
funùiÚ
 
	$_b‘w“n
(
$©Œ
,
$cÚ‹Á
){

382  
$this
->
	`_¿nge
(
$©Œ
,
$cÚ‹Á
,'between');

383 
	}
}

385 
public
 
funùiÚ
 
	$_nÙb‘w“n
(
$©Œ
,
$cÚ‹Á
){

386  
$this
->
	`_¿nge
(
$©Œ
,
$cÚ‹Á
,'notbetween');

387 
	}
}

398 
public
 
funùiÚ
 
	$_´e£Á
(
$©Œ
,
$cÚ‹Á
) {

399 
$g
 = 
$this
->
	`·r£XmlA‰r
(
$©Œ
,'present');

400 
$Çme
 = 
$g
['name'];

401 
$Çme
 = 
$this
->
	`autoBudV¬
($name);

402 
$·r£SŒ
 = '<?ph°if(is£t('.
$Çme
.')): ?>'.
$cÚ‹Á
.'<?phpƒndif; ?>';

403  
$·r£SŒ
;

404 
	}
}

415 
public
 
funùiÚ
 
	$_nÙ´e£Á
(
$©Œ
,
$cÚ‹Á
) {

416 
$g
 = 
$this
->
	`·r£XmlA‰r
(
$©Œ
,'notpresent');

417 
$Çme
 = 
$g
['name'];

418 
$Çme
 = 
$this
->
	`autoBudV¬
($name);

419 
$·r£SŒ
 = '<?ph°if(!is£t('.
$Çme
.')): ?>'.
$cÚ‹Á
.'<?phpƒndif; ?>';

420  
$·r£SŒ
;

421 
	}
}

432 
public
 
funùiÚ
 
	$_em±y
(
$©Œ
,
$cÚ‹Á
) {

433 
$g
 = 
$this
->
	`·r£XmlA‰r
(
$©Œ
,'empty');

434 
$Çme
 = 
$g
['name'];

435 
$Çme
 = 
$this
->
	`autoBudV¬
($name);

436 
$·r£SŒ
 = '<?ph°ifÓm±y('.
$Çme
.')): ?>'.
$cÚ‹Á
.'<?phpƒndif; ?>';

437  
$·r£SŒ
;

438 
	}
}

440 
public
 
funùiÚ
 
	$_nÙem±y
(
$©Œ
,
$cÚ‹Á
) {

441 
$g
 = 
$this
->
	`·r£XmlA‰r
(
$©Œ
,'notempty');

442 
$Çme
 = 
$g
['name'];

443 
$Çme
 = 
$this
->
	`autoBudV¬
($name);

444 
$·r£SŒ
 = '<?ph°if(!em±y('.
$Çme
.')): ?>'.
$cÚ‹Á
.'<?phpƒndif; ?>';

445  
$·r£SŒ
;

446 
	}
}

455 
public
 
funùiÚ
 
	$_defšed
(
$©Œ
,
$cÚ‹Á
) {

456 
$g
 = 
$this
->
	`·r£XmlA‰r
(
$©Œ
,'defined');

457 
$Çme
 = 
$g
['name'];

458 
$·r£SŒ
 = '<?ph°if(defšed("'.
$Çme
.'")): ?>'.
$cÚ‹Á
.'<?phpƒndif; ?>';

459  
$·r£SŒ
;

460 
	}
}

462 
public
 
funùiÚ
 
	$_nÙdefšed
(
$©Œ
,
$cÚ‹Á
) {

463 
$g
 = 
$this
->
	`·r£XmlA‰r
(
$©Œ
,'_notdefined');

464 
$Çme
 = 
$g
['name'];

465 
$·r£SŒ
 = '<?ph°if(!defšed("'.
$Çme
.'")): ?>'.
$cÚ‹Á
.'<?phpƒndif; ?>';

466  
$·r£SŒ
;

467 
	}
}

479 
public
 
funùiÚ
 
_impÜt
(
$©Œ
,
$cÚ‹Á
,
$isFe
=
çl£
,
$ty³
='') {

480 
$g
 = 
$this
->
·r£XmlA‰r
(
$©Œ
,'import');

481 
	g$fe
 = 
is£t
(
$g
['file'])?$tag['file']:$tag['href'];

482 
	g$·r£SŒ
 = '';

483 
	g$’dSŒ
 = '';

485 ià(
is£t
(
$g
['value'])) {

486 
	g$v¬A¼ay
 = 
ex¶ode
('|',
$g
['value']);

487 
	g$Çme
 = 
¬¿y_shiá
(
$v¬A¼ay
);

488 
	g$Çme
 = 
$this
->
autoBudV¬
(
$Çme
);

489 ià(!
em±y
(
$v¬A¼ay
))

490 
	g$Çme
 = 
$this
->
l
->
·r£V¬FunùiÚ
(
$Çme
,
$v¬A¼ay
);

492 
	g$Çme
 = 'is£t('.
$Çme
.')';

493 
	g$·r£SŒ
 .ğ'<?ph°if('.
$Çme
.'): ?>';

494 
	g$’dSŒ
 = '<?phpƒndif; ?>';

496 if(
	g$isFe
) {

498 
	g$ty³
 = 
$ty³
?$ty³:(!
em±y
(
$g
['ty³'])?
¡¹Şow”
($g['ty³']):
nuÎ
);

500 
	g$¬¿y
 = 
ex¶ode
(',',
$fe
);

501 
fÜ—ch
 (
$¬¿y
 
as
 
$v®
){

502 ià(!
	g$ty³
 || 
is£t
(
$»£t
)) {

503 
	g$ty³
 = 
$»£t
 = 
¡¹Şow”
(
sub¡r
(
¡¼chr
(
$v®
, '.'),1));

505 
	g$ty³
) {

507 
$·r£SŒ
 .ğ'<süˆty³="‹xt/javasüt" src="'.
$v®
.'"></script>';

510 
$·r£SŒ
 .ğ'<lšk„–="¡yËsh“t"y³="‹xt/css" h»f="'.
$v®
.'" />';

513 
$·r£SŒ
 .ğ'<?ph°»quœe_ÿche("'.
$v®
.'"); ?>';

519 
	g$ty³
 = 
$ty³
?$ty³:(!
em±y
(
$g
['ty³'])?
¡¹Şow”
($tag['type']):'js');

520 
	g$ba£·th
 = !
em±y
(
$g
['ba£·th'])?$g['ba£·th']:
__ROOT__
.'/Public';

522 
	g$¬¿y
 = 
ex¶ode
(',',
$fe
);

523 
fÜ—ch
 (
$¬¿y
 
as
 
$v®
){

524 
li¡
(
$v®
,
$v”siÚ
èğ
ex¶ode
('?',$val);

525 
	g$ty³
) {

527 
$·r£SŒ
 .ğ'<süˆty³="‹xt/javasüt" src="'.
$ba£·th
.'/'.
¡r_»¶aû
(
¬¿y
('.','#'),‡¼ay('/','.'),
$v®
).'.js'.(
	g$v”siÚ
?'?'.$version:'').'"></script>';

530 
$·r£SŒ
 .ğ'<lšk„–="¡yËsh“t"y³="‹xt/css" h»f="'.
$ba£·th
.'/'.
¡r_»¶aû
(
¬¿y
('.','#'),‡¼ay('/','.'),
$v®
).'.css'.(
	g$v”siÚ
?'?'.$version:'').'" />';

533 
$·r£SŒ
 .ğ'<?ph°impÜt("'.
$v®
.'"); ?>';

538  
	g$·r£SŒ
.
	g$’dSŒ
;

542 
public
 
funùiÚ
 
	$_lßd
(
$©Œ
,
$cÚ‹Á
) {

543  
$this
->
	`_impÜt
(
$©Œ
,
$cÚ‹Á
,
Œue
);

544 
	}
}

547 
public
 
funùiÚ
 
	$_css
(
$©Œ
,
$cÚ‹Á
) {

548  
$this
->
	`_impÜt
(
$©Œ
,
$cÚ‹Á
,
Œue
,'css');

549 
	}
}

552 
public
 
funùiÚ
 
	$_js
(
$©Œ
,
$cÚ‹Á
) {

553  
$this
->
	`_impÜt
(
$©Œ
,
$cÚ‹Á
,
Œue
,'js');

554 
	}
}

565 
public
 
funùiÚ
 
	$_assign
(
$©Œ
,
$cÚ‹Á
) {

566 
$g
 = 
$this
->
	`·r£XmlA‰r
(
$©Œ
,'assign');

567 
$Çme
 = 
$this
->
	`autoBudV¬
(
$g
['name']);

568 if('$'==
	`sub¡r
(
$g
['value'],0,1)) {

569 
$v®ue
 = 
$this
->
	`autoBudV¬
(
	`sub¡r
(
$g
['value'],1));

571 
$v®ue
 = '\''.
$g
['value']. '\'';

573 
$·r£SŒ
 = '<?ph°'.
$Çme
.' = '.
$v®ue
.'; ?>';

574  
$·r£SŒ
;

575 
	}
}

586 
public
 
funùiÚ
 
	$_defše
(
$©Œ
,
$cÚ‹Á
) {

587 
$g
 = 
$this
->
	`·r£XmlA‰r
(
$©Œ
,'define');

588 
$Çme
 = '\''.
$g
['name']. '\'';

589 if('$'==
	`sub¡r
(
$g
['value'],0,1)) {

590 
$v®ue
 = 
$this
->
	`autoBudV¬
(
	`sub¡r
(
$g
['value'],1));

592 
$v®ue
 = '\''.
$g
['value']. '\'';

594 
$·r£SŒ
 = '<?ph°defše('.
$Çme
.', '.
$v®ue
.'); ?>';

595  
$·r£SŒ
;

596 
	}
}

606 
public
 
funùiÚ
 
	$_fÜ
(
$©Œ
, 
$cÚ‹Á
){

608 
$¡¬t
 = 0;

609 
$’d
 = 0;

610 
$¡•
 = 1;

611 
$com·risÚ
 = 'lt';

612 
$Çme
 = 'i';

613 
$¿nd
 = 
	`¿nd
();

615 
	`fÜ—ch
 (
$this
->
	`·r£XmlA‰r
(
$©Œ
, 'fÜ'è
as
 
$key
 => 
$v®ue
){

616 
$v®ue
 = 
	`Œim
($value);

617 if(':'==
	`sub¡r
(
$v®ue
,0,1))

618 
$v®ue
 = 
	`sub¡r
($value,1);

619 
	`–£if
('$'==
	`sub¡r
(
$v®ue
,0,1))

620 
$v®ue
 = 
$this
->
	`autoBudV¬
(
	`sub¡r
($value,1));

621 
$key
){

623 
$¡¬t
 = 
$v®ue
; ;

625 
$’d
 = 
$v®ue
; ;

627 
$¡•
 = 
$v®ue
; ;

629 
$com·risÚ
 = 
$v®ue
; ;

631 
$Çme
 = 
$v®ue
; ;

635 
$·r£SŒ
 = '<?ph°$__FOR_START_'.
$¿nd
.'__='.
$¡¬t
.';$__FOR_END_'.$¿nd.'__='.
$’d
.';';

636 
$·r£SŒ
 .ğ'fÜ($'.
$Çme
.'=$__FOR_START_'.
$¿nd
.'__;'.
$this
->
	`·r£CÚd™iÚ
('$'.$Çme.' '.
$com·risÚ
.' $__FOR_END_'.$¿nd.'__').';$'.$Çme.'+='.
$¡•
.'){ ?>';

637 
$·r£SŒ
 .ğ
$cÚ‹Á
;

638 
$·r£SŒ
 .= '<?php } ?>';

639  
$·r£SŒ
;

640 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Template\TagLib.class.php

1 <?
php


19 şas 
	cTagLib
 {

26 
´Ùeùed
 
	m$xml
 = '';

27 
´Ùeùed
 
	m$gs
 = 
¬¿y
();

33 
´Ùeùed
 
	m$gLib
 ='';

40 
´Ùeùed
 
	m$gLi¡
 = 
¬¿y
();

47 
´Ùeùed
 
	m$·r£
 = 
¬¿y
();

54 
´Ùeùed
 
	m$v®id
 = 
çl£
;

61 
´Ùeùed
 
	m$l
;

63 
´Ùeùed
 
	m$com·risÚ
 = 
¬¿y
('‚heq '=>' !== ',' heq '=>' === ','‚eq '=>' != ','ƒq '=>' == ','ƒgt '=>' >= ',' gt '=>' > ','ƒlt '=>' <= ','†t '=>' < ');

69 
public
 
funùiÚ
 
	$__cÚ¡ruù
() {

70 
$this
->
gLib
 = 
	`¡¹Şow”
(
	`sub¡r
(
	`g‘_şass
($this),6));

71 
$this
->
l
 = 
Thšk
::
	`š¡ªû
('ThinkTemplate');

80 
public
 
funùiÚ
 
	$·r£XmlA‰r
(
$©Œ
,
$g
) {

82 
$©Œ
 = 
	`¡r_»¶aû
('&','___', $attr);

83 
$xml
 = '<l><g '.
$©Œ
.' /></tpl>';

84 
$xml
 = 
	`sim¶exml_lßd_¡ršg
($xml);

85 if(!
$xml
) {

86 
	`throw_exû±iÚ
(
	`L
('_XML_TAG_ERROR_').' : '.
$©Œ
);

88 
$xml
 = (
¬¿y
)($xml->
g
->
	`©Œibu‹s
());

89 
$¬¿y
 = 
	`¬¿y_chªge_key_ÿ£
(
$xml
['@attributes']);

90 if(
$¬¿y
) {

91 
$©Œs
 = 
	`ex¶ode
(',',
$this
->
gs
[
	`¡¹Şow”
(
$g
)]['attr']);

92 if(
	`is£t
(
$this
->
gs
[
	`¡¹Şow”
(
$g
)]['must'])){

93 
$mu¡
 = 
	`ex¶ode
(',',
$this
->
gs
[
	`¡¹Şow”
(
$g
)]['must']);

95 
$mu¡
 = 
	`¬¿y
();

97 
	`fÜ—ch
(
$©Œs
 
as
 
$Çme
) {

98 ifĞ
	`is£t
(
$¬¿y
[
$Çme
])) {

99 
$¬¿y
[
$Çme
] = 
	`¡r_»¶aû
('___','&',$array[$name]);

100 }
	`–£if
(
çl£
 !=ğ
	`¬¿y_£¬ch
(
$Çme
,
$mu¡
)){

101 
	`throw_exû±iÚ
(
	`L
('_PARAM_ERROR_').':'.
$Çme
);

104  
$¬¿y
;

106 
	}
}

114 
public
 
funùiÚ
 
	$·r£CÚd™iÚ
(
$cÚd™iÚ
) {

115 
$cÚd™iÚ
 = 
	`¡r_œ•Ïû
(
	`¬¿y_keys
(
$this
->
com·risÚ
),
	`¬¿y_v®ues
($this->comparison),$condition);

116 
$cÚd™iÚ
 = 
	`´eg_»¶aû
('/\$(\w+):(\w+)\s/is','$\\1->\\2 ',$condition);

117 
	`¡¹Şow”
(
	`C
('TMPL_VAR_IDENTIFY'))) {

119 
$cÚd™iÚ
 = 
	`´eg_»¶aû
('/\$(\w+)\.(\w+)\s/is','$\\1["\\2"] ',$condition);

122 
$cÚd™iÚ
 = 
	`´eg_»¶aû
('/\$(\w+)\.(\w+)\s/is','$\\1->\\2 ',$condition);

125 
$cÚd™iÚ
 = 
	`´eg_»¶aû
('/\$(\w+)\.(\w+)\s/is','(is_array($\\1)?$\\1["\\2"]:$\\1->\\2) ',$condition);

127 if(
çl£
 !=ğ
	`¡½os
(
$cÚd™iÚ
, '$Think'))

128 
$cÚd™iÚ
 = 
	`´eg_»¶aû
('/(\$Think.*?)\s/ies',"\$this->parseThinkVar('\\1');" , $condition);

129  
$cÚd™iÚ
;

130 
	}
}

138 
public
 
funùiÚ
 
	$autoBudV¬
(
$Çme
) {

139 if('Thšk.' =ğ
	`sub¡r
(
$Çme
,0,6)){

141  
$this
->
	`·r£ThškV¬
(
$Çme
);

142 }
	`–£if
(
	`¡½os
(
$Çme
,'.')) {

143 
$v¬s
 = 
	`ex¶ode
('.',
$Çme
);

144 
$v¬
 = 
	`¬¿y_shiá
(
$v¬s
);

145 
	`¡¹Şow”
(
	`C
('TMPL_VAR_IDENTIFY'))) {

147 
$Çme
 = '$'.
$v¬
;

148 
	`fÜ—ch
 (
$v¬s
 
as
 
$key
=>
$v®
){

149 if(0===
	`¡½os
(
$v®
,'$')) {

150 
$Çme
 .ğ'["{'.
$v®
.'}"]';

152 
$Çme
 .ğ'["'.
$v®
.'"]';

157 
$Çme
 = '$'.
$v¬
;

158 
	`fÜ—ch
 (
$v¬s
 
as
 
$key
=>
$v®
)

159 
$Çme
 .ğ'->'.
$v®
;

162 
$Çme
 = 'is_¬¿y($'.
$v¬
.')?$'.$v¬.'["'.
$v¬s
[0].'"]:$'.$var.'->'.$vars[0];

164 }
	`–£if
(
	`¡½os
(
$Çme
,':')){

166 
$Çme
 = '$'.
	`¡r_»¶aû
(':','->',$name);

167 }
	`–£if
(!
	`defšed
(
$Çme
)) {

168 
$Çme
 = '$'.$name;

170  
$Çme
;

171 
	}
}

180 
public
 
funùiÚ
 
	$·r£ThškV¬
(
$v¬SŒ
){

181 
$v¬s
 = 
	`ex¶ode
('.',
$v¬SŒ
);

182 
$v¬s
[1] = 
	`¡¹ouµ”
(
	`Œim
($vars[1]));

183 
$·r£SŒ
 = '';

184 if(
	`couÁ
(
$v¬s
)>=3){

185 
$v¬s
[2] = 
	`Œim
($vars[2]);

186 
$v¬s
[1]){

187 'SERVER': 
$·r£SŒ
 = '$_SERVER[\''.
$v¬s
[2].'\']';;

188 'GET': 
$·r£SŒ
 = '$_GET[\''.
$v¬s
[2].'\']';;

189 'POST': 
$·r£SŒ
 = '$_POST[\''.
$v¬s
[2].'\']';;

191 if(
	`is£t
(
$v¬s
[3])) {

192 
$·r£SŒ
 = '$_COOKIE[\''.
$v¬s
[2].'\'][\''.$vars[3].'\']';

193 }
	`–£if
(
	`C
('COOKIE_PREFIX')){

194 
$·r£SŒ
 = '$_COOKIE[\''.
	`C
('COOKIE_PREFIX').
$v¬s
[2].'\']';

196 
$·r£SŒ
 = '$_COOKIE[\''.
$v¬s
[2].'\']';

200 if(
	`is£t
(
$v¬s
[3])) {

201 
$·r£SŒ
 = '$_SESSION[\''.
$v¬s
[2].'\'][\''.$vars[3].'\']';

202 }
	`–£if
(
	`C
('SESSION_PREFIX')){

203 
$·r£SŒ
 = '$_SESSION[\''.
	`C
('SESSION_PREFIX').'\'][\''.
$v¬s
[2].'\']';

205 
$·r£SŒ
 = '$_SESSION[\''.
$v¬s
[2].'\']';

208 'ENV': 
$·r£SŒ
 = '$_ENV[\''.
$v¬s
[2].'\']';;

209 'REQUEST': 
$·r£SŒ
 = '$_REQUEST[\''.
$v¬s
[2].'\']';;

210 'CONST': 
$·r£SŒ
 = 
	`¡¹ouµ”
(
$v¬s
[2]);;

211 'LANG': 
$·r£SŒ
 = 'L("'.
$v¬s
[2].'")';;

212 'CONFIG': 
$·r£SŒ
 = 'C("'.
$v¬s
[2].'")';;

214 }if(
	`couÁ
(
$v¬s
)==2){

215 
$v¬s
[1]){

216 'NOW': 
$·r£SŒ
 = "date('Y-m-d g:i‡',time())";;

217 'VERSION': 
$·r£SŒ
 = 'THINK_VERSION';;

218 'TEMPLATE':
$·r£SŒ
 = 'C("TEMPLATE_NAME")';;

219 'LDELIM': 
$·r£SŒ
 = 'C("TMPL_L_DELIM")';;

220 'RDELIM': 
$·r£SŒ
 = 'C("TMPL_R_DELIM")';;

221 : if(
	`defšed
(
$v¬s
[1])è
$·r£SŒ
 = $vars[1];

224  
$·r£SŒ
;

225 
	}
}

228 
public
 
funùiÚ
 
	$g‘Tags
(){

229  
$this
->
gs
;

230 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Template\ThinkTemplate.class.php

1 <?
php


21 şas 
	cThškTem¶©e
 {

24 
´Ùeùed
 
	m$gLib
 = 
¬¿y
();

26 
´Ùeùed
 
	m$‹m¶©eFe
 = '';

28 
public
 
	m$tV¬
 = 
¬¿y
();

29 
public
 
	m$cÚfig
 = 
¬¿y
();

30 
´iv©e
 
	m$l™”®
 = 
¬¿y
();

31 
´iv©e
 
	m$block
 = 
¬¿y
();

37 
public
 
funùiÚ
 
	$__cÚ¡ruù
(){

38 
$this
->
cÚfig
['ÿche_·th'] = 
	`C
('CACHE_PATH');

39 
$this
->
cÚfig
['‹m¶©e_suffix'] = 
	`C
('TMPL_TEMPLATE_SUFFIX');

40 
$this
->
cÚfig
['ÿche_suffix'] = 
	`C
('TMPL_CACHFILE_SUFFIX');

41 
$this
->
cÚfig
['tm¶_ÿche'] = 
	`C
('TMPL_CACHE_ON');

42 
$this
->
cÚfig
['ÿche_time'] = 
	`C
('TMPL_CACHE_TIME');

43 
$this
->
cÚfig
['glib_begš'] = $this->
	`¡rP»g
(
	`C
('TAGLIB_BEGIN'));

44 
$this
->
cÚfig
['glib_’d'] = $this->
	`¡rP»g
(
	`C
('TAGLIB_END'));

45 
$this
->
cÚfig
['tm¶_begš'] = $this->
	`¡rP»g
(
	`C
('TMPL_L_DELIM'));

46 
$this
->
cÚfig
['tm¶_’d'] = $this->
	`¡rP»g
(
	`C
('TMPL_R_DELIM'));

47 
$this
->
cÚfig
['deçuÉ_tm¶'] = 
	`C
('TEMPLATE_NAME');

48 
$this
->
cÚfig
['Ïyout_™em'] = 
	`C
('TMPL_LAYOUT_ITEM');

51 
´iv©e
 
funùiÚ
 
	$¡rP»g
(
$¡r
) {

52  
	`¡r_»¶aû
(

53 
	`¬¿y
('{','}','(',')','|','[',']','-','+','*','.','^','?'),

54 
	`¬¿y
('\{','\}','\(','\)','\|','\[','\]','\-','\+','\*','\.','\^','\?'),

55 
$¡r
);

56 
	}
}

59 
public
 
funùiÚ
 
	$g‘
(
$Çme
) {

60 if(
	`is£t
(
$this
->
tV¬
[
$Çme
]))

61  
$this
->
tV¬
[
$Çme
];

63  
çl£
;

64 
	}
}

66 
public
 
funùiÚ
 
	$£t
(
$Çme
,
$v®ue
) {

67 
$this
->
tV¬
[
$Çme
]ğ
$v®ue
;

68 
	}
}

78 
public
 
funùiÚ
 
ãtch
(
$‹m¶©eFe
,
$‹m¶©eV¬
,
$´efix
='') {

79 
$this
->
tV¬
 = 
$‹m¶©eV¬
;

80 
	g$‹m¶©eCacheFe
 = 
$this
->
lßdTem¶©e
(
$‹m¶©eFe
,
$´efix
);

82 
exŒaù
(
$‹m¶©eV¬
, 
EXTR_OVERWRITE
);

84 
šşude
 
	g$‹m¶©eCacheFe
;

95 
public
 
funùiÚ
 
lßdTem¶©e
 (
$tm¶Tem¶©eFe
,
$´efix
='') {

96 if(
is_fe
(
$tm¶Tem¶©eFe
)) {

97 
$this
->
‹m¶©eFe
 = 
$tm¶Tem¶©eFe
;

99 
	g$tm¶CÚ‹Á
 = 
fe_g‘_cÚ‹Ás
(
$tm¶Tem¶©eFe
);

101 
	g$tm¶CÚ‹Á
 = 
$tm¶Tem¶©eFe
;

104 
	g$tm¶CacheFe
 = 
$this
->
cÚfig
['ÿche_·th'].
$´efix
.
md5
(
$tm¶Tem¶©eFe
).$this->config['cache_suffix'];

107 if(
C
('LAYOUT_ON')) {

108 if(
	gçl£
 !=ğ
¡½os
(
$tm¶CÚ‹Á
,'{__NOLAYOUT__}')) {

109 
	g$tm¶CÚ‹Á
 = 
¡r_»¶aû
('{__NOLAYOUT__}','',
$tm¶CÚ‹Á
);

111 
	g$ÏyoutFe
 = 
THEME_PATH
.
C
('LAYOUT_NAME').
$this
->
cÚfig
['template_suffix'];

112 
	g$tm¶CÚ‹Á
 = 
¡r_»¶aû
(
$this
->
cÚfig
['Ïyout_™em'],
$tm¶CÚ‹Á
,
fe_g‘_cÚ‹Ás
(
$ÏyoutFe
));

116 
	g$tm¶CÚ‹Á
 = 
$this
->
comp”
(
$tm¶CÚ‹Á
);

118 
	g$dœ
 = 
dœÇme
(
$tm¶CacheFe
);

119 if(!
is_dœ
(
$dœ
))

120 
mkdœ
(
$dœ
,0755,
Œue
);

122 ifĞ
	gçl£
 ==ğ
fe_put_cÚ‹Ás
(
$tm¶CacheFe
,
Œim
(
$tm¶CÚ‹Á
)))

123 
throw_exû±iÚ
(
L
('_CACHE_WRITE_ERROR_').':'.
$tm¶CacheFe
);

124  
	g$tm¶CacheFe
;

133 
´Ùeùed
 
funùiÚ
 
	$comp”
(
$tm¶CÚ‹Á
) {

135 
$tm¶CÚ‹Á
 = 
$this
->
	`·r£
($tmplContent);

137 
$tm¶CÚ‹Á
 = 
	`´eg_»¶aû
('/<!--###literal(\d+)###-->/eis',"\$this->restoreLiteral('\\1')",$tmplContent);

139 
$tm¶CÚ‹Á
 = '<?php if (!defined(\'THINK_PATH\'))ƒxit();?>'.$tmplContent;

140 if(
	`C
('TMPL_STRIP_SPACE')) {

142 
$fšd
 = 
	`¬¿y
('~>\s+<~','~>(\s+\n|\r)~');

143 
$»¶aû
 = 
	`¬¿y
('><','>');

144 
$tm¶CÚ‹Á
 = 
	`´eg_»¶aû
(
$fšd
, 
$»¶aû
, $tmplContent);

147 
$tm¶CÚ‹Á
 = 
	`¡r_»¶aû
('?><?php','',$tmplContent);

148  
	`¡r_wh™e¥aû
(
$tm¶CÚ‹Á
);

149 
	}
}

158 
public
 
funùiÚ
 
	$·r£
(
$cÚ‹Á
) {

160 if(
	`em±y
(
$cÚ‹Á
))  '';

161 
$begš
 = 
$this
->
cÚfig
['taglib_begin'];

162 
$’d
 = 
$this
->
cÚfig
['taglib_end'];

164 
$cÚ‹Á
 = 
$this
->
	`·r£Inşude
($content);

166 
$cÚ‹Á
 = 
$this
->
	`·r£Php
($content);

168 
$cÚ‹Á
 = 
	`´eg_»¶aû
('/'.
$begš
.'l™”®'.
$’d
.'(.*?)'.$begin.'\/literal'.$end.'/eis',"\$this->parseLiteral('\\1')",$content);

175 if(
	`C
('TAGLIB_LOAD')) {

176 
$this
->
	`g‘InşudeTagLib
(
$cÚ‹Á
);

177 if(!
	`em±y
(
$this
->
gLib
)) {

179 
	`fÜ—ch
(
$this
->
gLib
 
as
 
$gLibName
) {

180 
$this
->
	`·r£TagLib
(
$gLibName
,
$cÚ‹Á
);

185 if(
	`C
('TAGLIB_PRE_LOAD')) {

186 
$gLibs
 = 
	`ex¶ode
(',',
	`C
('TAGLIB_PRE_LOAD'));

187 
	`fÜ—ch
 (
$gLibs
 
as
 
$g
){

188 
$this
->
	`·r£TagLib
(
$g
,
$cÚ‹Á
);

192 
$gLibs
 = 
	`ex¶ode
(',',
	`C
('TAGLIB_BUILD_IN'));

193 
	`fÜ—ch
 (
$gLibs
 
as
 
$g
){

194 
$this
->
	`·r£TagLib
(
$g
,
$cÚ‹Á
,
Œue
);

197 
$cÚ‹Á
 = 
	`´eg_»¶aû
('/('.
$this
->
cÚfig
['tmpl_begin'].')([^\d\s'.$this->config['tmpl_begin'].$this->config['tmpl_end'].'].+?)('.$this->config['tmpl_end'].')/eis',"\$this->parseTag('\\2')",$content);

198  
$cÚ‹Á
;

199 
	}
}

202 
´Ùeùed
 
funùiÚ
 
	$·r£Php
(
$cÚ‹Á
) {

203 if(
	`ši_g‘
('short_open_tag')){

205 
$cÚ‹Á
 = 
	`´eg_»¶aû
('/(<\?(?!php|=|$))/i', '<?phpƒcho \'\\1\'; ?>'."\n", $content );

208 if(
	`C
('TMPL_DENY_PHP'è&& 
çl£
 !=ğ
	`¡½os
(
$cÚ‹Á
,'<?php')) {

209 
	`throw_exû±iÚ
(
	`L
('_NOT_ALLOW_PHP_'));

211  
$cÚ‹Á
;

212 
	}
}

215 
´Ùeùed
 
funùiÚ
 
	$·r£Layout
(
$cÚ‹Á
) {

217 
$fšd
 = 
	`´eg_m©ch
('/'.
$this
->
cÚfig
['glib_begš'].'Ïyout\s(.+?)\s*?\/'.$this->cÚfig['glib_’d'].'/is',
$cÚ‹Á
,
$m©ches
);

218 if(
$fšd
) {

220 
$cÚ‹Á
 = 
	`¡r_»¶aû
(
$m©ches
[0],'',$content);

222 
$¬¿y
 = 
$this
->
	`·r£XmlA‰rs
(
$m©ches
[1]);

223 if(!
	`C
('LAYOUT_ON'è|| C('LAYOUT_NAME'è!=
$¬¿y
['name'] ) {

225 
$ÏyoutFe
 = 
THEME_PATH
.
$¬¿y
['Çme'].
$this
->
cÚfig
['template_suffix'];

226 
$»¶aû
 = 
	`is£t
(
$¬¿y
['»¶aû'])?$¬¿y['»¶aû']:
$this
->
cÚfig
['layout_item'];

228 
$cÚ‹Á
 = 
	`¡r_»¶aû
(
$»¶aû
,$cÚ‹Á,
	`fe_g‘_cÚ‹Ás
(
$ÏyoutFe
));

231 
$cÚ‹Á
 = 
	`¡r_»¶aû
('{__NOLAYOUT__}','',$content);

233  
$cÚ‹Á
;

234 
	}
}

237 
´Ùeùed
 
funùiÚ
 
	$·r£Inşude
(
$cÚ‹Á
) {

239 
$cÚ‹Á
 = 
$this
->
	`·r£Ex‹nd
($content);

241 
$cÚ‹Á
 = 
$this
->
	`·r£Layout
($content);

243 
$fšd
 = 
	`´eg_m©ch_®l
('/'.
$this
->
cÚfig
['glib_begš'].'šşude\s(.+?)\s*?\/'.$this->cÚfig['glib_’d'].'/is',
$cÚ‹Á
,
$m©ches
);

244 if(
$fšd
) {

245 
$i
=0;$i<
$fšd
;$i++) {

246 
$šşude
 = 
$m©ches
[1][
$i
];

247 
$¬¿y
 = 
$this
->
	`·r£XmlA‰rs
(
$šşude
);

248 
$fe
 = 
$¬¿y
['file'];

249 
	`un£t
(
$¬¿y
['file']);

250 
$cÚ‹Á
 = 
	`¡r_»¶aû
(
$m©ches
[0][
$i
],
$this
->
	`·r£InşudeI‹m
(
$fe
,
$¬¿y
),$content);

253  
$cÚ‹Á
;

254 
	}
}

257 
´Ùeùed
 
funùiÚ
 
	$·r£Ex‹nd
(
$cÚ‹Á
) {

258 
$begš
 = 
$this
->
cÚfig
['taglib_begin'];

259 
$’d
 = 
$this
->
cÚfig
['taglib_end'];

261 
$fšd
 = 
	`´eg_m©ch
('/'.
$begš
.'ex‹nd\s(.+?)\s*?\/'.
$’d
.'/is',
$cÚ‹Á
,
$m©ches
);

262 if(
$fšd
) {

264 
$cÚ‹Á
 = 
	`¡r_»¶aû
(
$m©ches
[0],'',$content);

266 
	`´eg_»¶aû
('/'.
$begš
.'block\¢ame=(.+?)\s*?'.
$’d
.'(.*?)'.$begš.'\/block'.$’d.'/eis',"\$this->·r£Block('\\1','\\2')",
$cÚ‹Á
);

268 
$¬¿y
 = 
$this
->
	`·r£XmlA‰rs
(
$m©ches
[1]);

269 
$cÚ‹Á
 = 
$this
->
	`·r£Tem¶©eName
(
$¬¿y
['name']);

271 
$cÚ‹Á
 = 
	`´eg_»¶aû
('/'.
$begš
.'block\¢ame=(.+?)\s*?'.
$’d
.'(.*?)'.$begin.'\/block'.$end.'/eis',"\$this->replaceBlock('\\1','\\2')",$content);

273 
$cÚ‹Á
 = 
	`´eg_»¶aû
('/'.
$begš
.'block\¢ame=(.+?)\s*?'.
$’d
.'(.*?)'.$begin.'\/block'.$end.'/eis',"stripslashes('\\2')",$content);

275  
$cÚ‹Á
;

276 
	}
}

284 
´iv©e
 
funùiÚ
 
	$·r£XmlA‰rs
(
$©Œs
) {

285 
$xml
 = '<l><g '.
$©Œs
.' /></tpl>';

286 
$xml
 = 
	`sim¶exml_lßd_¡ršg
($xml);

287 if(!
$xml
)

288 
	`throw_exû±iÚ
(
	`L
('_XML_TAG_ERROR_'));

289 
$xml
 = (
¬¿y
)($xml->
g
->
	`©Œibu‹s
());

290 
$¬¿y
 = 
	`¬¿y_chªge_key_ÿ£
(
$xml
['@attributes']);

291  
$¬¿y
;

292 
	}
}

300 
´iv©e
 
funùiÚ
 
	$·r£L™”®
(
$cÚ‹Á
) {

301 if(
	`Œim
(
$cÚ‹Á
)=='')  '';

302 
$cÚ‹Á
 = 
	`¡r¦ashes
($content);

303 
$i
 = 
	`couÁ
(
$this
->
l™”®
);

304 
$·r£SŒ
 = "<!--###literal{$i}###-->";

305 
$this
->
l™”®
[
$i
] = 
$cÚ‹Á
;

306  
$·r£SŒ
;

307 
	}
}

315 
´iv©e
 
funùiÚ
 
	$»¡ÜeL™”®
(
$g
) {

317 
$·r£SŒ
 = 
$this
->
l™”®
[
$g
];

319 
	`un£t
(
$this
->
l™”®
[
$g
]);

320  
$·r£SŒ
;

321 
	}
}

330 
´iv©e
 
funùiÚ
 
	$·r£Block
(
$Çme
,
$cÚ‹Á
) {

331 
$this
->
block
[
$Çme
] = 
$cÚ‹Á
;

333 
	}
}

342 
´iv©e
 
funùiÚ
 
	$»¶aûBlock
(
$Çme
,
$cÚ‹Á
) {

344 
$»¶aû
 = 
	`is£t
(
$this
->
block
[
$Çme
])? $this->block[$Çme] : 
$cÚ‹Á
;

345  
	`¡r¦ashes
(
$»¶aû
);

346 
	}
}

355 
public
 
funùiÚ
 
	$g‘InşudeTagLib
(& 
$cÚ‹Á
) {

357 
$fšd
 = 
	`´eg_m©ch
('/'.
$this
->
cÚfig
['glib_begš'].'glib\s(.+?)(\s*?)\/'.$this->cÚfig['glib_’d'].'\W/is',
$cÚ‹Á
,
$m©ches
);

358 if(
$fšd
) {

360 
$cÚ‹Á
 = 
	`¡r_»¶aû
(
$m©ches
[0],'',$content);

362 
$¬¿y
 = 
$this
->
	`·r£XmlA‰rs
(
$m©ches
[1]);

363 
$this
->
gLib
 = 
	`ex¶ode
(',',
$¬¿y
['name']);

366 
	}
}

376 
public
 
funùiÚ
 
	$·r£TagLib
(
$gLib
,&
$cÚ‹Á
,
$hide
=
çl£
) {

377 
$begš
 = 
$this
->
cÚfig
['taglib_begin'];

378 
$’d
 = 
$this
->
cÚfig
['taglib_end'];

379 
$şassName
 = 'TagLib'.
	`ucwÜds
(
$gLib
);

380 
$tLib
 = 
Thšk
::
	`š¡ªû
(
$şassName
);

381 
	`fÜ—ch
 (
$tLib
->
	`g‘Tags
(è
as
 
$Çme
=>
$v®
){

382 
$gs
 = 
	`¬¿y
(
$Çme
);

383 if(
	`is£t
(
$v®
['alias'])) {

384 
$gs
 = 
	`ex¶ode
(',',
$v®
['alias']);

385 
$gs
[] = 
$Çme
;

387 
$Ëv–
 = 
	`is£t
(
$v®
['level'])?$val['level']:1;

388 
$şo£Tag
 = 
	`is£t
(
$v®
['şo£'])?$v®['şo£']:
Œue
;

389 
	`fÜ—ch
 (
$gs
 
as
 
$g
){

390 
$·r£Tag
 = !
$hide
? 
$gLib
.':'.
$g
: $tag;

391 if(!
	`m‘hod_exi¡s
(
$tLib
,'_'.
$g
)) {

393 
$g
 = 
$Çme
;

395 
$n1
 = 
	`em±y
(
$v®
['©Œ'])?'(\s*?)':'\s([^'.
$’d
.']*)';

396 ià(!
$şo£Tag
){

397 
$·‰”ns
 = '/'.
$begš
.
$·r£Tag
.
$n1
.'\/(\s*?)'.
$’d
.'/eis';

398 
$»¶aûm’t
 = "\$this->parseXmlTag('$tagLib','$tag','$1','')";

399 
$cÚ‹Á
 = 
	`´eg_»¶aû
(
$·‰”ns
, 
$»¶aûm’t
,$content);

401 
$·‰”ns
 = '/'.
$begš
.
$·r£Tag
.
$n1
.
$’d
.'(.*?)'.$begin.'\/'.$parseTag.'(\s*?)'.$end.'/eis';

402 
$»¶aûm’t
 = "\$this->parseXmlTag('$tagLib','$tag','$1','$2')";

403 
$i
=0;$i<
$Ëv–
;$i++)

404 
$cÚ‹Á
=
	`´eg_»¶aû
(
$·‰”ns
,
$»¶aûm’t
,$content);

408 
	}
}

420 
public
 
funùiÚ
 
	$·r£XmlTag
(
$gLib
,
$g
,
$©Œ
,
$cÚ‹Á
) {

422 
$©Œ
 = 
	`¡r¦ashes
($attr);

423 
$cÚ‹Á
ğ
	`¡r¦ashes
($content);

425 if(
	`ši_g‘
('magic_quotes_sybase'))

426 
$©Œ
 = 
	`¡r_»¶aû
('\"','\'',$attr);

427 
$tLib
 = 
Thšk
::
	`š¡ªû
('TagLib'.
	`ucwÜds
(
	`¡¹Şow”
(
$gLib
)));

428 
$·r£
 = '_'.
$g
;

429 
$cÚ‹Á
 = 
	`Œim
($content);

430  
$tLib
->
	`$·r£
(
$©Œ
,
$cÚ‹Á
);

431 
	}
}

440 
public
 
funùiÚ
 
	$·r£Tag
(
$gSŒ
){

442 
$gSŒ
 = 
	`¡r¦ashes
($tagStr);

445 if(
	`´eg_m©ch
('/^[\s|\d]/is',
$gSŒ
))

447  
	`C
('TMPL_L_DELIM'è. 
$gSŒ
 .C('TMPL_R_DELIM');

448 
$æag
 = 
	`sub¡r
(
$gSŒ
,0,1);

449 
$æag2
 = 
	`sub¡r
(
$gSŒ
,1,1);

450 
$Çme
 = 
	`sub¡r
(
$gSŒ
,1);

451 if('$' =ğ
$æag
 && '.' !ğ
$æag2
 && '(' != $flag2){

452  
$this
->
	`·r£V¬
(
$Çme
);

453 }
	`–£if
('-' =ğ
$æag
 || '+'== $flag){

454  '<?ph°echØ'.
$æag
.
$Çme
.';?>';

455 }
	`–£if
(':' =ğ
$æag
){

456  '<?ph°echØ'.
$Çme
.';?>';

457 }
	`–£if
('~' =ğ
$æag
){

458  '<?ph°'.
$Çme
.';?>';

459 }
	`–£if
(
	`sub¡r
(
$gSŒ
,0,2)=='//' || (substr($tagStr,0,2)=='/*' && substr($tagStr,-2)=='*/')){

464  
	`C
('TMPL_L_DELIM'è. 
$gSŒ
 .C('TMPL_R_DELIM');

465 
	}
}

474 
public
 
funùiÚ
 
	$·r£V¬
(
$v¬SŒ
){

475 
$v¬SŒ
 = 
	`Œim
($varStr);

476 
$_v¬P¬£Li¡
 = 
	`¬¿y
();

478 if(
	`is£t
(
$_v¬P¬£Li¡
[
$v¬SŒ
]))  $_varParseList[$varStr];

479 
$·r£SŒ
 = '';

480 
$v¬Exi¡s
 = 
Œue
;

481 if(!
	`em±y
(
$v¬SŒ
)){

482 
$v¬A¼ay
 = 
	`ex¶ode
('|',
$v¬SŒ
);

484 
$v¬
 = 
	`¬¿y_shiá
(
$v¬A¼ay
);

485 if('Thšk.' =ğ
	`sub¡r
(
$v¬
,0,6)){

487 
$Çme
 = 
$this
->
	`·r£ThškV¬
(
$v¬
);

488 }
	`–£if
Ğ
çl£
 !=ğ
	`¡½os
(
$v¬
,'.')) {

490 
$v¬s
 = 
	`ex¶ode
('.',
$v¬
);

491 
$v¬
 = 
	`¬¿y_shiá
(
$v¬s
);

492 
	`¡¹Şow”
(
	`C
('TMPL_VAR_IDENTIFY'))) {

494 
$Çme
 = '$'.
$v¬
;

495 
	`fÜ—ch
 (
$v¬s
 
as
 
$key
=>
$v®
)

496 
$Çme
 .ğ'["'.
$v®
.'"]';

499 
$Çme
 = '$'.
$v¬
;

500 
	`fÜ—ch
 (
$v¬s
 
as
 
$key
=>
$v®
)

501 
$Çme
 .ğ'->'.
$v®
;

504 
$Çme
 = 'is_¬¿y($'.
$v¬
.')?$'.$v¬.'["'.
$v¬s
[0].'"]:$'.$var.'->'.$vars[0];

506 }
	`–£if
(
çl£
 !=ğ
	`¡½os
(
$v¬
,'[')) {

508 
$Çme
 = "$".
$v¬
;

509 
	`´eg_m©ch
('/(.+?)\[(.+?)\]/is',
$v¬
,
$m©ch
);

510 
$v¬
 = 
$m©ch
[1];

511 }
	`–£if
(
çl£
 !==
	`¡½os
(
$v¬
,':') && false ===strpos($var,'::') && false ===strpos($var,'?')){

513 
$v¬s
 = 
	`ex¶ode
(':',
$v¬
);

514 
$v¬
 = 
	`¡r_»¶aû
(':','->',$var);

515 
$Çme
 = "$".
$v¬
;

516 
$v¬
 = 
$v¬s
[0];

518 
$Çme
 = "$$var";

521 if(
	`couÁ
(
$v¬A¼ay
)>0)

522 
$Çme
 = 
$this
->
	`·r£V¬FunùiÚ
($Çme,
$v¬A¼ay
);

523 
$·r£SŒ
 = '<?ph°echØ('.
$Çme
.'); ?>';

525 
$_v¬P¬£Li¡
[
$v¬SŒ
] = 
$·r£SŒ
;

526  
$·r£SŒ
;

527 
	}
}

537 
public
 
funùiÚ
 
	$·r£V¬FunùiÚ
(
$Çme
,
$v¬A¼ay
){

539 
$Ëngth
 = 
	`couÁ
(
$v¬A¼ay
);

541 
$‹m¶©e_d’y_funs
 = 
	`ex¶ode
(',',
	`C
('TMPL_DENY_FUNC_LIST'));

542 
$i
=0;$i<
$Ëngth
 ;$i++ ){

543 
$¬gs
 = 
	`ex¶ode
('=',
$v¬A¼ay
[
$i
],2);

545 
$fun
 = 
	`¡¹Şow”
(
	`Œim
(
$¬gs
[0]));

546 
$fun
) {

548 
$Çme
 = '('.$Çme.')?('.$Çme.'):'.
$¬gs
[1];

551 if(!
	`š_¬¿y
(
$fun
,
$‹m¶©e_d’y_funs
)){

552 if(
	`is£t
(
$¬gs
[1])){

553 if(
	`¡r¡r
(
$¬gs
[1],'###')){

554 
$¬gs
[1] = 
	`¡r_»¶aû
('###',
$Çme
,$args[1]);

555 
$Çme
 = "$fun($args[1])";

557 
$Çme
 = "$fun($name,$args[1])";

559 }if(!
	`em±y
(
$¬gs
[0])){

560 
$Çme
 = "$fun($name)";

565  
$Çme
;

566 
	}
}

575 
public
 
funùiÚ
 
	$·r£ThškV¬
(
$v¬SŒ
){

576 
$v¬s
 = 
	`ex¶ode
('.',
$v¬SŒ
);

577 
$v¬s
[1] = 
	`¡¹ouµ”
(
	`Œim
($vars[1]));

578 
$·r£SŒ
 = '';

579 if(
	`couÁ
(
$v¬s
)>=3){

580 
$v¬s
[2] = 
	`Œim
($vars[2]);

581 
$v¬s
[1]){

583 
$·r£SŒ
 = '$_SERVER[\''.
	`¡¹ouµ”
(
$v¬s
[2]).'\']';;

585 
$·r£SŒ
 = '$_GET[\''.
$v¬s
[2].'\']';;

587 
$·r£SŒ
 = '$_POST[\''.
$v¬s
[2].'\']';;

589 if(
	`is£t
(
$v¬s
[3])) {

590 
$·r£SŒ
 = '$_COOKIE[\''.
$v¬s
[2].'\'][\''.$vars[3].'\']';

592 
$·r£SŒ
 = 'cook›(\''.
$v¬s
[2].'\')';

596 if(
	`is£t
(
$v¬s
[3])) {

597 
$·r£SŒ
 = '$_SESSION[\''.
$v¬s
[2].'\'][\''.$vars[3].'\']';

599 
$·r£SŒ
 = '£ssiÚ(\''.
$v¬s
[2].'\')';

603 
$·r£SŒ
 = '$_ENV[\''.
	`¡¹ouµ”
(
$v¬s
[2]).'\']';;

605 
$·r£SŒ
 = '$_REQUEST[\''.
$v¬s
[2].'\']';;

607 
$·r£SŒ
 = 
	`¡¹ouµ”
(
$v¬s
[2]);;

609 
$·r£SŒ
 = 'L("'.
$v¬s
[2].'")';;

611 if(
	`is£t
(
$v¬s
[3])) {

612 
$v¬s
[2] .= '.'.$vars[3];

614 
$·r£SŒ
 = 'C("'.
$v¬s
[2].'")';;

617 }if(
	`couÁ
(
$v¬s
)==2){

618 
$v¬s
[1]){

620 
$·r£SŒ
 = "date('Y-m-d g:i‡',time())";

623 
$·r£SŒ
 = 'THINK_VERSION';

626 
$·r£SŒ
 = "'".
$this
->
‹m¶©eFe
."'";

629 
$·r£SŒ
 = 'C("TMPL_L_DELIM")';

632 
$·r£SŒ
 = 'C("TMPL_R_DELIM")';

635 if(
	`defšed
(
$v¬s
[1]))

636 
$·r£SŒ
 = 
$v¬s
[1];

639  
$·r£SŒ
;

640 
	}
}

649 
´iv©e
 
funùiÚ
 
·r£InşudeI‹m
(
$tm¶PublicName
,
$v¬s
=
	$¬¿y
()){

651 
$·r£SŒ
 = 
$this
->
	`·r£Tem¶©eName
(
$tm¶PublicName
);

653 
	`fÜ—ch
 (
$v¬s
 
as
 
$key
=>
$v®
) {

654 
$·r£SŒ
 = 
	`¡r_»¶aû
('['.
$key
.']',
$v®
,$parseStr);

657  
$this
->
	`·r£Inşude
(
$·r£SŒ
);

658 
	}
}

666 
´iv©e
 
funùiÚ
 
	$·r£Tem¶©eName
(
$‹m¶©eName
){

667 if(
	`sub¡r
(
$‹m¶©eName
,0,1)=='$')

669 
$‹m¶©eName
 = 
$this
->
	`g‘
(
	`sub¡r
($templateName,1));

670 
$¬¿y
 = 
	`ex¶ode
(',',
$‹m¶©eName
);

671 
$·r£SŒ
 = '';

672 
	`fÜ—ch
 (
$¬¿y
 
as
 
$‹m¶©eName
){

673 if(
çl£
 ==ğ
	`¡½os
(
$‹m¶©eName
,
$this
->
cÚfig
['template_suffix'])) {

675 
$·th
 = 
	`ex¶ode
(':',
$‹m¶©eName
);

676 
$aùiÚ
 = 
	`¬¿y_pİ
(
$·th
);

677 
$moduË
 = !
	`em±y
(
$·th
)?
	`¬¿y_pİ
($·th):
MODULE_NAME
;

678 if(!
	`em±y
(
$·th
è&& 
THEME_NAME
) {

679 
$·th
 = 
	`dœÇme
(
THEME_PATH
).'/'.
	`¬¿y_pİ
($path).'/';

681 
$·th
 = 
THEME_PATH
;

683 
$‹m¶©eName
 = 
$·th
.
$moduË
.
	`C
('TMPL_FILE_DEPR').
$aùiÚ
.
$this
->
cÚfig
['template_suffix'];

686 
$·r£SŒ
 .ğ
	`fe_g‘_cÚ‹Ás
(
$‹m¶©eName
);

688  
$·r£SŒ
;

689 
	}
}

	@C:\wamp\www\houku\thinkphp\ThinkPHP\ThinkPHP.php

1 <?
php


14 
	g$GLOBALS
['_begšTime'] = 
miüÙime
(
TRUE
);

16 
defše
('MEMORY_LIMIT_ON',
funùiÚ_exi¡s
('memory_get_usage'));

17 if(
	gMEMORY_LIMIT_ON
è
	g$GLOBALS
['_¡¬tU£Mems'] = 
memÜy_g‘_u§ge
();

18 
defšed
('APP_PATH'è
Ü
 
defše
('APP_PATH', 
dœÇme
(
$_SERVER
['SCRIPT_FILENAME']).'/');

19 
defšed
('RUNTIME_PATH'è
Ü
 
defše
('RUNTIME_PATH',
APP_PATH
.'Runtime/');

20 
defšed
('APP_DEBUG'è
Ü
 
defše
('APP_DEBUG',
çl£
);

21 
	g$ruÁime
 = 
defšed
('MODE_NAME')?'~'.
¡¹Şow”
(
MODE_NAME
).'_runtime.php':'~runtime.php';

22 
defšed
('RUNTIME_FILE'è
Ü
 
defše
('RUNTIME_FILE',
RUNTIME_PATH
.
$ruÁime
);

23 if(!
	gAPP_DEBUG
 && 
	$is_fe
(
RUNTIME_FILE
)) {

25 
»quœe
 
RUNTIME_FILE
;

26 
	}

	g}–£
{

28 
defšed
('THINK_PATH'è
Ü
 
defše
('THINK_PATH', 
dœÇme
(
__FILE__
).'/');

30 
»quœe
 
	gTHINK_PATH
.'Common/runtime.php';

	@
1
.
0
42
2683
C:\wamp\www\houku\app\Conf\config.php
C:\wamp\www\houku\app\Lib\Action\IndexAction.class.php
C:\wamp\www\houku\app\Runtime\Cache\9885ecc411f90bec36756701bd64bb4a.php
C:\wamp\www\houku\app\Runtime\Cache\bac39f696f7de5c7cd83cdbb7532b2fc.php
C:\wamp\www\houku\index.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Common\common.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Common\functions.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Common\runtime.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Conf\alias.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Conf\convention.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Conf\debug.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Conf\tags.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lang\en-us.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lang\zh-cn.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Behavior\CheckRouteBehavior.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Behavior\ContentReplaceBehavior.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Behavior\LocationTemplateBehavior.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Behavior\ParseTemplateBehavior.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Behavior\ReadHtmlCacheBehavior.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Behavior\ShowPageTraceBehavior.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Behavior\ShowRuntimeBehavior.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Behavior\TokenBuildBehavior.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Behavior\WriteHtmlCacheBehavior.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\Action.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\App.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\Behavior.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\Cache.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\Db.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\Dispatcher.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\Log.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\Model.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\Think.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\ThinkException.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\View.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Core\Widget.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Driver\Cache\CacheFile.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Driver\Db\DbMysql.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Driver\Db\DbMysqli.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Driver\TagLib\TagLibCx.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Template\TagLib.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\Lib\Template\ThinkTemplate.class.php
C:\wamp\www\houku\thinkphp\ThinkPHP\ThinkPHP.php
